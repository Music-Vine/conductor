---
phase: 04-catalog-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/asset.ts
  - src/types/workflow.ts
  - src/types/collection.ts
  - src/lib/workflow/states.ts
  - src/lib/workflow/transitions.ts
autonomous: true

must_haves:
  truths:
    - "Asset types are correctly defined with discriminated unions"
    - "Workflow states and transitions are typed and validated"
    - "Type guards correctly identify asset and workflow types"
  artifacts:
    - path: "src/types/asset.ts"
      provides: "Asset type definitions with discriminated unions"
      exports: ["AssetType", "MusicAsset", "SfxAsset", "MotionGraphicsAsset", "LutAsset", "StockFootageAsset", "Asset"]
    - path: "src/types/workflow.ts"
      provides: "Workflow state and action types"
      exports: ["MusicWorkflowState", "SimpleWorkflowState", "WorkflowAction", "WorkflowHistoryItem", "ChecklistItem"]
    - path: "src/types/collection.ts"
      provides: "Collection type definitions"
      exports: ["Collection", "CollectionListItem"]
    - path: "src/lib/workflow/states.ts"
      provides: "Workflow state constants and labels"
      exports: ["MUSIC_WORKFLOW_STATES", "SIMPLE_WORKFLOW_STATES", "getStateLabel", "getStateColor"]
    - path: "src/lib/workflow/transitions.ts"
      provides: "Workflow transition logic"
      exports: ["getNextState", "getAvailableActions", "canTransition", "musicTransitions", "simpleTransitions"]
  key_links:
    - from: "src/lib/workflow/transitions.ts"
      to: "src/types/workflow.ts"
      via: "imports MusicWorkflowState, SimpleWorkflowState"
      pattern: "import.*from.*workflow"
---

<objective>
Define asset types, workflow states, and transition logic as the foundation for catalog management.

Purpose: All catalog features depend on these types. Establishing them first ensures consistent typing across components.
Output: Type definitions for assets, workflows, and collections; transition logic for approval workflows.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-catalog-management/CONTEXT.md
@.planning/phases/04-catalog-management/04-RESEARCH.md

# Existing type patterns to follow
@src/types/user.ts
@src/types/platform.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create asset type definitions with discriminated unions</name>
  <files>src/types/asset.ts</files>
  <action>
Create asset types following the discriminated union pattern from CONTEXT.

Define:
- `AssetType` union: 'music' | 'sfx' | 'motion-graphics' | 'lut' | 'stock-footage'
- `BaseAsset` interface with shared fields: id, title, description, contributorId, contributorName, fileKey, fileUrl, fileSize, tags, createdAt, updatedAt, submittedAt, approvedAt, publishedAt
- `MusicAsset` extends BaseAsset with: type: 'music', platform: Platform | 'both', status: MusicWorkflowState, genre, bpm?, key?, duration, instruments?
- `SfxAsset` extends BaseAsset with: type: 'sfx', platform: 'uppbeat' (literal), status: SimpleWorkflowState, category, duration
- `MotionGraphicsAsset` extends BaseAsset with: type: 'motion-graphics', platform: 'uppbeat', status: SimpleWorkflowState, resolution, duration, format
- `LutAsset` extends BaseAsset with: type: 'lut', platform: 'uppbeat', status: SimpleWorkflowState, format, compatibleSoftware[]
- `StockFootageAsset` extends BaseAsset with: type: 'stock-footage', platform: 'uppbeat', status: SimpleWorkflowState, resolution, duration, frameRate
- `Asset` discriminated union of all asset types
- Type guards: isMusicAsset, hasMultiStageWorkflow
- `AssetListItem` simplified type for table display (id, title, type, contributorName, platform, status, genre?, duration?, createdAt, updatedAt)
- `AssetSearchParams` interface for API queries

Import Platform from './platform'. Import workflow state types from './workflow' (circular import okay since types-only).
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit src/types/asset.ts`</verify>
  <done>Asset types defined with discriminated unions, type guards work correctly, non-music assets locked to 'uppbeat' platform</done>
</task>

<task type="auto">
  <name>Task 2: Create workflow and collection types</name>
  <files>src/types/workflow.ts, src/types/collection.ts</files>
  <action>
Create workflow types in src/types/workflow.ts:
- `MusicWorkflowState` union: 'draft' | 'submitted' | 'initial_review' | 'quality_check' | 'platform_assignment' | 'final_approval' | 'published' | 'rejected_initial' | 'rejected_quality' | 'rejected_final'
- `SimpleWorkflowState` union: 'draft' | 'submitted' | 'review' | 'published' | 'rejected'
- `WorkflowActionType` union: 'approve' | 'reject' | 'request_changes' | 'submit' | 'unpublish' | 'fix_metadata' | 'assign_platform'
- `ChecklistItem` interface: { item: string, checked: boolean }
- `WorkflowHistoryItem` interface: id, assetId, reviewerId, reviewerName, action: WorkflowActionType, fromState, toState, checklist?: ChecklistItem[], comments?: string, createdAt

Create collection types in src/types/collection.ts:
- `Collection` interface: id, title, description?, coverImageUrl?, platform: Platform | 'both', assetIds: string[], assetCount: number, createdBy, createdByName, createdAt, updatedAt
- `CollectionListItem` simplified: id, title, platform, assetCount, createdAt

Import Platform from './platform'.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit src/types/workflow.ts src/types/collection.ts`</verify>
  <done>Workflow states match CONTEXT specification, collection types support many-to-many asset relationships</done>
</task>

<task type="auto">
  <name>Task 3: Implement workflow state machine logic</name>
  <files>src/lib/workflow/states.ts, src/lib/workflow/transitions.ts, src/lib/workflow/index.ts</files>
  <action>
Create src/lib/workflow/states.ts:
- Export `MUSIC_WORKFLOW_STATES` array: ordered list of states for timeline display
- Export `SIMPLE_WORKFLOW_STATES` array: ordered list for simple workflow
- Export `getStateLabel(state)` function: returns human-readable label ('initial_review' -> 'Initial Review')
- Export `getStateColor(state)` function: returns Tailwind color class (published -> 'text-green-600', rejected* -> 'text-red-600', draft -> 'text-gray-500', others -> 'text-blue-600')
- Export `isRejectedState(state)` function: returns true for rejected_initial, rejected_quality, rejected_final, rejected
- Export `isPublishedState(state)` function: returns true only for 'published'

Create src/lib/workflow/transitions.ts:
- Define `StateTransition<S>` interface: { from: S, action: WorkflowActionType, to: S }
- Export `musicTransitions`: StateTransition<MusicWorkflowState>[] array per CONTEXT specification:
  - draft -> submit -> submitted
  - submitted -> approve -> initial_review
  - initial_review -> approve -> quality_check
  - initial_review -> reject -> rejected_initial
  - quality_check -> approve -> platform_assignment
  - quality_check -> reject -> rejected_quality
  - platform_assignment -> approve -> final_approval (after platform assigned)
  - final_approval -> approve -> published
  - final_approval -> reject -> rejected_final
  - published -> unpublish -> draft
  - rejected_* -> submit -> submitted (resubmission)
- Export `simpleTransitions`: StateTransition<SimpleWorkflowState>[] array:
  - draft -> submit -> submitted
  - submitted -> approve -> review
  - review -> approve -> published
  - review -> reject -> rejected
  - published -> unpublish -> draft
  - rejected -> submit -> submitted
- Export `getNextState<S>(currentState, action, transitions)` function
- Export `getAvailableActions<S>(currentState, transitions)` function
- Export `canTransition<S>(currentState, action, transitions)` function

Create src/lib/workflow/index.ts to re-export all.
  </action>
  <verify>Create a test script that validates transitions: draft can submit, submitted can approve to next stage, etc.</verify>
  <done>Workflow transitions enforce CONTEXT specification, getAvailableActions returns only valid actions for each state</done>
</task>

</tasks>

<verification>
1. All type files compile without errors
2. Asset discriminated union correctly narrows types
3. Workflow transitions match CONTEXT specification
4. Type guards return correct boolean values
</verification>

<success_criteria>
- Asset types defined with proper discriminated unions
- MusicAsset can have 'music-vine' | 'uppbeat' | 'both' platform
- Non-music assets are locked to 'uppbeat' platform only
- Workflow transition functions return correct next states
- getAvailableActions returns only valid actions per state
</success_criteria>

<output>
After completion, create `.planning/phases/04-catalog-management/04-01-SUMMARY.md`
</output>
