---
phase: 04-catalog-management
plan: 10
type: execute
wave: 5
depends_on: ["04-02", "04-09"]
files_modified:
  - src/components/asset/AudioWaveformPlayer.tsx
  - src/components/asset/VideoPlayer.tsx
  - src/components/asset/AssetPreview.tsx
  - src/components/asset/index.ts
  - src/app/(platform)/assets/[id]/components/OverviewTab.tsx
autonomous: true

must_haves:
  truths:
    - "Audio files display waveform with play/pause controls"
    - "Video files display HTML5 video player"
    - "Preview component selects correct player based on asset type"
  artifacts:
    - path: "src/components/asset/AudioWaveformPlayer.tsx"
      provides: "WaveSurfer audio player"
      exports: ["AudioWaveformPlayer"]
    - path: "src/components/asset/VideoPlayer.tsx"
      provides: "HTML5 video player"
      exports: ["VideoPlayer"]
    - path: "src/components/asset/AssetPreview.tsx"
      provides: "Asset type-aware preview"
      exports: ["AssetPreview"]
  key_links:
    - from: "src/components/asset/AudioWaveformPlayer.tsx"
      to: "@wavesurfer/react"
      via: "useWavesurfer hook"
      pattern: "import.*useWavesurfer"
---

<objective>
Build audio waveform player using WaveSurfer.js and video player for asset previews.

Purpose: Staff can preview assets before approving them.
Output: Reusable media preview components integrated into asset detail page.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-catalog-management/CONTEXT.md
@.planning/phases/04-catalog-management/04-RESEARCH.md
@.planning/phases/04-catalog-management/04-02-SUMMARY.md
@.planning/phases/04-catalog-management/04-09-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create audio waveform player component</name>
  <files>src/components/asset/AudioWaveformPlayer.tsx</files>
  <action>
Create WaveSurfer audio player following RESEARCH pattern:

```typescript
'use client'

import { useRef, useState, useCallback, useEffect } from 'react'
import { useWavesurfer } from '@wavesurfer/react'

interface AudioWaveformPlayerProps {
  audioUrl: string
  className?: string
}

export function AudioWaveformPlayer({ audioUrl, className }: AudioWaveformPlayerProps) {
  const containerRef = useRef<HTMLDivElement>(null)
  const [isPlaying, setIsPlaying] = useState(false)

  const { wavesurfer, isReady, currentTime } = useWavesurfer({
    container: containerRef,
    url: audioUrl,
    waveColor: '#e5e7eb', // gray-200
    progressColor: 'var(--platform-primary, #3b82f6)', // Use CSS variable for platform color
    cursorColor: '#1f2937', // gray-800
    height: 80,
    normalize: true,
    barWidth: 2,
    barGap: 1,
    barRadius: 2,
  })

  // Update playing state when wavesurfer plays/pauses
  useEffect(() => {
    if (!wavesurfer) return

    const handlePlay = () => setIsPlaying(true)
    const handlePause = () => setIsPlaying(false)
    const handleFinish = () => setIsPlaying(false)

    wavesurfer.on('play', handlePlay)
    wavesurfer.on('pause', handlePause)
    wavesurfer.on('finish', handleFinish)

    return () => {
      wavesurfer.un('play', handlePlay)
      wavesurfer.un('pause', handlePause)
      wavesurfer.un('finish', handleFinish)
    }
  }, [wavesurfer])

  const onPlayPause = useCallback(() => {
    if (wavesurfer) {
      wavesurfer.playPause()
    }
  }, [wavesurfer])

  const duration = wavesurfer?.getDuration() ?? 0

  return (
    <div className={className}>
      {/* Waveform container */}
      <div
        ref={containerRef}
        className="rounded-lg bg-gray-50 p-4 cursor-pointer"
        onClick={onPlayPause}
      />

      {/* Controls */}
      <div className="mt-4 flex items-center gap-4">
        <button
          onClick={onPlayPause}
          disabled={!isReady}
          className="rounded-full bg-platform-primary p-3 text-white hover:bg-platform-primary/90 disabled:opacity-50 transition-colors"
          aria-label={isPlaying ? 'Pause' : 'Play'}
        >
          {isPlaying ? (
            <PauseIcon className="h-5 w-5" />
          ) : (
            <PlayIcon className="h-5 w-5" />
          )}
        </button>

        <div className="flex-1">
          <div className="text-sm text-gray-600">
            <span className="font-mono">{formatTime(currentTime)}</span>
            <span className="mx-2">/</span>
            <span className="font-mono">{formatTime(duration)}</span>
          </div>
        </div>

        {/* Loading indicator */}
        {!isReady && (
          <div className="text-sm text-gray-500">Loading waveform...</div>
        )}
      </div>
    </div>
  )
}

function formatTime(seconds: number): string {
  const mins = Math.floor(seconds / 60)
  const secs = Math.floor(seconds % 60)
  return `${mins}:${secs.toString().padStart(2, '0')}`
}

function PlayIcon({ className }: { className?: string }) {
  return (
    <svg className={className} fill="currentColor" viewBox="0 0 24 24">
      <path d="M8 5v14l11-7z" />
    </svg>
  )
}

function PauseIcon({ className }: { className?: string }) {
  return (
    <svg className={className} fill="currentColor" viewBox="0 0 24 24">
      <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
    </svg>
  )
}
```

Notes:
- Uses platform-primary CSS variable for brand consistency
- Click on waveform toggles play/pause
- Shows loading state while waveform decodes
- Cleanup happens automatically via @wavesurfer/react
  </action>
  <verify>Audio player renders waveform and plays audio when clicked</verify>
  <done>WaveSurfer audio player with visual waveform and playback controls</done>
</task>

<task type="auto">
  <name>Task 2: Create video player component</name>
  <files>src/components/asset/VideoPlayer.tsx</files>
  <action>
Create simple HTML5 video player:

```typescript
'use client'

import { useRef, useState } from 'react'

interface VideoPlayerProps {
  videoUrl: string
  className?: string
}

export function VideoPlayer({ videoUrl, className }: VideoPlayerProps) {
  const videoRef = useRef<HTMLVideoElement>(null)
  const [isPlaying, setIsPlaying] = useState(false)
  const [currentTime, setCurrentTime] = useState(0)
  const [duration, setDuration] = useState(0)
  const [isLoading, setIsLoading] = useState(true)

  const handlePlayPause = () => {
    if (videoRef.current) {
      if (isPlaying) {
        videoRef.current.pause()
      } else {
        videoRef.current.play()
      }
    }
  }

  const handleTimeUpdate = () => {
    if (videoRef.current) {
      setCurrentTime(videoRef.current.currentTime)
    }
  }

  const handleLoadedMetadata = () => {
    if (videoRef.current) {
      setDuration(videoRef.current.duration)
      setIsLoading(false)
    }
  }

  const handleSeek = (e: React.ChangeEvent<HTMLInputElement>) => {
    const time = parseFloat(e.target.value)
    if (videoRef.current) {
      videoRef.current.currentTime = time
      setCurrentTime(time)
    }
  }

  return (
    <div className={className}>
      {/* Video element */}
      <div className="relative rounded-lg overflow-hidden bg-black">
        <video
          ref={videoRef}
          src={videoUrl}
          className="w-full aspect-video"
          onPlay={() => setIsPlaying(true)}
          onPause={() => setIsPlaying(false)}
          onTimeUpdate={handleTimeUpdate}
          onLoadedMetadata={handleLoadedMetadata}
          onWaiting={() => setIsLoading(true)}
          onCanPlay={() => setIsLoading(false)}
        />

        {/* Loading overlay */}
        {isLoading && (
          <div className="absolute inset-0 flex items-center justify-center bg-black/50">
            <div className="text-white text-sm">Loading...</div>
          </div>
        )}
      </div>

      {/* Controls */}
      <div className="mt-4 space-y-2">
        <div className="flex items-center gap-4">
          <button
            onClick={handlePlayPause}
            className="rounded-full bg-platform-primary p-3 text-white hover:bg-platform-primary/90 transition-colors"
            aria-label={isPlaying ? 'Pause' : 'Play'}
          >
            {isPlaying ? (
              <PauseIcon className="h-5 w-5" />
            ) : (
              <PlayIcon className="h-5 w-5" />
            )}
          </button>

          <div className="flex-1">
            <input
              type="range"
              min={0}
              max={duration || 100}
              value={currentTime}
              onChange={handleSeek}
              className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-platform-primary"
            />
          </div>

          <div className="text-sm text-gray-600 font-mono">
            {formatTime(currentTime)} / {formatTime(duration)}
          </div>
        </div>
      </div>
    </div>
  )
}

function formatTime(seconds: number): string {
  const mins = Math.floor(seconds / 60)
  const secs = Math.floor(seconds % 60)
  return `${mins}:${secs.toString().padStart(2, '0')}`
}

function PlayIcon({ className }: { className?: string }) {
  return (
    <svg className={className} fill="currentColor" viewBox="0 0 24 24">
      <path d="M8 5v14l11-7z" />
    </svg>
  )
}

function PauseIcon({ className }: { className?: string }) {
  return (
    <svg className={className} fill="currentColor" viewBox="0 0 24 24">
      <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
    </svg>
  )
}
```
  </action>
  <verify>Video player renders and plays video with seek controls</verify>
  <done>HTML5 video player with play/pause and seek functionality</done>
</task>

<task type="auto">
  <name>Task 3: Create unified asset preview component</name>
  <files>src/components/asset/AssetPreview.tsx, src/components/asset/index.ts, src/app/(platform)/assets/[id]/components/OverviewTab.tsx</files>
  <action>
Create AssetPreview that selects the right player:

```typescript
'use client'

import type { Asset } from '@/types/asset'
import { AudioWaveformPlayer } from './AudioWaveformPlayer'
import { VideoPlayer } from './VideoPlayer'

interface AssetPreviewProps {
  asset: Asset
  className?: string
}

export function AssetPreview({ asset, className }: AssetPreviewProps) {
  const isAudio = asset.type === 'music' || asset.type === 'sfx'
  const isVideo = asset.type === 'motion-graphics' || asset.type === 'stock-footage'
  const isLut = asset.type === 'lut'

  if (!asset.fileUrl) {
    return <PreviewNotAvailable message="File not available for preview" />
  }

  if (isAudio) {
    return <AudioWaveformPlayer audioUrl={asset.fileUrl} className={className} />
  }

  if (isVideo) {
    return <VideoPlayer videoUrl={asset.fileUrl} className={className} />
  }

  if (isLut) {
    return (
      <div className={`bg-gray-100 rounded-lg p-8 text-center ${className}`}>
        <div className="text-4xl mb-4">üé®</div>
        <p className="text-gray-600">LUT preview not available</p>
        <p className="text-sm text-gray-500 mt-2">
          Download the file to preview in your editing software
        </p>
      </div>
    )
  }

  return <PreviewNotAvailable message="Preview not available for this file type" />
}

function PreviewNotAvailable({ message }: { message: string }) {
  return (
    <div className="aspect-video bg-gray-100 rounded-lg flex items-center justify-center">
      <div className="text-center">
        <div className="text-4xl text-gray-400 mb-2">üìÅ</div>
        <p className="text-sm text-gray-500">{message}</p>
      </div>
    </div>
  )
}
```

Create index.ts:
```typescript
export * from './AudioWaveformPlayer'
export * from './VideoPlayer'
export * from './AssetPreview'
```

Update OverviewTab.tsx to use AssetPreview:
Replace the AssetPreviewPlaceholder with:
```typescript
import { AssetPreview } from '@/components/asset'

// In the component, replace:
<AssetPreviewPlaceholder asset={asset} />
// with:
<AssetPreview asset={asset} />
```
  </action>
  <verify>Overview tab shows correct preview type based on asset type</verify>
  <done>AssetPreview automatically selects audio or video player based on asset type</done>
</task>

</tasks>

<verification>
1. Music assets show waveform player with play/pause
2. SFX assets show waveform player
3. Motion graphics show video player
4. Stock footage show video player
5. LUTs show informational message
6. Time display updates during playback
7. Seek functionality works for video
</verification>

<success_criteria>
- WaveSurfer waveform renders and is interactive
- Video player has basic controls (play/pause, seek)
- Platform brand color used for progress/controls
- Loading states shown while media loads
- Graceful fallback for missing files or LUTs
</success_criteria>

<output>
After completion, create `.planning/phases/04-catalog-management/04-10-SUMMARY.md`
</output>
