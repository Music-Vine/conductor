---
phase: 01-foundation-and-infrastructure
plan: 12
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tailwind.config.ts
  - src/app/globals.css
  - src/app/layout.tsx
  - src/components/forms/FormInput.tsx
  - src/components/forms/FormTextarea.tsx
  - src/components/forms/FormField.tsx
  - src/components/skeletons/BaseSkeleton.tsx
autonomous: true

must_haves:
  truths:
    - "Cadence package is installed and appears in package.json"
    - "Tailwind config uses Cadence preset"
    - "Form components use Cadence primitives"
    - "Skeleton components use Cadence Skeleton"
  artifacts:
    - path: "package.json"
      provides: "@music-vine/cadence dependency"
      contains: "@music-vine/cadence"
    - path: "tailwind.config.ts"
      provides: "Cadence Tailwind preset configuration"
      contains: "cadence"
    - path: "src/app/globals.css"
      provides: "Cadence styles import"
      contains: "@music-vine/cadence/styles"
    - path: "src/components/forms/FormInput.tsx"
      provides: "Form input using Cadence Input"
      contains: "@music-vine/cadence/ui"
    - path: "src/components/forms/FormTextarea.tsx"
      provides: "Form textarea using Cadence Textarea"
      contains: "@music-vine/cadence/ui"
    - path: "src/components/forms/FormField.tsx"
      provides: "Form field using Cadence Label"
      contains: "@music-vine/cadence/ui"
    - path: "src/components/skeletons/BaseSkeleton.tsx"
      provides: "Skeleton using Cadence Skeleton"
      contains: "@music-vine/cadence/ui"
  key_links:
    - from: "src/components/forms/FormInput.tsx"
      to: "@music-vine/cadence/ui"
      via: "import"
      pattern: "import.*Input.*from '@music-vine/cadence/ui'"
    - from: "src/components/forms/FormTextarea.tsx"
      to: "@music-vine/cadence/ui"
      via: "import"
      pattern: "import.*Textarea.*from '@music-vine/cadence/ui'"
    - from: "src/components/forms/FormField.tsx"
      to: "@music-vine/cadence/ui"
      via: "import"
      pattern: "import.*Label.*from '@music-vine/cadence/ui'"
    - from: "src/components/skeletons/BaseSkeleton.tsx"
      to: "@music-vine/cadence/ui"
      via: "import"
      pattern: "import.*Skeleton.*from '@music-vine/cadence/ui'"
---

<objective>
Install and configure the Cadence Design System (@music-vine/cadence v1.1.2) and refactor existing custom form components to use Cadence primitives.

Purpose: Establish design system consistency by using Cadence components instead of custom implementations. This ensures visual consistency with other Uppbeat/Music Vine applications and reduces maintenance burden.

Output: Cadence installed, Tailwind configured with Cadence preset, form components refactored to use Cadence Input/Textarea/Label/Skeleton primitives.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-infrastructure/01-CONTEXT.md
@.planning/phases/01-foundation-and-infrastructure/01-08-SUMMARY.md

Reference existing implementations:
@src/components/forms/FormInput.tsx
@src/components/forms/FormTextarea.tsx
@src/components/forms/FormField.tsx
@src/components/skeletons/BaseSkeleton.tsx

Reference Cadence package (local):
@~/Code/UppbeatFrontend/packages/cadence/README.md
@~/Code/UppbeatFrontend/packages/cadence/src/components/input.tsx
@~/Code/UppbeatFrontend/packages/cadence/src/components/textarea.tsx
@~/Code/UppbeatFrontend/packages/cadence/src/components/label.tsx
@~/Code/UppbeatFrontend/packages/cadence/src/components/skeleton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Cadence package and configure Tailwind</name>
  <files>
package.json
tailwind.config.ts
src/app/globals.css
  </files>
  <action>
Install the Cadence design system package and configure Tailwind to use its preset.

**Step 1: Install Cadence**
```bash
npm install @music-vine/cadence@1.1.2
```

**Step 2: Create tailwind.config.ts**

Create a new `tailwind.config.ts` file in the project root. This project uses Tailwind v4 with CSS-based configuration (`@import "tailwindcss"` in globals.css), but Cadence provides a v3-style config as a preset. We need to create a config file that Tailwind v4 can use:

```typescript
import type { Config } from 'tailwindcss'
import cadenceConfig from '@music-vine/cadence/tailwind.config'

/**
 * Tailwind CSS configuration extending Cadence Design System.
 *
 * Cadence provides:
 * - Custom color palette (pink, gray, etc.)
 * - Typography scale with proper letter-spacing
 * - Animation utilities for accordions, fades, etc.
 * - Container queries plugin
 *
 * @see https://music-vine.github.io/uppbeat-frontend/
 */
const config: Config = {
  presets: [cadenceConfig],
  content: [
    './src/**/*.{js,ts,jsx,tsx,mdx}',
    './node_modules/@music-vine/cadence/dist/**/*.js',
  ],
  // Extend Cadence theme with project-specific tokens
  theme: {
    extend: {
      // Platform theming CSS variables (defined in globals.css)
      colors: {
        background: 'var(--background)',
        foreground: 'var(--foreground)',
        platform: {
          primary: 'var(--platform-primary)',
          accent: 'var(--platform-accent)',
          'primary-foreground': 'var(--platform-primary-foreground)',
        },
      },
    },
  },
}

export default config
```

**Step 3: Update globals.css to import Cadence styles**

Update `src/app/globals.css` to import Cadence base styles. Add the import after the tailwindcss import:

```css
@import "tailwindcss";
@import "@music-vine/cadence/styles";
@import 'react-loading-skeleton/dist/skeleton.css';

/* ... rest of existing styles ... */
```

Note: The Cadence styles import provides base component styles. The existing platform theming CSS variables and `@theme inline` block should remain unchanged.
  </action>
  <verify>
1. `npm list @music-vine/cadence` shows v1.1.2 installed
2. `tailwind.config.ts` exists in project root
3. `grep "cadence" tailwind.config.ts` shows Cadence preset import
4. `grep "@music-vine/cadence/styles" src/app/globals.css` shows styles import
5. `npm run build` succeeds
  </verify>
  <done>
Cadence package installed at v1.1.2. Tailwind configured with Cadence preset and content paths include Cadence dist files. Cadence base styles imported in globals.css.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor FormInput to use Cadence Input</name>
  <files>
src/components/forms/FormInput.tsx
  </files>
  <action>
Refactor FormInput to use the Cadence Input component while maintaining React Hook Form integration.

**Cadence Input API:**
- `Input` - Styled text input with support for icons, sizes
- Props: `size` ("default" | "sm" | "auto"), `leftIcon`, `rightIcon`, `placeholder`, etc.
- Automatically handles focus states, dark mode, and validation styling (invalid border via CSS)
- Note: Cadence Input has internal focus management, error styling is via `aria-invalid` + CSS

**Refactored src/components/forms/FormInput.tsx:**
```typescript
'use client'

import { useFormContext } from 'react-hook-form'
import { Input } from '@music-vine/cadence/ui'
import { FormField } from './FormField'

interface FormInputProps {
  name: string
  label?: string
  type?: 'text' | 'email' | 'password' | 'number' | 'tel' | 'url'
  placeholder?: string
  description?: string
  disabled?: boolean
  autoComplete?: string
  className?: string
}

/**
 * Text input with form integration using Cadence Input primitive.
 * Validation styling is handled by Cadence via aria-invalid attribute.
 */
export function FormInput({
  name,
  label,
  type = 'text',
  placeholder,
  description,
  disabled,
  autoComplete,
  className = '',
}: FormInputProps) {
  const { register, formState: { errors } } = useFormContext()
  const hasError = !!errors[name]

  return (
    <FormField name={name} label={label} description={description} className={className}>
      <Input
        id={name}
        type={type}
        placeholder={placeholder}
        disabled={disabled}
        autoComplete={autoComplete}
        aria-invalid={hasError}
        {...register(name)}
      />
    </FormField>
  )
}
```

Key changes:
- Import `Input` from `@music-vine/cadence/ui`
- Remove custom Tailwind classes - Cadence Input handles all styling
- Cadence Input uses `aria-invalid` for error styling (red border via CSS)
- The `FormField` wrapper still handles label, description, error message, and validation icons
  </action>
  <verify>
1. `grep "from '@music-vine/cadence/ui'" src/components/forms/FormInput.tsx` returns match
2. `grep "Input" src/components/forms/FormInput.tsx` shows Cadence Input usage
3. `npx tsc --noEmit` passes
4. No custom className for input element (Cadence handles styling)
  </verify>
  <done>
FormInput now uses Cadence Input primitive. Custom Tailwind classes removed. Validation styling handled via aria-invalid attribute which Cadence styles automatically.
  </done>
</task>

<task type="auto">
  <name>Task 3: Refactor FormTextarea to use Cadence Textarea</name>
  <files>
src/components/forms/FormTextarea.tsx
  </files>
  <action>
Refactor FormTextarea to use the Cadence Textarea component.

**Cadence Textarea API:**
- `Textarea` - Multi-line text input inheriting Input styles
- Props: `size` ("default" | "sm"), `resize` ("none" | "vertical" | "horizontal" | "both"), `rows`, etc.
- Default resize is "none", has min-height built in

**Refactored src/components/forms/FormTextarea.tsx:**
```typescript
'use client'

import { useFormContext } from 'react-hook-form'
import { Textarea } from '@music-vine/cadence/ui'
import { FormField } from './FormField'

interface FormTextareaProps {
  name: string
  label?: string
  placeholder?: string
  description?: string
  disabled?: boolean
  rows?: number
  resize?: 'none' | 'vertical' | 'horizontal' | 'both'
  className?: string
}

/**
 * Textarea with form integration using Cadence Textarea primitive.
 * Validation styling is handled by Cadence via aria-invalid attribute.
 */
export function FormTextarea({
  name,
  label,
  placeholder,
  description,
  disabled,
  rows = 4,
  resize = 'none',
  className = '',
}: FormTextareaProps) {
  const { register, formState: { errors } } = useFormContext()
  const hasError = !!errors[name]

  return (
    <FormField name={name} label={label} description={description} className={className}>
      <Textarea
        id={name}
        placeholder={placeholder}
        disabled={disabled}
        rows={rows}
        resize={resize}
        aria-invalid={hasError}
        {...register(name)}
      />
    </FormField>
  )
}
```

Key changes:
- Import `Textarea` from `@music-vine/cadence/ui`
- Remove custom Tailwind classes - Cadence Textarea handles all styling
- Added `resize` prop to expose Cadence's resize variants
- Validation styling via `aria-invalid` attribute
  </action>
  <verify>
1. `grep "from '@music-vine/cadence/ui'" src/components/forms/FormTextarea.tsx` returns match
2. `grep "Textarea" src/components/forms/FormTextarea.tsx` shows Cadence Textarea usage
3. `npx tsc --noEmit` passes
  </verify>
  <done>
FormTextarea now uses Cadence Textarea primitive. Added resize prop for flexibility. Custom styles removed in favor of Cadence's built-in styling.
  </done>
</task>

<task type="auto">
  <name>Task 4: Refactor FormField to use Cadence Label</name>
  <files>
src/components/forms/FormField.tsx
  </files>
  <action>
Refactor FormField to use the Cadence Label component for accessible labels.

**Cadence Label API:**
- `Label` - Accessible label built on Radix UI Label primitive
- Automatically associates with form elements via `htmlFor`
- Has peer-disabled state handling (dims when associated control is disabled)
- Styled with `font-semibold text-sm leading-none`

**Refactored src/components/forms/FormField.tsx:**
```typescript
'use client'

import { useFormContext } from 'react-hook-form'
import { Label } from '@music-vine/cadence/ui'
import { CircleCheck, CircleAlert } from '@music-vine/cadence/icons'
import type { ReactNode } from 'react'

interface FormFieldProps {
  name: string
  label?: string
  description?: string
  children: ReactNode
  className?: string
}

/**
 * Field wrapper that provides label, error message, and validation state.
 * Uses Cadence Label for accessible labeling and Cadence icons for feedback.
 *
 * Per CONTEXT.md:
 * - Error messages appear inline below field
 * - Red border + error icon on invalid fields
 * - Green checkmark on valid fields (when touched and valid)
 */
export function FormField({
  name,
  label,
  description,
  children,
  className = '',
}: FormFieldProps) {
  const {
    formState: { errors, touchedFields },
  } = useFormContext()

  const error = errors[name]
  const isTouched = touchedFields[name]
  const isValid = isTouched && !error

  return (
    <div className={`space-y-1.5 ${className}`}>
      {label && (
        <Label
          htmlFor={name}
          className="flex items-center gap-2"
        >
          {label}
          {/* Valid checkmark */}
          {isValid && (
            <CircleCheck
              className="h-4 w-4 text-green"
              aria-hidden="true"
            />
          )}
        </Label>
      )}
      {description && (
        <p className="text-sm text-gray-700 dark:text-gray-300">{description}</p>
      )}
      <div className="relative">
        {children}
        {/* Error icon (absolute positioned in input) */}
        {error && (
          <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
            <CircleAlert
              className="h-5 w-5 text-red"
              aria-hidden="true"
            />
          </div>
        )}
      </div>
      {/* Error message */}
      {error && (
        <p className="text-sm text-red" role="alert">
          {error.message as string}
        </p>
      )}
    </div>
  )
}
```

Key changes:
- Import `Label` from `@music-vine/cadence/ui`
- Import `CircleCheck` and `CircleAlert` from `@music-vine/cadence/icons`
- Replace inline SVGs with Cadence icons
- Use Cadence color tokens (`text-green`, `text-red`, `text-gray-700`)
- Label component provides accessible labeling with Radix primitives
  </action>
  <verify>
1. `grep "from '@music-vine/cadence/ui'" src/components/forms/FormField.tsx` returns match for Label
2. `grep "from '@music-vine/cadence/icons'" src/components/forms/FormField.tsx` returns match for icons
3. No inline SVG elements remain
4. `npx tsc --noEmit` passes
  </verify>
  <done>
FormField now uses Cadence Label for accessible labeling and Cadence icons (CircleCheck, CircleAlert) for validation feedback. Colors use Cadence tokens.
  </done>
</task>

<task type="auto">
  <name>Task 5: Refactor BaseSkeleton to use Cadence Skeleton</name>
  <files>
src/components/skeletons/BaseSkeleton.tsx
  </files>
  <action>
Refactor BaseSkeleton to use the Cadence Skeleton component instead of react-loading-skeleton.

**Cadence Skeleton API:**
- `Skeleton` - Loading placeholder with pulse animation
- Props: `className` (for sizing), `items` (number to render, default 1)
- Returns array of div elements with `animate-pulse rounded-md bg-gray-100 dark:bg-gray-900`
- `SkeletonFragment` - Helper to repeat children for complex layouts

**Refactored src/components/skeletons/BaseSkeleton.tsx:**
```typescript
'use client'

import { Skeleton, SkeletonFragment } from '@music-vine/cadence/ui'
import type { HTMLAttributes } from 'react'

export interface BaseSkeletonProps extends HTMLAttributes<HTMLDivElement> {
  /** Number of skeleton elements to render */
  count?: number
  /** Width of skeleton (use Tailwind classes like "w-full", "w-32") */
  width?: string
  /** Height of skeleton (use Tailwind classes like "h-4", "h-8") */
  height?: string
  /** Whether skeleton should be circular */
  circle?: boolean
}

/**
 * Base skeleton component using Cadence Skeleton primitive.
 *
 * @example
 * // Single line skeleton
 * <BaseSkeleton height="h-4" width="w-full" />
 *
 * @example
 * // Multiple skeletons
 * <BaseSkeleton count={3} height="h-4" width="w-full" />
 *
 * @example
 * // Avatar skeleton
 * <BaseSkeleton circle height="h-12" width="w-12" />
 */
export function BaseSkeleton({
  count = 1,
  width = 'w-full',
  height = 'h-4',
  circle = false,
  className = '',
  ...props
}: BaseSkeletonProps) {
  const shapeClass = circle ? 'rounded-full' : 'rounded-md'

  return (
    <Skeleton
      items={count}
      className={`${width} ${height} ${shapeClass} ${className}`}
      {...props}
    />
  )
}

// Re-export SkeletonFragment for complex layouts
export { SkeletonFragment }
```

This replaces react-loading-skeleton with Cadence's built-in Skeleton. The API is simplified but maintains similar functionality.

**Note:** After this change, you can remove the react-loading-skeleton dependency and its CSS import in globals.css:
- Remove `npm uninstall react-loading-skeleton`
- Remove `@import 'react-loading-skeleton/dist/skeleton.css';` from globals.css (optional, but cleaner)
  </action>
  <verify>
1. `grep "from '@music-vine/cadence/ui'" src/components/skeletons/BaseSkeleton.tsx` returns match
2. No import of 'react-loading-skeleton'
3. `npx tsc --noEmit` passes
4. SkeletonFragment is re-exported for complex skeleton layouts
  </verify>
  <done>
BaseSkeleton now uses Cadence Skeleton primitive. API simplified to use Tailwind classes for sizing. SkeletonFragment exported for complex skeleton layouts.
  </done>
</task>

<task type="auto">
  <name>Task 6: Clean up and verify integration</name>
  <files>
package.json
src/app/globals.css
  </files>
  <action>
Clean up unused dependencies and verify the complete integration.

**Step 1: Remove react-loading-skeleton (optional cleanup)**
```bash
npm uninstall react-loading-skeleton
```

**Step 2: Update globals.css to remove unused import**
Remove this line from src/app/globals.css:
```css
@import 'react-loading-skeleton/dist/skeleton.css';
```

The file should look like:
```css
@import "tailwindcss";
@import "@music-vine/cadence/styles";

:root {
  --background: #ffffff;
  --foreground: #171717;
  --skeleton-base: #e5e7eb;
  --skeleton-highlight: #f3f4f6;
  /* ... rest of variables ... */
}
/* ... rest of file unchanged ... */
```

Note: Keep the `--skeleton-base` and `--skeleton-highlight` CSS variables - they may be used elsewhere or can be removed in a future cleanup.

**Step 3: Verify all imports work**
Run full build to ensure all Cadence imports resolve correctly and components work together.
  </action>
  <verify>
1. `npm list react-loading-skeleton` should show "empty" (not installed)
2. `grep "react-loading-skeleton" src/app/globals.css` returns no match
3. `npm run build` succeeds without errors
4. `npm run lint` passes
  </verify>
  <done>
Cleanup complete. react-loading-skeleton removed. All components now use Cadence design system primitives. Build and lint pass.
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify:

1. **Package installed:**
   - `npm list @music-vine/cadence` shows `@music-vine/cadence@1.1.2`

2. **Tailwind configured:**
   - `tailwind.config.ts` exists with Cadence preset
   - Content paths include Cadence dist files

3. **Form components use Cadence:**
   - FormInput uses `<Input>` from Cadence
   - FormTextarea uses `<Textarea>` from Cadence
   - FormField uses `<Label>` and icons from Cadence

4. **Skeleton uses Cadence:**
   - BaseSkeleton uses `<Skeleton>` from Cadence
   - No react-loading-skeleton dependency

5. **Build verification:**
   - `npm run build` succeeds
   - `npm run lint` passes
   - `npx tsc --noEmit` passes

6. **Visual verification (manual):**
   - Start dev server: `npm run dev`
   - Navigate to /settings page
   - Verify form inputs render with Cadence styling (pink focus border, proper typography)
   - Verify validation icons appear (green check on valid, red alert on error)
   - Verify dark mode styling works correctly
</verification>

<success_criteria>
- [ ] @music-vine/cadence@1.1.2 installed in package.json
- [ ] tailwind.config.ts uses Cadence preset
- [ ] Cadence dist files in Tailwind content paths
- [ ] FormInput imports and uses Cadence Input component
- [ ] FormTextarea imports and uses Cadence Textarea component
- [ ] FormField imports and uses Cadence Label and icons
- [ ] BaseSkeleton imports and uses Cadence Skeleton
- [ ] react-loading-skeleton dependency removed
- [ ] npm run build succeeds
- [ ] Form components render with Cadence design system styling
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-infrastructure/01-12-SUMMARY.md`
</output>
