---
phase: 01-foundation-and-infrastructure
plan: 15
type: execute
wave: 1
depends_on: [14]
files_modified:
  - tailwind.config.ts
  - src/app/globals.css
  - src/app/(platform)/page.tsx
  - src/app/(platform)/layout.tsx
  - src/components/Navigation.tsx
  - src/components/UserMenu.tsx
  - src/components/PlatformToggle.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All color classes reference Cadence color palette"
    - "Background is light gray (not black)"
    - "Text is clearly visible with proper contrast"
    - "Cards have visible borders and content"
    - "Dark mode works correctly"
  artifacts:
    - path: "tailwind.config.ts"
      provides: "Extended color palette with Cadence colors"
      contains: "gray:"
    - path: "src/app/globals.css"
      provides: "Proper background and foreground colors"
      contains: "--background"
    - path: "src/app/(platform)/page.tsx"
      provides: "Dashboard using Cadence colors"
      contains: "bg-gray"
  key_links:
    - from: "tailwind.config.ts"
      to: "Cadence color palette"
      via: "theme.extend.colors"
      pattern: "gray.*slate"
---

<objective>
Fix broken color references by auditing all color usage and replacing with Cadence design system colors.

Purpose: Tailwind v3 downgrade broke color classes. The site shows black background with barely visible text because color tokens don't exist in v3 palette. Need to use Cadence color system consistently.

Output: Site renders correctly with proper Cadence colors, visible text, styled cards, working dark mode.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

Screenshot shows broken UI:
- Black background (should be light gray)
- Barely visible text
- Cards render but content not visible
- Overall styling broken

Cadence color palette reference:
@~/Code/UppbeatFrontend/packages/cadence/tailwind.config.js

Current broken files:
@src/app/globals.css
@src/app/(platform)/page.tsx
@src/app/(platform)/layout.tsx
@src/components/Navigation.tsx
@tailwind.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend Tailwind config with Cadence color aliases</name>
  <files>
    tailwind.config.ts
  </files>
  <action>
Update the Tailwind configuration to properly expose Cadence's color palette.

Cadence uses `slate` as its neutral gray. We need to alias common gray references to Cadence's slate tokens.

**Update tailwind.config.ts:**

```typescript
import type { Config } from 'tailwindcss'
import cadenceConfig from '@music-vine/cadence/tailwind.config'

/**
 * Tailwind CSS configuration extending Cadence Design System.
 *
 * Cadence provides:
 * - Slate color palette (neutral grays) - aliased as 'gray'
 * - Pink color palette (brand color)
 * - Typography scale with proper letter-spacing
 * - Animation utilities for accordions, fades, etc.
 * - Container queries plugin
 *
 * @see https://music-vine.github.io/uppbeat-frontend/
 */
const config: Config = {
  presets: [cadenceConfig],
  content: [
    './src/**/*.{js,ts,jsx,tsx,mdx}',
    './node_modules/@music-vine/cadence/dist/**/*.js',
  ],
  theme: {
    extend: {
      // Platform theming CSS variables (defined in globals.css)
      colors: {
        // Alias gray to Cadence's slate for compatibility
        gray: {
          50: '#f8fafc',
          100: '#f1f5f9',
          200: '#e2e8f0',
          300: '#cbd5e1',
          400: '#94a3b8',
          500: '#64748b',
          600: '#475569',
          700: '#334155',
          800: '#1e293b',
          900: '#0f172a',
          950: '#020617',
        },
        // App-level CSS variables
        background: 'var(--background)',
        foreground: 'var(--foreground)',
        // Platform brand colors
        platform: {
          primary: 'var(--platform-primary)',
          accent: 'var(--platform-accent)',
          'primary-foreground': 'var(--platform-primary-foreground)',
        },
      },
    },
  },
}

export default config
```

This provides the full gray scale (slate values) that components are expecting.
  </action>
  <verify>
1. `grep "gray:" tailwind.config.ts` shows gray color scale
2. `grep "50:" tailwind.config.ts` shows lightest gray defined
3. `grep "950:" tailwind.config.ts` shows darkest gray defined
4. Config maintains Cadence preset
  </verify>
  <done>
Tailwind config extended with Cadence slate colors aliased as 'gray'. All gray-X classes now resolve correctly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix globals.css background colors</name>
  <files>
    src/app/globals.css
  </files>
  <action>
Update the CSS variables to use proper light/dark values that work with Cadence.

**Update src/app/globals.css:**

```css
@import "@music-vine/cadence/styles";

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Light mode colors */
    --background: #ffffff;
    --foreground: #0f172a;

    /* Platform colors - default to Music Vine */
    --platform-primary: #ff5f6e;
    --platform-primary-foreground: #ffffff;
    --platform-accent: #ff5f6e;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      /* Dark mode colors */
      --background: #0f172a;
      --foreground: #f8fafc;
    }
  }

  /* Platform-specific overrides - set dynamically by ThemeProvider */
  [data-platform="uppbeat"] {
    --platform-primary: #F23D75;
    --platform-accent: #F23D75;
  }

  [data-platform="music-vine"] {
    --platform-primary: #ff5f6e;
    --platform-accent: #ff5f6e;
  }

  /* Ensure body uses background color */
  body {
    @apply bg-background text-foreground;
  }
}
```

Key changes:
- Wrap custom CSS in `@layer base` for proper Tailwind integration
- Use Cadence slate colors (950 for dark, 50 for light)
- Add explicit body background/text styling
- Fix CSS variable values
  </action>
  <verify>
1. `grep "@layer base" src/app/globals.css` shows proper layer usage
2. `grep "body" src/app/globals.css` shows body styling
3. Background is white (#ffffff) in light mode
4. Background is dark slate in dark mode
  </verify>
  <done>
globals.css updated with proper Cadence colors. Body element explicitly styled with background/foreground.
  </done>
</task>

<task type="auto">
  <name>Task 3: Fix dashboard page color classes</name>
  <files>
    src/app/(platform)/page.tsx
  </files>
  <action>
Update the dashboard page to use valid Cadence color classes.

**Audit current page:**
```bash
grep -n "gray-" src/app/(platform)/page.tsx
grep -n "bg-" src/app/(platform)/page.tsx
grep -n "text-" src/app/(platform)/page.tsx
```

**Update src/app/(platform)/page.tsx** to use proper Cadence colors:

Replace any invalid color classes with Cadence equivalents:
- `bg-gray-50` → valid (now defined in config)
- `text-gray-700` → valid (now defined in config)
- `border-gray-200` → valid (now defined in config)
- `bg-gray-950` → valid (now defined in config)

If the page uses custom colors not in the palette, replace with nearest Cadence color.

Ensure all dashboard cards use:
```typescript
className="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"
```

For text, ensure:
```typescript
className="text-gray-900 dark:text-gray-100"  // Headings
className="text-gray-600 dark:text-gray-400"  // Body text
className="text-gray-500 dark:text-gray-500"  // Muted text
```
  </action>
  <verify>
1. All color classes exist in extended palette
2. No references to undefined color values
3. Light/dark mode classes properly paired
4. Dashboard renders with visible content
  </verify>
  <done>
Dashboard page updated to use valid Cadence color classes. All cards and text visible.
  </done>
</task>

<task type="auto">
  <name>Task 4: Fix navigation and layout colors</name>
  <files>
    src/app/(platform)/layout.tsx
    src/components/Navigation.tsx
    src/components/UserMenu.tsx
  </files>
  <action>
Update navigation components to use Cadence colors.

**For each file, replace color classes:**

Common patterns to fix:
- Background: `bg-white dark:bg-gray-900`
- Borders: `border-gray-200 dark:border-gray-800`
- Text: `text-gray-700 dark:text-gray-300`
- Hover states: `hover:bg-gray-100 dark:hover:bg-gray-800`

**Navigation sidebar specifically:**
```typescript
// Sidebar container
className="border-r border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900"

// Nav links
className="text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"

// Active nav link
className="bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white"
```

**UserMenu dropdown:**
```typescript
// Dropdown container
className="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"

// Menu items
className="text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"
```
  </action>
  <verify>
1. All navigation color classes are valid
2. Sidebar is visible with proper contrast
3. UserMenu dropdown renders correctly
4. Hover states work in both light and dark mode
  </verify>
  <done>
Navigation, layout, and UserMenu updated with Cadence colors. All UI elements visible.
  </done>
</task>

<task type="auto">
  <name>Task 5: Fix PlatformToggle colors</name>
  <files>
    src/components/PlatformToggle.tsx
  </files>
  <action>
Update PlatformToggle to use valid Cadence color classes while maintaining brand colors.

**Update src/components/PlatformToggle.tsx:**

```typescript
'use client'

import { useAtom } from 'jotai'
import { platformAtom } from '@/lib/platform/atoms'
import { captureAuditEvent } from '@/lib/audit/logger'

/**
 * Platform toggle for switching between Music Vine and Uppbeat contexts.
 * Uses brand colors: Uppbeat (#F23D75), Music Vine (#ff5f6e)
 */
export function PlatformToggle() {
  const [platform, setPlatform] = useAtom(platformAtom)

  const handleToggle = (newPlatform: 'music-vine' | 'uppbeat') => {
    if (newPlatform === platform) return

    setPlatform(newPlatform)

    captureAuditEvent({
      action: 'platform.switched',
      resourceType: 'platform',
      resourceId: newPlatform,
      metadata: {
        from: platform,
        to: newPlatform,
      },
    })
      .catch((error) => {
        console.error('Failed to log platform switch:', error)
      })
  }

  return (
    <div className="flex items-center gap-2 rounded-lg border border-gray-200 bg-white p-1 dark:border-gray-700 dark:bg-gray-800">
      <button
        onClick={() => handleToggle('music-vine')}
        className={`rounded-md px-3 py-1.5 text-sm font-medium transition-colors ${
          platform === 'music-vine'
            ? 'bg-platform-primary text-white'
            : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'
        }`}
      >
        Music Vine
      </button>
      <button
        onClick={() => handleToggle('uppbeat')}
        className={`rounded-md px-3 py-1.5 text-sm font-medium transition-colors ${
          platform === 'uppbeat'
            ? 'bg-platform-primary text-white'
            : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'
        }`}
      >
        Uppbeat
      </button>
    </div>
  )
}
```

Uses valid Cadence grays with proper dark mode support while keeping brand primary color.
  </action>
  <verify>
1. All gray color classes are valid (200, 700, etc.)
2. Dark mode classes properly defined
3. Brand color (bg-platform-primary) still works
4. Toggle renders visibly in both light and dark mode
  </verify>
  <done>
PlatformToggle uses valid Cadence gray colors. Brand colors preserved for active state.
  </done>
</task>

<task type="auto">
  <name>Task 6: Test and verify color fixes</name>
  <files>
    (verification only)
  </files>
  <action>
Build and test to ensure all color issues are resolved.

**Step 1: Clean build**
```bash
rm -rf .next
npm run build
```

**Step 2: Visual verification**
```bash
npm run dev
```

Open http://localhost:3000 and verify:
1. Background is light gray/white (not black)
2. Dashboard cards are visible with borders
3. Text is clearly readable
4. Navigation sidebar is visible
5. Platform toggle renders correctly
6. Switching platforms shows brand colors
7. Dark mode works (if enabled)

**Step 3: Check for undefined classes**
Look in browser console for warnings about undefined Tailwind classes.
  </action>
  <verify>
1. Build succeeds without warnings
2. Dashboard renders with visible cards
3. Background is proper light/dark color
4. All text is readable
5. No console warnings about missing classes
6. Screenshot shows working UI (not black background)
  </verify>
  <done>
All color classes valid. Site renders correctly with Cadence colors. UI fully visible and functional.
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify against user's screenshot:

1. **Background color fixed:**
   - Light mode shows white/light gray background (not black)
   - Content area is visible

2. **Cards visible:**
   - Dashboard cards have visible borders
   - Card content is readable
   - Proper spacing and styling

3. **Text readable:**
   - Headings are dark and clear
   - Body text has good contrast
   - No washed-out text

4. **Navigation working:**
   - Sidebar is visible
   - Links are readable
   - Hover states work

5. **Platform toggle:**
   - Toggle is visible
   - Active state shows brand color
   - Switching platforms works

6. **Dark mode:**
   - If enabled, proper dark colors show
   - Still readable and functional
</verification>

<success_criteria>
- [ ] Tailwind config has complete gray color scale
- [ ] globals.css uses valid Cadence color values
- [ ] Dashboard page uses valid color classes
- [ ] Navigation uses valid color classes
- [ ] PlatformToggle uses valid color classes
- [ ] Background is light (not black) in light mode
- [ ] All text is clearly visible
- [ ] Cards have visible borders and content
- [ ] Build succeeds without color-related warnings
- [ ] Site renders correctly (matches expected UI, not screenshot)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-infrastructure/01-15-SUMMARY.md`
</output>
