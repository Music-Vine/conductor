---
phase: 01-foundation-and-infrastructure
plan: 13
type: execute
wave: 1
depends_on: [12]
files_modified:
  - src/app/globals.css
  - src/app/auth/login/page.tsx
  - src/app/auth/magic-link/page.tsx
  - src/components/ThemeProvider.tsx
  - tailwind.config.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All inputs use Cadence Input component (no raw HTML <input>)"
    - "All buttons use Cadence Button component (no raw HTML <button>)"
    - "Platform toggle changes primary color to brand color"
    - "Uppbeat platform shows #F23D75 pink as primary color"
    - "Music Vine platform shows #ff5f6e coral as primary color"
  artifacts:
    - path: "src/app/auth/login/page.tsx"
      provides: "Login form using Cadence components"
      contains: "from '@music-vine/cadence/ui'"
    - path: "src/app/globals.css"
      provides: "Platform-specific brand color CSS variables"
      contains: "--platform-primary"
    - path: "src/components/ThemeProvider.tsx"
      provides: "ThemeProvider setting brand-specific CSS variables"
      contains: "#F23D75"
  key_links:
    - from: "src/app/auth/login/page.tsx"
      to: "@music-vine/cadence/ui"
      via: "import"
      pattern: "import.*from '@music-vine/cadence/ui'"
    - from: "src/components/ThemeProvider.tsx"
      to: "CSS custom properties"
      via: "style.setProperty"
      pattern: "--platform-primary"
---

<objective>
Replace all raw HTML form elements with Cadence components and implement platform-specific brand colors.

Purpose: Ensure consistent use of Cadence design system throughout the application and apply correct brand colors when switching between Uppbeat and Music Vine platforms.

Output: All forms use Cadence components, platform toggle updates primary color to match brand (Uppbeat: #F23D75, Music Vine: #ff5f6e)
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

Brand colors:
- Uppbeat: #F23D75 (pink)
- Music Vine: #ff5f6e (coral)

Files to audit for raw HTML elements:
@src/app/auth/login/page.tsx
@src/app/auth/magic-link/page.tsx
@src/components/ThemeProvider.tsx
@src/app/globals.css
@tailwind.config.ts

Cadence components available:
@~/Code/UppbeatFrontend/packages/cadence/src/components/input.tsx
@~/Code/UppbeatFrontend/packages/cadence/src/components/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and replace raw HTML inputs with Cadence components</name>
  <files>
    src/app/auth/login/page.tsx
    src/app/auth/magic-link/page.tsx
  </files>
  <action>
Find all instances of raw HTML form elements and replace with Cadence components.

**Step 1: Audit for raw HTML elements**
```bash
# Find raw <input> elements
grep -rn "<input" src/app/auth/

# Find raw <button> elements
grep -rn "<button" src/app/auth/

# Find raw <textarea> elements
grep -rn "<textarea" src/app/auth/
```

**Step 2: Update login page**

Replace raw HTML inputs and buttons in `src/app/auth/login/page.tsx` with Cadence components:

```typescript
'use client'

import { useState } from 'react'
import { Input, Button, Heading, Text } from '@music-vine/cadence/ui'
import Link from 'next/link'

export default function LoginPage() {
  const [email, setEmail] = useState('')
  const [loading, setLoading] = useState(false)
  const [sent, setSent] = useState(false)

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)

    try {
      const response = await fetch('/api/auth/magic-link', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email }),
      })

      if (response.ok) {
        setSent(true)
      }
    } catch (error) {
      console.error('Login failed:', error)
    } finally {
      setLoading(false)
    }
  }

  if (sent) {
    return (
      <div className="flex min-h-screen items-center justify-center bg-gray-50 px-4 dark:bg-gray-950">
        <div className="w-full max-w-md space-y-6">
          <div className="text-center">
            <Heading as="h1" size="lg">Check your email</Heading>
            <Text className="mt-2">
              We've sent a magic link to <strong>{email}</strong>
            </Text>
            <Text className="mt-4" size="sm">
              Click the link in the email to log in. The link expires in 15 minutes.
            </Text>
          </div>
        </div>
      </div>
    )
  }

  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-50 px-4 dark:bg-gray-950">
      <div className="w-full max-w-md space-y-6">
        <div className="text-center">
          <Heading as="h1" size="lg">Conductor Admin</Heading>
          <Text className="mt-2">Sign in with your email</Text>
        </div>

        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label htmlFor="email" className="block text-sm font-medium">
              Email address
            </label>
            <Input
              id="email"
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              placeholder="you@example.com"
              required
              disabled={loading}
              className="mt-1"
            />
          </div>

          <Button
            type="submit"
            disabled={loading}
            className="w-full"
          >
            {loading ? 'Sending...' : 'Send magic link'}
          </Button>
        </form>

        <Text size="sm" className="text-center">
          Only authorized staff can access this admin.
        </Text>
      </div>
    </div>
  )
}
```

**Step 3: Update magic-link callback page**

Replace raw HTML in `src/app/auth/magic-link/page.tsx` with Cadence components where appropriate.

Check if there are any raw HTML elements. If the page is mostly loading states, it may already be using proper components. Update any instances of raw `<button>` or `<input>` to use Cadence equivalents.
  </action>
  <verify>
1. `grep -rn "<input" src/app/auth/` returns no matches (all use Cadence Input)
2. `grep -rn "<button" src/app/auth/` returns no matches (all use Cadence Button)
3. `grep "from '@music-vine/cadence/ui'" src/app/auth/login/page.tsx` shows Cadence imports
4. `npm run build` succeeds
  </verify>
  <done>
All authentication pages use Cadence Input and Button components. No raw HTML form elements remain.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement platform-specific brand colors</name>
  <files>
    src/app/globals.css
    src/components/ThemeProvider.tsx
    tailwind.config.ts
  </files>
  <action>
Update platform theming to use brand-specific colors that change when switching platforms.

**Step 1: Update CSS variables in globals.css**

Update the platform color variables to use the brand colors:

```css
@import "tailwindcss";
@import "@music-vine/cadence/styles";

:root {
  --background: #ffffff;
  --foreground: #171717;

  /* Platform colors - default to Music Vine */
  --platform-primary: #ff5f6e;
  --platform-primary-foreground: #ffffff;
  --platform-accent: #ff5f6e;
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

/* Platform-specific overrides - set dynamically by ThemeProvider */
[data-platform="uppbeat"] {
  --platform-primary: #F23D75;
  --platform-accent: #F23D75;
}

[data-platform="music-vine"] {
  --platform-primary: #ff5f6e;
  --platform-accent: #ff5f6e;
}
```

**Step 2: Update ThemeProvider to set CSS variables**

Modify `src/components/ThemeProvider.tsx` to set the CSS custom properties when platform changes:

```typescript
'use client'

import { useAtom } from 'jotai'
import { platformAtom } from '@/lib/platform/atoms'
import { useEffect } from 'react'

interface ThemeProviderProps {
  children: React.ReactNode
}

/**
 * Theme provider that sets platform-specific CSS variables and data attributes.
 *
 * Sets:
 * - data-platform attribute on document root
 * - --platform-primary CSS variable (Uppbeat: #F23D75, Music Vine: #ff5f6e)
 * - --platform-accent CSS variable
 */
export function ThemeProvider({ children }: ThemeProviderProps) {
  const [platform] = useAtom(platformAtom)

  useEffect(() => {
    const root = document.documentElement

    // Set data-platform attribute for CSS selectors
    root.setAttribute('data-platform', platform)

    // Set CSS custom properties for JavaScript access
    const colors = {
      'uppbeat': {
        primary: '#F23D75',
        accent: '#F23D75',
      },
      'music-vine': {
        primary: '#ff5f6e',
        accent: '#ff5f6e',
      },
    }

    const platformColors = colors[platform]
    root.style.setProperty('--platform-primary', platformColors.primary)
    root.style.setProperty('--platform-accent', platformColors.accent)
  }, [platform])

  return <>{children}</>
}
```

**Step 3: Update Tailwind config to expose platform colors**

Ensure the Tailwind config properly exposes the platform CSS variables (this should already exist from plan 01-12, but verify):

```typescript
import type { Config } from 'tailwindcss'
import cadenceConfig from '@music-vine/cadence/tailwind.config'

const config: Config = {
  presets: [cadenceConfig],
  content: [
    './src/**/*.{js,ts,jsx,tsx,mdx}',
    './node_modules/@music-vine/cadence/dist/**/*.js',
  ],
  theme: {
    extend: {
      colors: {
        background: 'var(--background)',
        foreground: 'var(--foreground)',
        platform: {
          primary: 'var(--platform-primary)',
          accent: 'var(--platform-accent)',
          'primary-foreground': 'var(--platform-primary-foreground)',
        },
      },
    },
  },
}

export default config
```

Now components can use `bg-platform-primary` or `text-platform-primary` to get the brand color.
  </action>
  <verify>
1. `grep "#F23D75" src/components/ThemeProvider.tsx` shows Uppbeat color
2. `grep "#ff5f6e" src/components/ThemeProvider.tsx` shows Music Vine color
3. `grep "data-platform" src/components/ThemeProvider.tsx` shows attribute setting
4. `grep "platform-primary" src/app/globals.css` shows CSS variable definition
5. Start dev server and toggle platform - primary color should change in browser DevTools
  </verify>
  <done>
Platform theming now applies brand-specific colors. Uppbeat uses #F23D75 pink, Music Vine uses #ff5f6e coral. CSS variables update when platform changes.
  </done>
</task>

<task type="auto">
  <name>Task 3: Apply brand colors to visible UI elements</name>
  <files>
    src/components/PlatformToggle.tsx
  </files>
  <action>
Update the PlatformToggle component to use the platform brand color for the active state.

**Update PlatformToggle.tsx:**

Replace the hardcoded pink color with the platform CSS variable:

```typescript
'use client'

import { useAtom } from 'jotai'
import { platformAtom } from '@/lib/platform/atoms'
import { captureAuditEvent } from '@/lib/audit/logger'

/**
 * Platform toggle for switching between Music Vine and Uppbeat contexts.
 * Uses brand colors: Uppbeat (#F23D75), Music Vine (#ff5f6e)
 */
export function PlatformToggle() {
  const [platform, setPlatform] = useAtom(platformAtom)

  const handleToggle = (newPlatform: 'music-vine' | 'uppbeat') => {
    if (newPlatform === platform) return

    setPlatform(newPlatform)

    // Log platform switch to audit trail
    captureAuditEvent({
      action: 'platform.switched',
      resourceType: 'platform',
      resourceId: newPlatform,
      metadata: {
        from: platform,
        to: newPlatform,
      },
    })
      .catch((error) => {
        // Log audit failures to console - don't throw to avoid breaking toggle
        console.error('Failed to log platform switch:', error)
      })
  }

  return (
    <div className="flex items-center gap-2 rounded-lg border border-gray-200 p-1 dark:border-gray-800">
      <button
        onClick={() => handleToggle('music-vine')}
        className={`rounded-md px-3 py-1.5 text-sm font-medium transition-colors ${
          platform === 'music-vine'
            ? 'bg-platform-primary text-white'
            : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800'
        }`}
      >
        Music Vine
      </button>
      <button
        onClick={() => handleToggle('uppbeat')}
        className={`rounded-md px-3 py-1.5 text-sm font-medium transition-colors ${
          platform === 'uppbeat'
            ? 'bg-platform-primary text-white'
            : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800'
        }`}
      >
        Uppbeat
      </button>
    </div>
  )
}
```

The active button now uses `bg-platform-primary` which will be #ff5f6e for Music Vine and #F23D75 for Uppbeat.
  </action>
  <verify>
1. `grep "bg-platform-primary" src/components/PlatformToggle.tsx` shows usage
2. No hardcoded pink color (`#F23D75` or similar) in toggle classes
3. Start dev server, click platform toggle - active button color should match brand
  </verify>
  <done>
PlatformToggle uses platform-primary CSS variable. Active button shows brand color (Uppbeat pink or Music Vine coral).
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify:

1. **No raw HTML form elements:**
   - `grep -r "<input" src/app/` - should only find HTML files, not React components
   - `grep -r "<button" src/app/` - should only find HTML files, not React components
   - All forms use Cadence Input and Button components

2. **Brand colors applied:**
   - Start dev server: `npm run dev`
   - Open browser DevTools, go to Elements tab
   - Check `:root` CSS variables - should see `--platform-primary`
   - Default platform should show Music Vine color (#ff5f6e)
   - Click platform toggle to switch to Uppbeat
   - Verify `--platform-primary` changes to #F23D75 in DevTools
   - Active toggle button should show pink (#F23D75)
   - Switch back to Music Vine
   - Active toggle button should show coral (#ff5f6e)

3. **Build verification:**
   - `npm run build` succeeds without errors
   - `npm run lint` passes
</verification>

<success_criteria>
- [ ] All <input> elements replaced with Cadence Input component
- [ ] All <button> elements replaced with Cadence Button component
- [ ] globals.css defines platform-specific color CSS variables
- [ ] ThemeProvider sets --platform-primary based on active platform
- [ ] Uppbeat platform uses #F23D75 as primary color
- [ ] Music Vine platform uses #ff5f6e as primary color
- [ ] PlatformToggle active state uses bg-platform-primary class
- [ ] Brand color changes visibly when toggling platforms
- [ ] npm run build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-infrastructure/01-13-SUMMARY.md`
</output>
