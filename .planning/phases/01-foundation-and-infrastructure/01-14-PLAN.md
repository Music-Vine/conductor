---
phase: 01-foundation-and-infrastructure
plan: 14
type: execute
wave: 1
depends_on: [12, 13]
files_modified:
  - package.json
  - src/app/globals.css
  - tailwind.config.ts
  - postcss.config.mjs
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Tailwind CSS v3 is installed (not v4)"
    - "Cadence component styles are properly inherited"
    - "Platform brand colors still work correctly"
    - "All existing Tailwind classes render correctly"
  artifacts:
    - path: "package.json"
      provides: "Tailwind CSS v3.x dependency"
      contains: "tailwindcss.*3\\."
    - path: "tailwind.config.ts"
      provides: "Tailwind v3-compatible configuration"
      contains: "Config"
    - path: "postcss.config.mjs"
      provides: "PostCSS configuration for Tailwind"
      contains: "tailwindcss"
    - path: "src/app/globals.css"
      provides: "Tailwind directives (v3 style)"
      contains: "@tailwind"
  key_links:
    - from: "src/app/globals.css"
      to: "tailwindcss"
      via: "@tailwind directives"
      pattern: "@tailwind (base|components|utilities)"
---

<objective>
Downgrade from Tailwind CSS v4 to v3 to fix Cadence design system style inheritance issues.

Purpose: Tailwind v4's CSS-first architecture is causing style inheritance problems with Cadence components. Cadence was built for Tailwind v3 and requires v3's configuration system.

Output: Tailwind v3 installed with proper PostCSS configuration, all Cadence styles working, platform theming intact.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

Current setup (Tailwind v4):
@package.json
@src/app/globals.css
@tailwind.config.ts

Issue: Tailwind v4 uses CSS-first configuration (@import "tailwindcss") which conflicts with Cadence's v3-style preset system.

Cadence compatibility:
@~/Code/UppbeatFrontend/packages/cadence/tailwind.config.js
@~/Code/UppbeatFrontend/packages/cadence/README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Downgrade to Tailwind CSS v3</name>
  <files>
    package.json
  </files>
  <action>
Uninstall Tailwind v4 and install v3 with proper dependencies.

**Step 1: Uninstall Tailwind v4**
```bash
npm uninstall tailwindcss
```

**Step 2: Install Tailwind v3 with PostCSS**
```bash
npm install -D tailwindcss@^3.4.0 postcss@^8.4.0 autoprefixer@^10.4.0
```

This installs:
- tailwindcss 3.4.x (latest v3, compatible with Cadence)
- postcss 8.4.x (required for Tailwind)
- autoprefixer 10.4.x (vendor prefixes)

**Step 3: Verify installation**
```bash
npm list tailwindcss
```

Should show tailwindcss@3.4.x (not 4.x).
  </action>
  <verify>
1. `npm list tailwindcss` shows version 3.4.x
2. `npm list postcss` shows version 8.4.x
3. `npm list autoprefixer` shows version 10.4.x
4. No Tailwind v4 packages remain in package.json
  </verify>
  <done>
Tailwind CSS v3.4.x installed with PostCSS and Autoprefixer. Tailwind v4 removed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PostCSS configuration</name>
  <files>
    postcss.config.mjs
  </files>
  <action>
Create PostCSS configuration file for Tailwind v3.

**Create postcss.config.mjs:**
```javascript
/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

export default config
```

This tells PostCSS to process Tailwind directives and add vendor prefixes.
  </action>
  <verify>
1. `postcss.config.mjs` exists in project root
2. File exports config with tailwindcss and autoprefixer plugins
  </verify>
  <done>
PostCSS configuration created for Tailwind v3 processing.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update globals.css to use Tailwind v3 directives</name>
  <files>
    src/app/globals.css
  </files>
  <action>
Replace Tailwind v4 CSS import with v3 directives.

**Update src/app/globals.css:**

Replace the v4 import style with v3 directives:

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@import "@music-vine/cadence/styles";

:root {
  --background: #ffffff;
  --foreground: #171717;

  /* Platform colors - default to Music Vine */
  --platform-primary: #ff5f6e;
  --platform-primary-foreground: #ffffff;
  --platform-accent: #ff5f6e;
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

/* Platform-specific overrides - set dynamically by ThemeProvider */
[data-platform="uppbeat"] {
  --platform-primary: #F23D75;
  --platform-accent: #F23D75;
}

[data-platform="music-vine"] {
  --platform-primary: #ff5f6e;
  --platform-accent: #ff5f6e;
}
```

Key changes:
- Replace `@import "tailwindcss";` with three separate `@tailwind` directives
- Keep `@import "@music-vine/cadence/styles";` after Tailwind directives
- Keep all CSS variables and platform theming unchanged

The order matters: Tailwind directives first, then Cadence styles can override/extend them.
  </action>
  <verify>
1. `grep "@tailwind base" src/app/globals.css` returns match
2. `grep "@tailwind components" src/app/globals.css` returns match
3. `grep "@tailwind utilities" src/app/globals.css` returns match
4. `grep "@import \"tailwindcss\"" src/app/globals.css` returns no match (v4 syntax removed)
5. Cadence styles import remains after Tailwind directives
  </verify>
  <done>
globals.css updated to use Tailwind v3 @tailwind directives. Cadence styles import correctly positioned.
  </done>
</task>

<task type="auto">
  <name>Task 4: Verify Tailwind config compatibility</name>
  <files>
    tailwind.config.ts
  </files>
  <action>
Verify that the existing tailwind.config.ts is compatible with Tailwind v3.

**The current config should already be v3-compatible:**

```typescript
import type { Config } from 'tailwindcss'
import cadenceConfig from '@music-vine/cadence/tailwind.config'

const config: Config = {
  presets: [cadenceConfig],
  content: [
    './src/**/*.{js,ts,jsx,tsx,mdx}',
    './node_modules/@music-vine/cadence/dist/**/*.js',
  ],
  theme: {
    extend: {
      colors: {
        background: 'var(--background)',
        foreground: 'var(--foreground)',
        platform: {
          primary: 'var(--platform-primary)',
          accent: 'var(--platform-accent)',
          'primary-foreground': 'var(--platform-primary-foreground)',
        },
      },
    },
  },
}

export default config
```

This config is already v3-style (using `Config` type, content array, theme.extend). No changes needed.

Just verify it works with v3.
  </action>
  <verify>
1. `tailwind.config.ts` exists
2. `grep "presets: \\[cadenceConfig\\]" tailwind.config.ts` shows Cadence preset
3. `grep "content:" tailwind.config.ts` shows content paths
4. Config follows v3 TypeScript format
  </verify>
  <done>
tailwind.config.ts verified as v3-compatible. No changes needed.
  </done>
</task>

<task type="auto">
  <name>Task 5: Test build and verify Cadence styles</name>
  <files>
    (verification only)
  </files>
  <action>
Build the application and verify that Cadence styles are properly applied.

**Step 1: Clean and rebuild**
```bash
rm -rf .next
npm run build
```

**Step 2: Verify Cadence component styles**

Check that Cadence components have proper styling by inspecting the build output or running dev server.

**Step 3: Check for style conflicts**
```bash
# Start dev server to test
npm run dev
```

Open browser and verify:
- Cadence Input components have proper border, padding, focus states
- Cadence Button components have proper styling
- Cadence Card components render correctly
- Platform brand colors still work (toggle should show #F23D75 for Uppbeat, #ff5f6e for Music Vine)

If styles are missing or broken, check browser console for CSS errors.
  </action>
  <verify>
1. `npm run build` succeeds without Tailwind errors
2. No warnings about missing Tailwind directives
3. Cadence component styles are present in built CSS
4. Dev server runs without CSS errors
  </verify>
  <done>
Build succeeds with Tailwind v3. Cadence component styles properly inherited. Platform theming works correctly.
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify:

1. **Tailwind v3 installed:**
   - `npm list tailwindcss` shows 3.4.x
   - No v4 packages in package.json

2. **PostCSS configuration:**
   - `postcss.config.mjs` exists with tailwindcss and autoprefixer plugins

3. **CSS directives:**
   - globals.css uses `@tailwind base/components/utilities` (not `@import "tailwindcss"`)
   - Cadence styles import comes after Tailwind directives

4. **Cadence styles work:**
   - Start dev server: `npm run dev`
   - Check login page Input component has proper Cadence styling (border, padding, focus ring)
   - Check Button component has proper Cadence styling
   - Check settings page form components render correctly

5. **Platform theming intact:**
   - Toggle between platforms
   - Verify brand colors still change (#F23D75 for Uppbeat, #ff5f6e for Music Vine)
   - Verify PlatformToggle active state shows brand color

6. **Build verification:**
   - `npm run build` succeeds
   - `npm run lint` passes
   - No Tailwind v4 deprecation warnings
</verification>

<success_criteria>
- [ ] Tailwind CSS v3.4.x installed (not v4)
- [ ] PostCSS configuration file created
- [ ] globals.css uses v3 @tailwind directives
- [ ] Cadence component styles properly inherited
- [ ] Input components have correct border, padding, focus states
- [ ] Button components styled correctly
- [ ] Platform brand colors still work
- [ ] Build succeeds without errors
- [ ] No v4-related deprecation warnings
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-infrastructure/01-14-SUMMARY.md`
</output>
