---
phase: 01-foundation-and-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/types/auth.ts
  - src/types/audit.ts
  - src/types/api.ts
  - src/types/platform.ts
autonomous: true

must_haves:
  truths:
    - "All required dependencies are installed and available for import"
    - "TypeScript types exist for session, audit events, and platform context"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies"
      contains: "@tanstack/react-query"
    - path: "src/types/auth.ts"
      provides: "Session and auth type definitions"
      exports: ["Session", "SessionPayload"]
    - path: "src/types/audit.ts"
      provides: "Audit event type definitions"
      exports: ["AuditEvent", "AuditAction"]
    - path: "src/types/platform.ts"
      provides: "Platform type definitions"
      exports: ["Platform"]
  key_links: []
---

<objective>
Install all Phase 1 dependencies and create foundational TypeScript types for authentication, audit logging, and platform context.

Purpose: Establish the dependency foundation and type system that all subsequent plans depend on. Without these types, other plans cannot define properly-typed functions and components.

Output: Updated package.json with all dependencies, type definition files in src/types/
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-infrastructure/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Phase 1 dependencies</name>
  <files>package.json</files>
  <action>
Install the following dependencies using npm:

**Production dependencies:**
- `@tanstack/react-query` - Server state management and API caching
- `jotai` - Atomic state management for platform context
- `react-hook-form` - Form state management
- `zod` - Schema validation
- `@hookform/resolvers` - Zod integration with React Hook Form
- `jose` - JWT signing/verification (Edge runtime compatible)
- `react-loading-skeleton` - Loading state skeletons

Run: `npm install @tanstack/react-query jotai react-hook-form zod @hookform/resolvers jose react-loading-skeleton`

Do NOT install AWS SDK or Amplify yet - the magic link backend integration will use mocked API endpoints per the frontend-first approach.
  </action>
  <verify>
Run `npm ls @tanstack/react-query jotai react-hook-form zod @hookform/resolvers jose react-loading-skeleton` to confirm all packages are installed.
  </verify>
  <done>
All 7 packages appear in package.json dependencies and can be imported without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create foundational TypeScript types</name>
  <files>
src/types/auth.ts
src/types/audit.ts
src/types/api.ts
src/types/platform.ts
  </files>
  <action>
Create the following type definition files:

**src/types/platform.ts:**
```typescript
export type Platform = 'music-vine' | 'uppbeat'

export interface PlatformConfig {
  name: string
  displayName: string
  apiBase: string
  theme: {
    primary: string
    accent: string
  }
}

export const PLATFORM_CONFIG: Record<Platform, PlatformConfig> = {
  'music-vine': {
    name: 'music-vine',
    displayName: 'Music Vine',
    apiBase: process.env.NEXT_PUBLIC_MV_API_BASE || '/api/mv',
    theme: {
      primary: '#1a1a2e',
      accent: '#16213e',
    },
  },
  'uppbeat': {
    name: 'uppbeat',
    displayName: 'Uppbeat',
    apiBase: process.env.NEXT_PUBLIC_UB_API_BASE || '/api/ub',
    theme: {
      primary: '#0f3460',
      accent: '#533483',
    },
  },
}
```

**src/types/auth.ts:**
```typescript
import type { Platform } from './platform'

export interface SessionPayload {
  userId: string
  email: string
  name: string
  platform: Platform
  expiresAt: number
  rememberMe: boolean
}

export interface Session extends SessionPayload {
  // Additional runtime properties
  isValid: boolean
  timeRemaining: number
}

export interface LoginRequest {
  email: string
}

export interface MagicLinkCallbackParams {
  token: string
  signature: string
}

export interface AuthResult {
  success: boolean
  session?: SessionPayload
  error?: string
}
```

**src/types/audit.ts:**
```typescript
import type { Platform } from './platform'

export type AuditAction =
  | 'user.created'
  | 'user.updated'
  | 'user.deleted'
  | 'user.banned'
  | 'user.unbanned'
  | 'session.created'
  | 'session.destroyed'
  | 'platform.switched'
  | 'asset.created'
  | 'asset.updated'
  | 'asset.approved'
  | 'asset.rejected'
  | 'asset.deleted'

export interface AuditEvent {
  id?: string
  actor: string // userId of staff member
  action: AuditAction
  resource: string // Format: "type:id" e.g., "user:123"
  timestamp: number
  platform: Platform
  metadata: {
    before?: Record<string, unknown>
    after?: Record<string, unknown>
    reason?: string
    [key: string]: unknown
  }
}

export interface AuditLogFilters {
  actor?: string
  action?: AuditAction
  resource?: string
  platform?: Platform
  startDate?: number
  endDate?: number
}
```

**src/types/api.ts:**
```typescript
export interface ApiResponse<T> {
  data: T
  success: boolean
  error?: ApiError
}

export interface ApiError {
  code: string
  message: string
  details?: Record<string, unknown>
}

export interface PaginatedResponse<T> {
  data: T[]
  pagination: {
    page: number
    pageSize: number
    totalPages: number
    totalItems: number
  }
}

export interface ApiClientConfig {
  baseUrl: string
  headers?: Record<string, string>
}
```

Also create an index file at `src/types/index.ts` that re-exports all types:
```typescript
export * from './auth'
export * from './audit'
export * from './api'
export * from './platform'
```
  </action>
  <verify>
Run TypeScript compilation check: `npx tsc --noEmit`
Import check: Create a temporary test file that imports all types and verify no errors.
  </verify>
  <done>
All type files exist in src/types/, TypeScript compilation succeeds, and types can be imported from '@/types' or individual files.
  </done>
</task>

</tasks>

<verification>
1. `npm ls` shows all 7 dependencies installed
2. `npx tsc --noEmit` passes without errors
3. Types are importable: `import { Session, AuditEvent, Platform } from '@/types'`
</verification>

<success_criteria>
- All dependencies from research (React Query, Jotai, RHF, Zod, jose, react-loading-skeleton) are installed
- TypeScript types exist for Session, AuditEvent, Platform, and API response structures
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-infrastructure/01-01-SUMMARY.md`
</output>
