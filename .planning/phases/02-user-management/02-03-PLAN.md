---
phase: 02-user-management
plan: 03
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - src/app/(platform)/users/page.tsx
  - src/app/(platform)/users/components/UserFilters.tsx
  - src/app/(platform)/users/loading.tsx
autonomous: true

must_haves:
  truths:
    - "Users page exists at /users route"
    - "Search bar accepts query input"
    - "Search button executes search (not debounced keystroke search)"
    - "Filter dropdowns for status and tier are visible"
    - "URL updates with search params when filtering"
  artifacts:
    - path: "src/app/(platform)/users/page.tsx"
      provides: "Users list page with server-side data fetching"
      min_lines: 30
    - path: "src/app/(platform)/users/components/UserFilters.tsx"
      provides: "Search and filter controls"
      exports: ["UserFilters"]
    - path: "src/app/(platform)/users/loading.tsx"
      provides: "Loading skeleton for users page"
  key_links:
    - from: "src/app/(platform)/users/page.tsx"
      to: "searchParams"
      via: "async page props"
      pattern: "await searchParams"
    - from: "src/app/(platform)/users/components/UserFilters.tsx"
      to: "router.push"
      via: "URL state management"
      pattern: "router\\.push"
---

<objective>
Create the Users list page with search bar and filter controls.

Purpose: Implement the main entry point for user management with quick search (per CONTEXT.md) and URL-based filter state for server-side data fetching.

Output: /users page with search input, status/tier filters, and proper loading state.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-user-management/02-CONTEXT.md
@.planning/phases/02-user-management/02-RESEARCH.md

@src/app/(platform)/page.tsx
@src/app/(platform)/layout.tsx
@src/types/user.ts
@src/lib/api/users.ts
@src/components/skeletons/TableRowSkeleton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Users page with searchParams handling</name>
  <files>src/app/(platform)/users/page.tsx</files>
  <action>
Create the main Users page as a React Server Component:

1. Define SearchParams interface matching UserSearchParams type
2. Make page async and await searchParams (Next.js 15 pattern)
3. Parse searchParams:
   - query: string (default '')
   - page: number (default 1)
   - status: UserStatus | 'all' (default 'all')
   - tier: SubscriptionTier | 'all' (default 'all')

4. Fetch users server-side:
   - Import fetchUsers from '@/lib/api/users'
   - Pass parsed params to fetchUsers
   - Handle 'all' by not including in params

5. Render page structure:
   - Page title: "Users" with h1
   - UserFilters component (client component, receives current params)
   - Suspense boundary around table area with TableRowSkeleton fallback
   - Pass fetched data to UserTable (placeholder div for now - built in next plan)
   - Pagination info: "Showing X-Y of Z users"

Use Cadence components for typography where available.
Apply Tailwind gray-* colors (Cadence palette).
  </action>
  <verify>Navigate to http://localhost:3000/users - page renders without error</verify>
  <done>Users page loads with server-side data fetching</done>
</task>

<task type="auto">
  <name>Task 2: Create UserFilters client component</name>
  <files>src/app/(platform)/users/components/UserFilters.tsx</files>
  <action>
Create client component for search and filters:

1. 'use client' directive at top
2. Props: currentParams (the parsed searchParams)
3. Use hooks:
   - useRouter, usePathname, useSearchParams from 'next/navigation'
   - useState for controlled search input
   - useTransition for pending state

4. Search input (primary - prominent placement per CONTEXT.md):
   - Cadence Input component
   - Placeholder: "Search by email, name, username, or ID..."
   - Controlled input with useState (NOT debounced onChange)
   - defaultValue from currentParams.query
   - Do NOT auto-search on keystroke - per CONTEXT.md: "Search button required to execute (not debounced auto-search or keystroke search)"

5. Search button:
   - CRITICAL per CONTEXT.md: Search ONLY executes when button is clicked
   - Clicking button triggers URL update with current input value
   - Show loading state during transition
   - Can also trigger on Enter key press in search input

6. Filter selects (secondary - less prominent):
   - Account status: All, Active, Suspended
   - Subscription tier: All, Free, Creator, Pro, Enterprise
   - Use native select or Cadence Select if available
   - Filter changes DO trigger immediate URL update (only search requires button)

7. URL update function:
   - Create new URLSearchParams
   - Set/delete params based on values ('all' = delete, otherwise set)
   - Always reset page to 1 when filters change
   - router.push with startTransition

Layout: Search input with Search button takes most space, filters in row below or beside on larger screens.
  </action>
  <verify>Type in search box, click Search button - URL updates with ?query=... and page resets to 1. Typing alone does NOT update URL.</verify>
  <done>Filters update URL params via button click (search) or onChange (selects)</done>
</task>

<task type="auto">
  <name>Task 3: Create loading skeleton for users page</name>
  <files>src/app/(platform)/users/loading.tsx</files>
  <action>
Create loading.tsx for the users route:

1. Import BaseSkeleton and TableRowSkeleton from existing skeletons
2. Render skeleton matching page structure:
   - Title skeleton (h-8 w-32)
   - Search bar skeleton (h-10 w-full)
   - Filter row skeleton (h-10 for each filter)
   - TableRowSkeleton with columns=5, rows=10
   - Pagination skeleton (h-10 w-64)

Match the layout of the actual page so loading feels seamless.
Use existing skeleton components - don't create new ones.
  </action>
  <verify>Hard refresh /users page - loading skeleton appears briefly before content</verify>
  <done>Loading state shows appropriate skeleton</done>
</task>

</tasks>

<verification>
1. Navigate to /users - page renders with title and filters
2. Type in search - URL does NOT change (no debounced auto-search)
3. Click Search button - URL updates to /users?query=...
4. Press Enter in search input - URL updates (alternative to button)
5. Change status filter - URL updates to /users?status=suspended immediately
6. Change tier filter - URL updates to /users?tier=pro immediately
7. Combine filters - URL shows all params
8. Hard refresh with filters in URL - filters pre-populated correctly
9. Loading skeleton appears during navigation
</verification>

<success_criteria>
- /users page accessible and renders
- Search input does NOT auto-search on keystroke (per CONTEXT.md decision)
- Search button click updates URL
- Status and tier filters update URL on change
- Page resets to 1 when filters change
- Loading skeleton appears during data fetch
- Filters pre-populate from URL on refresh
</success_criteria>

<output>
After completion, create `.planning/phases/02-user-management/02-03-SUMMARY.md`
</output>
