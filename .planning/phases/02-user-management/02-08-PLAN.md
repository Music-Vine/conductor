---
phase: 02-user-management
plan: 08
type: execute
wave: 3
depends_on: ["02-05"]
files_modified:
  - src/app/(platform)/users/[id]/components/DownloadsTab.tsx
  - src/app/api/users/[id]/downloads/route.ts
  - src/app/api/users/[id]/licenses/route.ts
autonomous: true

must_haves:
  truths:
    - "Downloads tab shows combined downloads and licenses"
    - "Activity presented in timeline format"
    - "Download entries show asset name, date, type"
    - "License entries show license type and grant date"
  artifacts:
    - path: "src/app/(platform)/users/[id]/components/DownloadsTab.tsx"
      provides: "Downloads + Licenses tab content"
      exports: ["DownloadsTab"]
    - path: "src/app/api/users/[id]/downloads/route.ts"
      provides: "GET endpoint for downloads"
      exports: ["GET"]
    - path: "src/app/api/users/[id]/licenses/route.ts"
      provides: "GET endpoint for licenses"
      exports: ["GET"]
  key_links:
    - from: "src/app/(platform)/users/[id]/components/DownloadsTab.tsx"
      to: "/api/users/[id]/downloads"
      via: "useQuery"
      pattern: "downloads"
    - from: "src/app/(platform)/users/[id]/components/DownloadsTab.tsx"
      to: "/api/users/[id]/licenses"
      via: "useQuery"
      pattern: "licenses"
---

<objective>
Create the Downloads + Licenses tab with combined activity timeline.

Purpose: Per CONTEXT.md, this tab shows "combined view showing both license grants and actual downloads together" in an "integrated timeline" format.

Output: Downloads tab with paginated activity timeline.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-user-management/02-CONTEXT.md
@.planning/phases/02-user-management/02-RESEARCH.md

@src/types/user.ts
@src/app/(platform)/users/[id]/components/UserDetailTabs.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create types for downloads and licenses</name>
  <files>src/types/user.ts</files>
  <action>
Add types for downloads and licenses to src/types/user.ts:

1. Download type:
   - id: string
   - assetId: string
   - assetName: string
   - assetType: 'music' | 'sfx' | 'motion' | 'lut' | 'footage'
   - downloadedAt: string
   - format: string (e.g., 'wav', 'mp3')

2. License type:
   - id: string
   - assetId: string
   - assetName: string
   - licenseType: 'standard' | 'premium' | 'enterprise'
   - grantedAt: string
   - expiresAt: string | null

3. ActivityItem type (union for timeline):
   - type: 'download' | 'license'
   - timestamp: string
   - data: Download | License

Export all types.
  </action>
  <verify>TypeScript compiles: `npm run build`</verify>
  <done>Download and license types defined</done>
</task>

<task type="auto">
  <name>Task 2: Create DownloadsTab component</name>
  <files>src/app/(platform)/users/[id]/components/DownloadsTab.tsx</files>
  <action>
Create client component for Downloads + Licenses tab:

1. 'use client' directive
2. Props: { userId: string, downloadCount: number, licenseCount: number }

3. Use TanStack Query to fetch data:
   - useQuery for downloads: GET /api/users/{userId}/downloads
   - useQuery for licenses: GET /api/users/{userId}/licenses
   - Both queries fetch independently

4. Summary section:
   - Total downloads: {downloadCount}
   - Active licenses: {licenseCount}

5. Combine and sort into timeline:
   - Map downloads to ActivityItem with type: 'download', timestamp: downloadedAt
   - Map licenses to ActivityItem with type: 'license', timestamp: grantedAt
   - Sort combined array by timestamp (newest first)

6. Render timeline:
   - Vertical timeline with date grouping (Today, Yesterday, This Week, Older)
   - Each entry shows:
     - Icon based on type (download arrow vs license badge)
     - Asset name
     - Type-specific info (format for downloads, license type for licenses)
     - Relative timestamp
   - Loading skeleton while fetching
   - Empty state if no activity

7. Pagination:
   - "Load more" button at bottom
   - Track page state internally
   - Append new results to existing

Keep timeline simple - no infinite scroll (explicit load more).
  </action>
  <verify>Click Downloads tab - timeline shows mixed downloads and licenses sorted by date</verify>
  <done>Downloads tab displays combined activity timeline</done>
</task>

<task type="auto">
  <name>Task 3: Create mock downloads and licenses endpoints</name>
  <files>src/app/api/users/[id]/downloads/route.ts, src/app/api/users/[id]/licenses/route.ts</files>
  <action>
Create GET endpoints for downloads and licenses:

Downloads endpoint (src/app/api/users/[id]/downloads/route.ts):
1. Extract userId from params
2. Parse searchParams: page (default 1), limit (default 20)
3. Generate 50 mock downloads:
   - Random asset names (e.g., "Upbeat Corporate", "Dramatic Reveal")
   - Random asset types
   - Random dates within last 90 days
   - Random formats
4. Paginate and return PaginatedResponse

Licenses endpoint (src/app/api/users/[id]/licenses/route.ts):
1. Extract userId from params
2. Parse searchParams: page (default 1), limit (default 20)
3. Generate 20 mock licenses:
   - Random asset names
   - Random license types
   - Random grant dates
   - Some with expiry, some perpetual (null)
4. Paginate and return PaginatedResponse

Add 100ms artificial delay to both.
  </action>
  <verify>`curl http://localhost:3000/api/users/user-1/downloads` returns paginated downloads</verify>
  <done>Downloads and licenses endpoints return mock data</done>
</task>

</tasks>

<verification>
1. Navigate to /users/user-1?tab=downloads
2. Summary shows total downloads and licenses count
3. Timeline displays mixed activity sorted by date
4. Downloads show asset name, type, format
5. Licenses show asset name, license type
6. Activity grouped by date (Today, Yesterday, etc.)
7. "Load more" loads additional entries
8. Loading state shows while fetching
9. Empty state if user has no activity
</verification>

<success_criteria>
- Downloads tab displays combined timeline
- Activity sorted by timestamp (newest first)
- Downloads and licenses visually distinguished
- Date grouping improves scannability
- Pagination with "Load more"
- Mock endpoints return realistic data
</success_criteria>

<output>
After completion, create `.planning/phases/02-user-management/02-08-SUMMARY.md`
</output>
