---
phase: 02-user-management
plan: 06
type: execute
wave: 3
depends_on: ["02-05"]
files_modified:
  - src/app/(platform)/users/[id]/components/ProfileTab.tsx
  - src/app/(platform)/users/[id]/components/OAuthConnections.tsx
  - src/app/api/users/[id]/disconnect-oauth/route.ts
autonomous: true

must_haves:
  truths:
    - "Profile tab shows user identity information"
    - "OAuth connections displayed with disconnect option"
    - "Disconnect OAuth shows confirmation dialog"
    - "Successful disconnect shows toast notification"
  artifacts:
    - path: "src/app/(platform)/users/[id]/components/ProfileTab.tsx"
      provides: "Profile tab content"
      exports: ["ProfileTab"]
    - path: "src/app/(platform)/users/[id]/components/OAuthConnections.tsx"
      provides: "OAuth connections list with disconnect"
      exports: ["OAuthConnections"]
    - path: "src/app/api/users/[id]/disconnect-oauth/route.ts"
      provides: "POST endpoint for OAuth disconnect"
      exports: ["POST"]
  key_links:
    - from: "src/app/(platform)/users/[id]/components/OAuthConnections.tsx"
      to: "/api/users/[id]/disconnect-oauth"
      via: "mutation"
      pattern: "disconnect-oauth"
    - from: "src/app/(platform)/users/[id]/components/OAuthConnections.tsx"
      to: "@radix-ui/react-alert-dialog"
      via: "confirmation dialog"
      pattern: "AlertDialog"
---

<objective>
Create the Profile tab content with user identity info and OAuth connection management.

Purpose: Per CONTEXT.md, Profile tab shows basic identity (email, name, username, ID, platform), account status, and OAuth connections with disconnect option.

Output: Profile tab with identity section and OAuth disconnect functionality.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-user-management/02-CONTEXT.md
@.planning/phases/02-user-management/02-RESEARCH.md

@src/types/user.ts
@src/app/(platform)/users/[id]/components/UserDetailTabs.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProfileTab component</name>
  <files>src/app/(platform)/users/[id]/components/ProfileTab.tsx</files>
  <action>
Create client component for Profile tab content:

1. 'use client' directive
2. Props: { user: UserDetail }

3. Identity section (grid layout):
   - Email: {user.email}
   - Name: {user.name || 'Not set'}
   - Username: {user.username || 'Not set'}
   - User ID: {user.id} (monospace font, copyable)
   - Platform: {user.platform} with platform badge/indicator
   - Created: {user.createdAt} formatted date

4. Account Status section:
   - Status badge (Active/Suspended)
   - If suspended:
     - Suspended at: {user.suspendedAt} formatted
     - Reason: {user.suspendedReason || 'No reason provided'}
   - Suspend/Unsuspend button (placeholder - built in later plan)

5. OAuth Connections section:
   - Heading: "Connected Accounts"
   - OAuthConnections component with user.oauthConnections

Use definition list or grid for label/value pairs.
Section headings with border-bottom separator.
Gray-600 labels, gray-900 values.
  </action>
  <verify>Import ProfileTab into UserDetailTabs, render in profile Tabs.Content - identity info displays</verify>
  <done>Profile tab shows all user identity information</done>
</task>

<task type="auto">
  <name>Task 2: Create OAuthConnections with disconnect</name>
  <files>src/app/(platform)/users/[id]/components/OAuthConnections.tsx</files>
  <action>
Create client component for OAuth connections:

1. 'use client' directive
2. Import * as AlertDialog from '@radix-ui/react-alert-dialog'
3. Import { toast } from 'sonner'
4. Import { useMutation, useQueryClient } from '@tanstack/react-query'

5. Props: { userId: string, connections: OAuthConnection[] }

6. State:
   - connectionToDisconnect: OAuthConnection | null

7. Disconnect mutation:
   - mutationFn: POST /api/users/{userId}/disconnect-oauth with { provider }
   - onSuccess: toast.success('OAuth disconnected'), invalidate user query
   - onError: toast.error('Failed to disconnect')

8. Render connections list:
   - If no connections: "No connected accounts"
   - For each connection:
     - Provider icon/name (Google, Facebook)
     - Connected email
     - Connected date
     - Disconnect button (triggers dialog)

9. Confirmation dialog (AlertDialog):
   - Title: "Disconnect {provider}?"
   - Description: "This user will no longer be able to log in with {provider}. They can reconnect later."
   - Cancel button
   - Disconnect button (calls mutation)

Per CONTEXT.md: "Simple confirmation dialog (not reason-required modals)"
  </action>
  <verify>Click Disconnect on OAuth connection - dialog appears, confirm - toast shows success</verify>
  <done>OAuth disconnect with confirmation and feedback</done>
</task>

<task type="auto">
  <name>Task 3: Create disconnect OAuth API endpoint</name>
  <files>src/app/api/users/[id]/disconnect-oauth/route.ts</files>
  <action>
Create POST endpoint for OAuth disconnect:

1. Extract userId from params (await params)
2. Parse request body: { provider: 'google' | 'facebook' }
3. Validate provider is valid
4. Mock implementation:
   - Log audit action (USER_OAUTH_DISCONNECT)
   - Return { success: true, message: 'OAuth disconnected' }
5. Add artificial 300ms delay to simulate processing

Return 400 if provider invalid.
Return 404 if user not found (mock: any non-empty id is valid).

This is a mock - real implementation will call backend API.
  </action>
  <verify>`curl -X POST http://localhost:3000/api/users/user-1/disconnect-oauth -d '{"provider":"google"}'` returns success</verify>
  <done>Disconnect OAuth endpoint functional</done>
</task>

</tasks>

<verification>
1. Navigate to /users/user-1 - Profile tab active by default
2. Identity section shows email, name, username, ID, platform, created date
3. Status section shows Active or Suspended with details
4. OAuth connections section lists any connections
5. Click Disconnect - confirmation dialog appears
6. Confirm disconnect - toast shows success, connection removed from UI
7. Cancel disconnect - dialog closes, no action taken
</verification>

<success_criteria>
- Profile tab displays all identity fields
- Account status clearly visible with suspension details if applicable
- OAuth connections listed with provider and email
- Disconnect triggers confirmation dialog
- Successful disconnect shows toast and updates UI
- Error handling shows error toast
</success_criteria>

<output>
After completion, create `.planning/phases/02-user-management/02-06-SUMMARY.md`
</output>
