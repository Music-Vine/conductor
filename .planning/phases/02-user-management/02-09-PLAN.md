---
phase: 02-user-management
plan: 09
type: execute
wave: 4
depends_on: ["02-06"]
files_modified:
  - src/app/(platform)/users/[id]/components/SuspendUserDialog.tsx
  - src/app/(platform)/users/components/UserRowActions.tsx
  - src/app/api/users/[id]/suspend/route.ts
  - src/app/api/users/[id]/unsuspend/route.ts
autonomous: true

must_haves:
  truths:
    - "Staff can suspend a user account"
    - "Staff can unsuspend a suspended account"
    - "Actions available from both detail page and table row"
    - "Confirmation dialog shown before action"
  artifacts:
    - path: "src/app/(platform)/users/[id]/components/SuspendUserDialog.tsx"
      provides: "Suspend/unsuspend confirmation dialog"
      exports: ["SuspendUserDialog"]
    - path: "src/app/(platform)/users/components/UserRowActions.tsx"
      provides: "Row actions dropdown menu"
      exports: ["UserRowActions"]
    - path: "src/app/api/users/[id]/suspend/route.ts"
      provides: "POST endpoint for suspend"
      exports: ["POST"]
    - path: "src/app/api/users/[id]/unsuspend/route.ts"
      provides: "POST endpoint for unsuspend"
      exports: ["POST"]
  key_links:
    - from: "src/app/(platform)/users/[id]/components/SuspendUserDialog.tsx"
      to: "/api/users/[id]/suspend"
      via: "mutation"
      pattern: "suspend"
    - from: "src/app/(platform)/users/components/UserRowActions.tsx"
      to: "@radix-ui/react-dropdown-menu"
      via: "DropdownMenu"
      pattern: "DropdownMenu"
---

<objective>
Implement suspend/unsuspend account actions and row-level actions dropdown.

Purpose: Per CONTEXT.md, staff can "Suspend/Unsuspend" accounts with "Simple confirmation dialog". Actions available both contextually in detail view and via row actions menu in table.

Output: Suspend/unsuspend functionality with mutations and UI.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-user-management/02-CONTEXT.md
@.planning/phases/02-user-management/02-RESEARCH.md

@src/types/user.ts
@src/app/(platform)/users/[id]/components/ProfileTab.tsx
@src/app/(platform)/users/components/UserTable.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SuspendUserDialog component</name>
  <files>src/app/(platform)/users/[id]/components/SuspendUserDialog.tsx</files>
  <action>
Create suspend/unsuspend dialog component:

1. 'use client' directive
2. Import * as AlertDialog from '@radix-ui/react-alert-dialog'
3. Import { toast } from 'sonner'
4. Import { useMutation, useQueryClient } from '@tanstack/react-query'

5. Props:
   - userId: string
   - userEmail: string
   - currentStatus: UserStatus
   - trigger?: React.ReactNode (custom trigger, defaults to button)

6. Determine action based on currentStatus:
   - If 'active': action is 'suspend'
   - If 'suspended': action is 'unsuspend'

7. Mutation:
   - mutationFn: POST /api/users/{userId}/{action}
   - onSuccess: toast.success with appropriate message, invalidate queries
   - onError: toast.error

8. Dialog content varies by action:
   Suspend:
   - Title: "Suspend {email}?"
   - Description: "This user will lose access to their account immediately. They can be unsuspended later."
   - Action button: "Suspend Account" (warning/destructive style)

   Unsuspend:
   - Title: "Unsuspend {email}?"
   - Description: "This user will regain access to their account."
   - Action button: "Unsuspend Account" (primary style)

9. Loading state during mutation.

Per CONTEXT.md: "Simple confirmation dialog (not reason-required modals)"
Note: Ban/Unban NOT in this phase per CONTEXT.md.
  </action>
  <verify>Suspend dialog renders, confirm triggers mutation, toast shows result</verify>
  <done>Suspend/unsuspend dialog functional</done>
</task>

<task type="auto">
  <name>Task 2: Create UserRowActions dropdown</name>
  <files>src/app/(platform)/users/components/UserRowActions.tsx</files>
  <action>
Create row actions dropdown for user table:

1. 'use client' directive
2. Import * as DropdownMenu from '@radix-ui/react-dropdown-menu'
3. Import SuspendUserDialog (or inline dialog trigger)

4. Props: { user: UserListItem }

5. DropdownMenu structure:
   - Trigger: three-dot icon button (vertical ellipsis)
   - Content with items:
     a. "View Details" - navigates to /users/{id}
     b. Separator
     c. "Suspend Account" or "Unsuspend Account" (based on status)
     d. "Disconnect OAuth" (navigates to detail with action queued)

6. Styling:
   - Menu items with hover bg-gray-100
   - Destructive items in red text
   - Proper focus states

7. Stop event propagation:
   - onClick on trigger: e.stopPropagation() to prevent row click
   - This prevents navigating to detail when clicking actions

8. Wire to UserTable:
   - Update UserTable Actions column to render UserRowActions
   - Pass user data to component

Per CONTEXT.md: "Actions menu provides quick access to common operations without full navigation"
  </action>
  <verify>Click three-dot menu in table row - dropdown appears, actions work</verify>
  <done>Row actions dropdown in user table</done>
</task>

<task type="auto">
  <name>Task 3: Create suspend/unsuspend API endpoints</name>
  <files>src/app/api/users/[id]/suspend/route.ts, src/app/api/users/[id]/unsuspend/route.ts</files>
  <action>
Create POST endpoints for suspend and unsuspend:

Suspend endpoint (src/app/api/users/[id]/suspend/route.ts):
1. Extract userId from params
2. Mock implementation:
   - Log audit action (USER_SUSPENDED)
   - Return { success: true, user: { ...updatedUser, status: 'suspended', suspendedAt: now } }
3. Add 300ms delay

Unsuspend endpoint (src/app/api/users/[id]/unsuspend/route.ts):
1. Extract userId from params
2. Mock implementation:
   - Log audit action (USER_UNSUSPENDED)
   - Return { success: true, user: { ...updatedUser, status: 'active', suspendedAt: null } }
3. Add 300ms delay

Both return 404 if user not found.
Both log to audit trail.
  </action>
  <verify>`curl -X POST http://localhost:3000/api/users/user-1/suspend` returns updated user with suspended status</verify>
  <done>Suspend/unsuspend endpoints functional</done>
</task>

</tasks>

<verification>
1. On Profile tab, click Suspend button - dialog appears
2. Confirm suspend - toast shows success, status updates to Suspended
3. Suspended user shows Unsuspend button
4. Click Unsuspend - dialog appears
5. Confirm unsuspend - toast shows success, status updates to Active
6. In user table, click three-dot menu - dropdown appears
7. Click "Suspend Account" - dialog appears
8. Click "View Details" - navigates to detail page
9. Dropdown closes on outside click
</verification>

<success_criteria>
- Suspend dialog with confirmation
- Unsuspend dialog with confirmation
- Status updates after action
- Toast notifications for success/error
- Row actions dropdown in table
- Actions don't trigger row click
- Audit logging on both actions
</success_criteria>

<output>
After completion, create `.planning/phases/02-user-management/02-09-SUMMARY.md`
</output>
