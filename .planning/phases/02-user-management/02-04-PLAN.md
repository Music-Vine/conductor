---
phase: 02-user-management
plan: 04
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - src/app/(platform)/users/components/UserTable.tsx
  - src/app/(platform)/users/components/UserTablePagination.tsx
  - src/app/(platform)/users/components/index.ts
autonomous: true

must_haves:
  truths:
    - "User table displays rows with email, name, status, tier, last login"
    - "Clicking a row navigates to user detail"
    - "Pagination controls change page via URL"
    - "Table shows loading state during navigation"
  artifacts:
    - path: "src/app/(platform)/users/components/UserTable.tsx"
      provides: "TanStack Table with manual pagination"
      exports: ["UserTable"]
      min_lines: 80
    - path: "src/app/(platform)/users/components/UserTablePagination.tsx"
      provides: "Pagination controls"
      exports: ["UserTablePagination"]
    - path: "src/app/(platform)/users/components/index.ts"
      provides: "Barrel export"
  key_links:
    - from: "src/app/(platform)/users/components/UserTable.tsx"
      to: "@tanstack/react-table"
      via: "useReactTable hook"
      pattern: "useReactTable"
    - from: "src/app/(platform)/users/components/UserTable.tsx"
      to: "/users/[id]"
      via: "row click navigation"
      pattern: "router\\.push.*users/"
---

<objective>
Create the UserTable component with TanStack Table for server-side pagination.

Purpose: Display paginated user list with clickable rows and proper column layout per CONTEXT.md (email+name, subscription status, last login, actions menu).

Output: Fully functional data table with server-side pagination via URL params.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-user-management/02-CONTEXT.md
@.planning/phases/02-user-management/02-RESEARCH.md

@src/types/user.ts
@src/types/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UserTable component with TanStack Table</name>
  <files>src/app/(platform)/users/components/UserTable.tsx</files>
  <action>
Create client component using TanStack Table v8:

1. 'use client' directive
2. Props interface:
   - data: UserListItem[]
   - pagination: { page, pageSize, totalPages, totalItems }

3. Define columns using createColumnHelper<UserListItem>():
   - Column 1: "User" - email + name combined (name below email in smaller text, or just email if no name)
   - Column 2: "Status" - badge showing Active (green) or Suspended (red)
   - Column 3: "Subscription" - tier name with appropriate styling
   - Column 4: "Last Login" - relative time or formatted date, "Never" if null
   - Column 5: "Actions" - placeholder for three-dot menu (built in later plan)

4. Configure useReactTable:
   - data and columns
   - manualPagination: true (CRITICAL - we're handling server-side)
   - manualFiltering: true
   - manualSorting: true
   - pageCount: pagination.totalPages
   - state: { pagination: { pageIndex: pagination.page - 1, pageSize: pagination.pageSize } }
   - getCoreRowModel: getCoreRowModel()

5. Render table:
   - Use HTML table with Tailwind styling (not Cadence Table if it doesn't exist)
   - thead with gray background
   - tbody with hover state on rows
   - Entire row clickable (onClick navigates to /users/[id])
   - Cursor pointer on hover
   - Compact single-line rows per CONTEXT.md

6. Row click handler:
   - Use useRouter from next/navigation
   - onClick: router.push(`/users/${row.original.id}`)
   - Stop propagation on Actions column click

Style with Cadence colors: gray-50 header bg, gray-100 hover, gray-200 borders.
  </action>
  <verify>Import UserTable in users/page.tsx, pass mock data - table renders with columns</verify>
  <done>UserTable displays data with clickable rows</done>
</task>

<task type="auto">
  <name>Task 2: Create pagination controls</name>
  <files>src/app/(platform)/users/components/UserTablePagination.tsx</files>
  <action>
Create pagination component:

1. 'use client' directive
2. Props:
   - pagination: { page, pageSize, totalPages, totalItems }
   - Or receive table instance from useReactTable

3. Use hooks:
   - useRouter, usePathname, useSearchParams
   - useTransition for loading state

4. Display info:
   - "Showing X-Y of Z users" (calculate from page/pageSize/totalItems)
   - Current page indicator

5. Navigation buttons:
   - Previous button (disabled on page 1)
   - Next button (disabled on last page)
   - Optional: First/Last buttons
   - Use Cadence Button component

6. Page navigation:
   - Create URLSearchParams from current searchParams
   - Update page param
   - router.push with startTransition
   - Show loading state (opacity/disabled during transition)

7. Optional page size selector:
   - 25, 50, 100 options
   - Updates limit param and resets to page 1

Keep it simple - no "jump to page X" input (that would require offset pagination).
  </action>
  <verify>Click Next/Previous - URL page param changes, table updates</verify>
  <done>Pagination controls work via URL params</done>
</task>

<task type="auto">
  <name>Task 3: Create barrel export and wire to page</name>
  <files>src/app/(platform)/users/components/index.ts, src/app/(platform)/users/page.tsx</files>
  <action>
1. Create barrel export in src/app/(platform)/users/components/index.ts:
   - Export UserFilters
   - Export UserTable
   - Export UserTablePagination

2. Update users/page.tsx to use UserTable:
   - Import UserTable from './components'
   - Pass fetched users data and pagination to UserTable
   - Add UserTablePagination below table
   - Wrap table in Suspense with key={JSON.stringify(params)} to force re-render on param change

Table should now render with actual mock data from API.
  </action>
  <verify>Full /users page works: filters -> table -> pagination all connected</verify>
  <done>Complete user list with working pagination</done>
</task>

</tasks>

<verification>
1. Navigate to /users - table shows mock user data
2. Click a row - navigates to /users/user-X
3. Click Next - page 2 loads, URL shows ?page=2
4. Click Previous - back to page 1
5. Verify "Showing 1-50 of 100 users" text updates correctly
6. Verify loading state during pagination (buttons disabled or opacity)
</verification>

<success_criteria>
- Table renders with 5 columns
- Rows show user email, status badge, tier, last login
- Clicking row navigates to detail page
- Pagination buttons update URL and fetch new data
- Loading state visible during navigation
- Compact row height per CONTEXT.md
</success_criteria>

<output>
After completion, create `.planning/phases/02-user-management/02-04-SUMMARY.md`
</output>
