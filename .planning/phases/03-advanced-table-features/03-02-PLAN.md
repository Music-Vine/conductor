---
phase: 03-advanced-table-features
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/keyboard-shortcuts/shortcuts.ts
  - src/components/keyboard-shortcuts/ShortcutProvider.tsx
  - src/hooks/useKeyboardShortcuts.tsx
autonomous: true

must_haves:
  truths:
    - "Shortcuts are defined in a centralized location"
    - "ShortcutProvider wraps the app and provides shortcut context"
    - "useKeyboardShortcuts hook enables components to register shortcuts"
  artifacts:
    - path: "src/components/keyboard-shortcuts/shortcuts.ts"
      provides: "Centralized shortcut definitions"
      exports: ["shortcuts", "ShortcutCategory"]
    - path: "src/components/keyboard-shortcuts/ShortcutProvider.tsx"
      provides: "Context provider for keyboard shortcuts"
      exports: ["ShortcutProvider", "useShortcutContext"]
    - path: "src/hooks/useKeyboardShortcuts.tsx"
      provides: "Hook for registering shortcuts in components"
      exports: ["useKeyboardShortcuts"]
  key_links:
    - from: "src/components/keyboard-shortcuts/ShortcutProvider.tsx"
      to: "src/components/keyboard-shortcuts/shortcuts.ts"
      via: "imports shortcut definitions"
      pattern: "import.*shortcuts"
---

<objective>
Create keyboard shortcuts infrastructure with centralized definitions, context provider, and hooks for component integration.

Purpose: Enable power-user workflows with keyboard navigation. Shortcuts must be context-aware (different in tables vs forms) and discoverable via cheat sheet.
Output: Shortcut system ready to be wired into components in subsequent plans.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-advanced-table-features/03-CONTEXT.md
@.planning/phases/03-advanced-table-features/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shortcut definitions</name>
  <files>src/components/keyboard-shortcuts/shortcuts.ts</files>
  <action>
Create centralized shortcut definitions at `src/components/keyboard-shortcuts/shortcuts.ts`:

```typescript
export type ShortcutCategory = 'navigation' | 'actions' | 'table' | 'general'

export interface ShortcutDefinition {
  key: string           // Key combo for react-hotkeys-hook (e.g., 'mod+k', 'j')
  display: string       // Display string for UI (e.g., 'Cmd+K' or 'Ctrl+K')
  description: string   // Human-readable description
  category: ShortcutCategory
  scope?: string        // Optional scope (e.g., 'table') for context-aware shortcuts
}

export const shortcuts: ShortcutDefinition[] = [
  // Navigation
  { key: 'g u', display: 'G U', description: 'Go to Users', category: 'navigation' },
  { key: 'g a', display: 'G A', description: 'Go to Assets', category: 'navigation' },
  { key: 'g p', display: 'G P', description: 'Go to Payees', category: 'navigation' },

  // Actions
  { key: 'mod+k', display: 'Cmd+K', description: 'Open Command Palette', category: 'actions' },
  { key: 'mod+n', display: 'Cmd+N', description: 'Create New', category: 'actions' },
  { key: 'mod+e', display: 'Cmd+E', description: 'Export Data', category: 'actions' },

  // Table (context-aware - only active when table is focused)
  { key: 'j', display: 'J', description: 'Select Next Row', category: 'table', scope: 'table' },
  { key: 'k', display: 'K', description: 'Select Previous Row', category: 'table', scope: 'table' },
  { key: 'space', display: 'Space', description: 'Toggle Row Selection', category: 'table', scope: 'table' },
  { key: 'shift+j', display: 'Shift+J', description: 'Extend Selection Down', category: 'table', scope: 'table' },
  { key: 'shift+k', display: 'Shift+K', description: 'Extend Selection Up', category: 'table', scope: 'table' },
  { key: 'mod+a', display: 'Cmd+A', description: 'Select All Rows', category: 'table', scope: 'table' },
  { key: 'x', display: 'X', description: 'Open Actions Menu', category: 'table', scope: 'table' },

  // General
  { key: 'slash', display: '/', description: 'Focus Search', category: 'general' },
  { key: 'shift+/', display: '?', description: 'Show Keyboard Shortcuts', category: 'general' },
  { key: 'escape', display: 'Esc', description: 'Close Modal / Clear Selection', category: 'general' },
]

// Helper to get OS-aware modifier key display
export function getModifierDisplay(): string {
  if (typeof window === 'undefined') return 'Cmd'
  return /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform) ? 'Cmd' : 'Ctrl'
}

// Get shortcuts by category
export function getShortcutsByCategory(): Record<ShortcutCategory, ShortcutDefinition[]> {
  return shortcuts.reduce((acc, shortcut) => {
    if (!acc[shortcut.category]) acc[shortcut.category] = []
    acc[shortcut.category].push(shortcut)
    return acc
  }, {} as Record<ShortcutCategory, ShortcutDefinition[]>)
}
```

Key decisions:
- Use 'mod' prefix from react-hotkeys-hook for cross-platform Cmd/Ctrl
- Table shortcuts use single keys (j/k) for speed - only active when table focused
- Form-safe shortcuts use modifiers (Cmd+N) to avoid input conflicts
- Scope field enables context-aware activation
  </action>
  <verify>TypeScript compilation succeeds with `npx tsc --noEmit`</verify>
  <done>shortcuts.ts exports ShortcutDefinition type, shortcuts array, and helper functions</done>
</task>

<task type="auto">
  <name>Task 2: Create ShortcutProvider and useKeyboardShortcuts hook</name>
  <files>src/components/keyboard-shortcuts/ShortcutProvider.tsx, src/hooks/useKeyboardShortcuts.tsx</files>
  <action>
Create `src/components/keyboard-shortcuts/ShortcutProvider.tsx`:

```typescript
'use client'

import { createContext, useContext, useState, useCallback, type ReactNode } from 'react'

interface ShortcutContextValue {
  activeScope: string | null
  setActiveScope: (scope: string | null) => void
  isInputFocused: boolean
  setInputFocused: (focused: boolean) => void
}

const ShortcutContext = createContext<ShortcutContextValue | null>(null)

export function ShortcutProvider({ children }: { children: ReactNode }) {
  const [activeScope, setActiveScope] = useState<string | null>(null)
  const [isInputFocused, setInputFocused] = useState(false)

  return (
    <ShortcutContext.Provider
      value={{
        activeScope,
        setActiveScope,
        isInputFocused,
        setInputFocused,
      }}
    >
      {children}
    </ShortcutContext.Provider>
  )
}

export function useShortcutContext() {
  const context = useContext(ShortcutContext)
  if (!context) {
    throw new Error('useShortcutContext must be used within ShortcutProvider')
  }
  return context
}
```

Create `src/hooks/useKeyboardShortcuts.tsx`:

```typescript
'use client'

import { useHotkeys, type Options } from 'react-hotkeys-hook'
import { useShortcutContext } from '@/components/keyboard-shortcuts/ShortcutProvider'
import { useCallback } from 'react'

interface UseKeyboardShortcutsOptions {
  scope?: string  // Only fire if this scope is active (e.g., 'table')
  enabled?: boolean
  enableOnFormTags?: boolean  // Allow in inputs (default false for safety)
}

export function useKeyboardShortcuts(
  keys: string,
  callback: (event: KeyboardEvent) => void,
  options: UseKeyboardShortcutsOptions = {}
) {
  const { activeScope, isInputFocused } = useShortcutContext()
  const { scope, enabled = true, enableOnFormTags = false } = options

  // Determine if shortcut should be active
  const isEnabled = useCallback(() => {
    if (!enabled) return false
    if (isInputFocused && !enableOnFormTags) return false
    if (scope && activeScope !== scope) return false
    return true
  }, [enabled, isInputFocused, enableOnFormTags, scope, activeScope])

  const hotkeysOptions: Options = {
    enabled: isEnabled(),
    enableOnFormTags: enableOnFormTags ? ['INPUT', 'TEXTAREA', 'SELECT'] : false,
    preventDefault: true,
  }

  useHotkeys(keys, callback, hotkeysOptions, [callback, isEnabled])
}

// Hook for setting scope when a component mounts/focuses
export function useShortcutScope(scope: string) {
  const { setActiveScope } = useShortcutContext()

  const activate = useCallback(() => {
    setActiveScope(scope)
  }, [scope, setActiveScope])

  const deactivate = useCallback(() => {
    setActiveScope(null)
  }, [setActiveScope])

  return { activate, deactivate }
}
```

Key implementation details:
- ShortcutProvider manages global shortcut state (active scope, input focus)
- useKeyboardShortcuts wraps react-hotkeys-hook with scope awareness
- Single-key shortcuts disabled when input focused (safety)
- useShortcutScope helper for components to claim keyboard focus
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. Both files export expected functions
  </verify>
  <done>
- ShortcutProvider exports provider and context hook
- useKeyboardShortcuts handles scoped shortcuts with input safety
- useShortcutScope enables components to claim keyboard focus
  </done>
</task>

</tasks>

<verification>
After both tasks:
```bash
npx tsc --noEmit
```
Check that src/components/keyboard-shortcuts/ contains shortcuts.ts and ShortcutProvider.tsx
Check that src/hooks/ contains useKeyboardShortcuts.tsx
</verification>

<success_criteria>
- All three files created and TypeScript-valid
- Shortcuts defined with correct categories and scopes
- Context provider ready to wrap app
- Hooks ready for component integration
</success_criteria>

<output>
After completion, create `.planning/phases/03-advanced-table-features/03-02-SUMMARY.md`
</output>
