---
phase: 03-advanced-table-features
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/command-palette/CommandPalette.tsx
  - src/components/layout/Header.tsx
  - src/app/(platform)/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Staff can open command palette with Cmd+K"
    - "Staff can open command palette via visible button in Header"
    - "Staff can see navigation options in command palette"
    - "Staff can navigate to pages using command palette"
    - "Command palette closes on selection or Escape"
  artifacts:
    - path: "src/components/command-palette/CommandPalette.tsx"
      provides: "Command palette component"
      exports: ["CommandPalette"]
      min_lines: 80
    - path: "src/components/layout/Header.tsx"
      provides: "Header with command palette button"
      contains: "Cmd+K"
    - path: "src/app/(platform)/layout.tsx"
      provides: "Layout with CommandPalette mounted"
      contains: "CommandPalette"
  key_links:
    - from: "src/components/command-palette/CommandPalette.tsx"
      to: "next/navigation"
      via: "useRouter for navigation"
      pattern: "useRouter"
    - from: "src/components/layout/Header.tsx"
      to: "src/components/command-palette/CommandPalette.tsx"
      via: "button triggers command palette"
      pattern: "onOpenCommandPalette"
---

<objective>
Create the command palette component using cmdk with navigation actions, add a visible trigger button in the Header, and wire it into the app layout.

Purpose: Provide power users with fast keyboard-driven navigation across the admin interface. Command palette is a core UX pattern for modern admin tools. Per user decision, command palette must be accessible via BOTH Cmd+K keyboard shortcut AND a visible button in the UI.
Output: Working command palette accessible via Cmd+K AND Header button, with navigation to all main pages.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-advanced-table-features/03-CONTEXT.md
@.planning/phases/03-advanced-table-features/03-RESEARCH.md
@src/app/(platform)/layout.tsx
@src/components/layout/Header.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CommandPalette component</name>
  <files>src/components/command-palette/CommandPalette.tsx</files>
  <action>
Create `src/components/command-palette/CommandPalette.tsx`:

```typescript
'use client'

import { Command } from 'cmdk'
import { useRouter } from 'next/navigation'
import { useState, useEffect, useCallback } from 'react'

interface CommandPaletteProps {
  open?: boolean
  onOpenChange?: (open: boolean) => void
}

export function CommandPalette({ open: controlledOpen, onOpenChange }: CommandPaletteProps) {
  const [internalOpen, setInternalOpen] = useState(false)
  const open = controlledOpen ?? internalOpen
  const setOpen = onOpenChange ?? setInternalOpen
  const router = useRouter()

  // Handle Cmd+K to open
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === 'k' && (e.metaKey || e.ctrlKey)) {
        e.preventDefault()
        setOpen(!open)
      }
    }
    document.addEventListener('keydown', handleKeyDown)
    return () => document.removeEventListener('keydown', handleKeyDown)
  }, [open, setOpen])

  const handleSelect = useCallback((path: string) => {
    setOpen(false)
    router.push(path)
  }, [router, setOpen])

  // Get OS-aware modifier display
  const modKey = typeof window !== 'undefined' && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform) ? '⌘' : 'Ctrl'

  return (
    <Command.Dialog
      open={open}
      onOpenChange={setOpen}
      label="Command Palette"
      className="fixed inset-0 z-50"
    >
      {/* Backdrop */}
      <div className="fixed inset-0 bg-black/50" aria-hidden="true" />

      {/* Dialog container */}
      <div className="fixed inset-0 flex items-start justify-center pt-[20vh]">
        <div className="w-full max-w-lg overflow-hidden rounded-xl border border-gray-200 bg-white shadow-2xl">
          <Command.Input
            placeholder="Search for actions or pages..."
            className="w-full border-b border-gray-200 px-4 py-3 text-base outline-none placeholder:text-gray-400"
          />

          <Command.List className="max-h-80 overflow-y-auto p-2">
            <Command.Empty className="py-6 text-center text-sm text-gray-500">
              No results found.
            </Command.Empty>

            <Command.Group heading="Navigation" className="px-2 py-1.5">
              <span className="text-xs font-medium text-gray-500">Navigation</span>
              <CommandItem
                onSelect={() => handleSelect('/dashboard')}
                shortcut="G D"
              >
                Dashboard
              </CommandItem>
              <CommandItem
                onSelect={() => handleSelect('/users')}
                shortcut="G U"
              >
                Users
              </CommandItem>
              <CommandItem
                onSelect={() => handleSelect('/assets')}
                shortcut="G A"
              >
                Assets
              </CommandItem>
              <CommandItem
                onSelect={() => handleSelect('/payees')}
                shortcut="G P"
              >
                Payees
              </CommandItem>
            </Command.Group>

            <Command.Group heading="Actions" className="px-2 py-1.5">
              <span className="text-xs font-medium text-gray-500">Actions</span>
              <CommandItem
                onSelect={() => {/* Will be wired later */}}
                shortcut={`${modKey}N`}
              >
                Create New...
              </CommandItem>
              <CommandItem
                onSelect={() => {/* Will be wired later */}}
                shortcut={`${modKey}E`}
              >
                Export Data
              </CommandItem>
            </Command.Group>
          </Command.List>

          {/* Footer with keyboard hints */}
          <div className="flex items-center justify-between border-t border-gray-200 bg-gray-50 px-4 py-2 text-xs text-gray-500">
            <div className="flex items-center gap-4">
              <span><kbd className="rounded bg-gray-200 px-1.5 py-0.5">↑↓</kbd> to navigate</span>
              <span><kbd className="rounded bg-gray-200 px-1.5 py-0.5">↵</kbd> to select</span>
              <span><kbd className="rounded bg-gray-200 px-1.5 py-0.5">esc</kbd> to close</span>
            </div>
          </div>
        </div>
      </div>
    </Command.Dialog>
  )
}

// Styled command item with shortcut display
function CommandItem({
  children,
  onSelect,
  shortcut,
}: {
  children: React.ReactNode
  onSelect: () => void
  shortcut?: string
}) {
  return (
    <Command.Item
      onSelect={onSelect}
      className="flex cursor-pointer items-center justify-between rounded-lg px-3 py-2 text-sm text-gray-700 aria-selected:bg-gray-100"
    >
      <span>{children}</span>
      {shortcut && (
        <kbd className="rounded bg-gray-100 px-1.5 py-0.5 text-xs text-gray-500">
          {shortcut}
        </kbd>
      )}
    </Command.Item>
  )
}
```

Key implementation details:
- Uses cmdk's built-in Dialog which handles focus trap, portal, and accessibility
- Supports both uncontrolled (internal state) and controlled (open/onOpenChange props) modes
- Keyboard hints at bottom per CONTEXT decision
- Shortcut display next to each action
- OS-aware modifier key detection
- Clean minimal styling with Tailwind (matches Cadence aesthetic)
- Empty state with "No results found"
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. File exports CommandPalette component
  </verify>
  <done>CommandPalette component created with navigation items, keyboard hints, shortcut display, and controlled/uncontrolled mode support</done>
</task>

<task type="auto">
  <name>Task 2: Add command palette button to Header</name>
  <files>src/components/layout/Header.tsx</files>
  <action>
Update `src/components/layout/Header.tsx` to include command palette trigger button:

Add an `onOpenCommandPalette` prop to HeaderProps and render a search button:

```typescript
interface HeaderProps {
  title?: string
  userName: string
  userEmail: string
  onOpenCommandPalette?: () => void
}
```

Add the button in the header's right section (before UserMenu):

```typescript
{/* Command palette trigger button */}
<button
  onClick={onOpenCommandPalette}
  className="flex items-center gap-2 rounded-lg border border-gray-200 bg-gray-50 px-3 py-1.5 text-sm text-gray-500 transition-colors hover:border-gray-300 hover:bg-gray-100"
  aria-label="Open command palette"
  aria-keyshortcuts="Control+k Meta+k"
>
  <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
  </svg>
  <span>Search...</span>
  <kbd className="ml-2 rounded bg-gray-200 px-1.5 py-0.5 text-xs font-medium text-gray-600">
    {modKey}K
  </kbd>
</button>
```

Add OS-aware modifier key detection inside the component:
```typescript
const modKey = typeof window !== 'undefined' && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform) ? '⌘' : 'Ctrl'
```

Key additions:
- Search button with magnifying glass icon
- Keyboard shortcut hint (Cmd+K or Ctrl+K based on OS)
- onClick handler passed as prop (connected in layout)
- ARIA attributes for accessibility
- Matches Cadence design aesthetic
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. Header component has onOpenCommandPalette prop
  </verify>
  <done>Header has command palette button with keyboard hint and ARIA attributes</done>
</task>

<task type="auto">
  <name>Task 3: Mount CommandPalette in app layout with button wiring</name>
  <files>src/app/(platform)/layout.tsx</files>
  <action>
Update `src/app/(platform)/layout.tsx` to mount CommandPalette and wire the Header button:

1. Import CommandPalette at top of file
2. Add state for command palette open state
3. Pass state to CommandPalette for controlled mode
4. Pass onOpenCommandPalette to Header

Add imports:
```typescript
import { CommandPalette } from '@/components/command-palette/CommandPalette'
import { useState } from 'react'
```

Add state (make layout a client component if needed, or use a client wrapper):
```typescript
const [commandPaletteOpen, setCommandPaletteOpen] = useState(false)
```

Update Header:
```typescript
<Header
  // ...existing props
  onOpenCommandPalette={() => setCommandPaletteOpen(true)}
/>
```

Add CommandPalette with controlled state:
```typescript
<CommandPalette
  open={commandPaletteOpen}
  onOpenChange={setCommandPaletteOpen}
/>
```

Note: If the layout is a server component, create a client wrapper component that holds the state and renders both Header and CommandPalette.
  </action>
  <verify>
1. `npm run build` passes
2. Run dev server, press Cmd+K - palette should open
3. Click Header search button - palette should open
  </verify>
  <done>CommandPalette mounted in layout, accessible via BOTH Cmd+K AND Header button on all authenticated pages</done>
</task>

</tasks>

<verification>
After all tasks:
```bash
npm run build
npm run dev
```
Then manually test:
1. Press Cmd+K (or Ctrl+K on Windows/Linux) - palette should open
2. Click Header search button - palette should open
3. Type to filter navigation items
4. Press Enter on a navigation item - should navigate and close
5. Press Escape - should close
</verification>

<success_criteria>
- CommandPalette component created with navigation actions
- Header has visible search button with Cmd+K hint
- Clicking Header button opens command palette
- Cmd+K keyboard shortcut opens command palette
- Navigation works (routes to correct pages)
- Closes on Escape or selection
- Keyboard hints visible at bottom
</success_criteria>

<output>
After completion, create `.planning/phases/03-advanced-table-features/03-03-SUMMARY.md`
</output>
