---
phase: 03-advanced-table-features
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/command-palette/CommandPalette.tsx
  - src/app/(platform)/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Staff can open command palette with Cmd+K"
    - "Staff can see navigation options in command palette"
    - "Staff can navigate to pages using command palette"
    - "Command palette closes on selection or Escape"
  artifacts:
    - path: "src/components/command-palette/CommandPalette.tsx"
      provides: "Command palette component"
      exports: ["CommandPalette"]
      min_lines: 80
    - path: "src/app/(platform)/layout.tsx"
      provides: "Layout with CommandPalette mounted"
      contains: "CommandPalette"
  key_links:
    - from: "src/components/command-palette/CommandPalette.tsx"
      to: "next/navigation"
      via: "useRouter for navigation"
      pattern: "useRouter"
---

<objective>
Create the command palette component using cmdk with navigation actions and wire it into the app layout.

Purpose: Provide power users with fast keyboard-driven navigation across the admin interface. Command palette is a core UX pattern for modern admin tools.
Output: Working command palette accessible via Cmd+K with navigation to all main pages.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-advanced-table-features/03-CONTEXT.md
@.planning/phases/03-advanced-table-features/03-RESEARCH.md
@src/app/(platform)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CommandPalette component</name>
  <files>src/components/command-palette/CommandPalette.tsx</files>
  <action>
Create `src/components/command-palette/CommandPalette.tsx`:

```typescript
'use client'

import { Command } from 'cmdk'
import { useRouter } from 'next/navigation'
import { useState, useEffect, useCallback } from 'react'

interface CommandPaletteProps {
  onOpenChange?: (open: boolean) => void
}

export function CommandPalette({ onOpenChange }: CommandPaletteProps) {
  const [open, setOpen] = useState(false)
  const router = useRouter()

  // Handle Cmd+K to open
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === 'k' && (e.metaKey || e.ctrlKey)) {
        e.preventDefault()
        setOpen((prev) => !prev)
      }
    }
    document.addEventListener('keydown', handleKeyDown)
    return () => document.removeEventListener('keydown', handleKeyDown)
  }, [])

  // Notify parent of state changes
  useEffect(() => {
    onOpenChange?.(open)
  }, [open, onOpenChange])

  const handleSelect = useCallback((path: string) => {
    setOpen(false)
    router.push(path)
  }, [router])

  // Get OS-aware modifier display
  const modKey = typeof window !== 'undefined' && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform) ? '⌘' : 'Ctrl'

  return (
    <Command.Dialog
      open={open}
      onOpenChange={setOpen}
      label="Command Palette"
      className="fixed inset-0 z-50"
    >
      {/* Backdrop */}
      <div className="fixed inset-0 bg-black/50" aria-hidden="true" />

      {/* Dialog container */}
      <div className="fixed inset-0 flex items-start justify-center pt-[20vh]">
        <div className="w-full max-w-lg overflow-hidden rounded-xl border border-gray-200 bg-white shadow-2xl">
          <Command.Input
            placeholder="Search for actions or pages..."
            className="w-full border-b border-gray-200 px-4 py-3 text-base outline-none placeholder:text-gray-400"
          />

          <Command.List className="max-h-80 overflow-y-auto p-2">
            <Command.Empty className="py-6 text-center text-sm text-gray-500">
              No results found.
            </Command.Empty>

            <Command.Group heading="Navigation" className="px-2 py-1.5">
              <span className="text-xs font-medium text-gray-500">Navigation</span>
              <CommandItem
                onSelect={() => handleSelect('/dashboard')}
                shortcut="G D"
              >
                Dashboard
              </CommandItem>
              <CommandItem
                onSelect={() => handleSelect('/users')}
                shortcut="G U"
              >
                Users
              </CommandItem>
              <CommandItem
                onSelect={() => handleSelect('/assets')}
                shortcut="G A"
              >
                Assets
              </CommandItem>
              <CommandItem
                onSelect={() => handleSelect('/payees')}
                shortcut="G P"
              >
                Payees
              </CommandItem>
            </Command.Group>

            <Command.Group heading="Actions" className="px-2 py-1.5">
              <span className="text-xs font-medium text-gray-500">Actions</span>
              <CommandItem
                onSelect={() => {/* Will be wired later */}}
                shortcut={`${modKey}N`}
              >
                Create New...
              </CommandItem>
              <CommandItem
                onSelect={() => {/* Will be wired later */}}
                shortcut={`${modKey}E`}
              >
                Export Data
              </CommandItem>
            </Command.Group>
          </Command.List>

          {/* Footer with keyboard hints */}
          <div className="flex items-center justify-between border-t border-gray-200 bg-gray-50 px-4 py-2 text-xs text-gray-500">
            <div className="flex items-center gap-4">
              <span><kbd className="rounded bg-gray-200 px-1.5 py-0.5">↑↓</kbd> to navigate</span>
              <span><kbd className="rounded bg-gray-200 px-1.5 py-0.5">↵</kbd> to select</span>
              <span><kbd className="rounded bg-gray-200 px-1.5 py-0.5">esc</kbd> to close</span>
            </div>
          </div>
        </div>
      </div>
    </Command.Dialog>
  )
}

// Styled command item with shortcut display
function CommandItem({
  children,
  onSelect,
  shortcut,
}: {
  children: React.ReactNode
  onSelect: () => void
  shortcut?: string
}) {
  return (
    <Command.Item
      onSelect={onSelect}
      className="flex cursor-pointer items-center justify-between rounded-lg px-3 py-2 text-sm text-gray-700 aria-selected:bg-gray-100"
    >
      <span>{children}</span>
      {shortcut && (
        <kbd className="rounded bg-gray-100 px-1.5 py-0.5 text-xs text-gray-500">
          {shortcut}
        </kbd>
      )}
    </Command.Item>
  )
}
```

Key implementation details:
- Uses cmdk's built-in Dialog which handles focus trap, portal, and accessibility
- Keyboard hints at bottom per CONTEXT decision
- Shortcut display next to each action
- OS-aware modifier key detection
- Clean minimal styling with Tailwind (matches Cadence aesthetic)
- Empty state with "No results found"
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. File exports CommandPalette component
  </verify>
  <done>CommandPalette component created with navigation items, keyboard hints, and shortcut display</done>
</task>

<task type="auto">
  <name>Task 2: Mount CommandPalette in app layout</name>
  <files>src/app/(platform)/layout.tsx</files>
  <action>
Update `src/app/(platform)/layout.tsx` to mount CommandPalette:

1. Import CommandPalette at top of file
2. Add CommandPalette component inside the layout, after other providers but before children

The CommandPalette should be rendered once at the layout level so it's available on all pages.

Add this import:
```typescript
import { CommandPalette } from '@/components/command-palette/CommandPalette'
```

Add CommandPalette in the render, typically after any providers but before the main content:
```typescript
<CommandPalette />
```

Note: The component uses portal rendering internally so placement doesn't affect visual position.
  </action>
  <verify>
1. `npm run build` passes
2. Run dev server, press Cmd+K - palette should open
  </verify>
  <done>CommandPalette mounted in layout, accessible via Cmd+K on all authenticated pages</done>
</task>

</tasks>

<verification>
After both tasks:
```bash
npm run build
npm run dev
```
Then manually test:
1. Press Cmd+K (or Ctrl+K on Windows/Linux) - palette should open
2. Type to filter navigation items
3. Press Enter on a navigation item - should navigate and close
4. Press Escape - should close
</verification>

<success_criteria>
- CommandPalette component created with navigation actions
- Mounted in platform layout
- Opens on Cmd+K
- Navigation works (routes to correct pages)
- Closes on Escape or selection
- Keyboard hints visible at bottom
</success_criteria>

<output>
After completion, create `.planning/phases/03-advanced-table-features/03-03-SUMMARY.md`
</output>
