---
phase: 06-payee-and-contributor-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/financial.ts
  - src/types/index.ts
  - src/lib/validation/financial.ts
autonomous: true

must_haves:
  truths:
    - "Contributor and Payee types are defined with all required fields"
    - "ContributorPayee junction type models many-to-many with percentage metadata"
    - "Zod schemas validate percentage rates as integers 0-100"
    - "Zod refinement validates payee percentages sum to exactly 100%"
  artifacts:
    - path: "src/types/financial.ts"
      provides: "Contributor, Payee, ContributorPayee, ContributorListItem, PayeeListItem types"
      contains: "ContributorPayee"
    - path: "src/lib/validation/financial.ts"
      provides: "Zod schemas for contributor, payee, and rate validation"
      contains: "contributorPayeesSchema"
  key_links:
    - from: "src/types/financial.ts"
      to: "src/types/index.ts"
      via: "re-export"
      pattern: "export.*financial"
---

<objective>
Define TypeScript types and Zod validation schemas for contributor, payee, and financial relationship management.

Purpose: Establish the type foundation that all Phase 6 plans depend on. Types define the data model; validation schemas enforce business rules (percentage rates must be integers 0-100, must sum to 100% per contributor).
Output: `src/types/financial.ts` with all types, `src/lib/validation/financial.ts` with zod schemas, updated `src/types/index.ts` re-export.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-payee-and-contributor-management/06-RESEARCH.md
@src/types/user.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create financial types</name>
  <files>src/types/financial.ts, src/types/index.ts</files>
  <action>
Create `src/types/financial.ts` with the following types. Follow the same patterns as `src/types/user.ts` (string literal unions for status, JSDoc comments, separate ListItem types for table display):

**ContributorStatus:** `'active' | 'inactive' | 'pending'` string literal union

**PayeeStatus:** `'active' | 'inactive'` string literal union

**PaymentMethod:** `'ach' | 'wire' | 'check' | 'paypal'` string literal union

**Contributor:** Full contributor entity
- id: string
- name: string
- email: string
- phone?: string
- taxId?: string (masked EIN or SSN)
- address?: { street: string; city: string; state: string; zip: string; country: string }
- status: ContributorStatus
- totalAssets: number (count of associated assets)
- totalPayees: number (count of assigned payees)
- createdAt: string
- updatedAt: string

**ContributorListItem:** Simplified for table display (id, name, email, status, totalAssets, totalPayees, createdAt)

**ContributorSearchParams:** query?, status?, page?, limit? (follows UserSearchParams pattern)

**Payee:** Full payee entity
- id: string
- name: string
- email: string
- phone?: string
- taxId?: string
- paymentMethod: PaymentMethod
- paymentDetails: { accountNumber?: string; routingNumber?: string; paypalEmail?: string }
- address?: { street: string; city: string; state: string; zip: string; country: string }
- status: PayeeStatus
- totalContributors: number
- createdAt: string
- updatedAt: string

**PayeeListItem:** Simplified for table display (id, name, email, paymentMethod, status, totalContributors, createdAt)

**PayeeSearchParams:** query?, status?, paymentMethod?, page?, limit?

**ContributorPayee:** Junction table type for many-to-many relationship
- contributorId: string
- payeeId: string
- payeeName: string
- payeeEmail: string
- paymentMethod: PaymentMethod
- percentageRate: number (integer 0-100)
- effectiveDate: string
- notes?: string
- createdAt: string
- updatedAt: string

**ContributorPayeeRelationship:** Combined view for display
- id: string (composite contributorId-payeeId)
- contributor: Contributor
- payee: Payee
- percentageRate: number
- effectiveDate: string
- notes?: string

**FinancialExportRow:** Flat structure for CSV export
- contributorId, contributorName, contributorEmail, contributorStatus
- payeeId, payeeName, payeeEmail, payeePaymentMethod, payeeStatus
- percentageRate (number), effectiveDate
- createdAt, updatedAt

Then update `src/types/index.ts` to add `export * from './financial'`.
  </action>
  <verify>Run `npx tsc --noEmit` and confirm no type errors. Verify financial.ts exports are accessible via `@/types`.</verify>
  <done>All financial types defined with JSDoc comments, re-exported from types/index.ts, TypeScript compiles cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Create financial validation schemas</name>
  <files>src/lib/validation/financial.ts</files>
  <action>
Create `src/lib/validation/financial.ts` with Zod schemas. Follow existing validation patterns in the project (zod v4.3.6 already installed).

**contributorSchema:** Validates contributor creation/edit
- name: z.string().min(1, 'Name is required').max(100)
- email: z.string().email('Invalid email address')
- phone: z.string().optional()
- taxId: z.string().optional()
- address: z.object({ street, city, state, zip, country }).optional()

**payeeSchema:** Validates payee creation/edit
- name: z.string().min(1, 'Name is required').max(100)
- email: z.string().email('Invalid email address')
- phone: z.string().optional()
- taxId: z.string().optional()
- paymentMethod: z.enum(['ach', 'wire', 'check', 'paypal'])
- paymentDetails: z.object({ accountNumber, routingNumber, paypalEmail }).optional()
- address: z.object({ street, city, state, zip, country }).optional()

**percentageRateSchema:** Validates individual payee rate assignment
- payeeId: z.string().min(1, 'Payee is required')
- percentageRate: z.number().int('Must be a whole number').min(0).max(100)
- effectiveDate: z.string().min(1, 'Effective date is required')
- notes: z.string().optional()

**contributorPayeesSchema:** Validates full payee assignment for a contributor
- contributorId: z.string()
- payees: z.array(percentageRateSchema).min(1, 'At least one payee required')
  - Add .refine() that validates sum of percentageRate === 100 with message 'Payee percentages must sum to exactly 100%'

**Helper functions:**
- `calculateRemainingPercentage(rates: Array<{percentageRate: number}>): number` - returns 100 minus sum, min 0
- `formatPercentageError(rates: Array<{percentageRate: number}>): string` - returns human-readable error (e.g., "Total is 80%. Please assign the remaining 20%.")

IMPORTANT: Store percentages as integers (0-100) to avoid floating-point arithmetic errors. The zod schema uses .int() to enforce whole numbers.
  </action>
  <verify>Run `npx tsc --noEmit` to confirm no type errors. The validation schemas should import cleanly.</verify>
  <done>Zod schemas validate contributor/payee creation, individual rate 0-100 integer range, and multi-payee sum-to-100% refinement. Helper functions calculate remaining percentage and format error messages.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `src/types/financial.ts` exports Contributor, Payee, ContributorPayee, ContributorListItem, PayeeListItem types
3. `src/types/index.ts` re-exports financial types
4. `src/lib/validation/financial.ts` exports contributorSchema, payeeSchema, percentageRateSchema, contributorPayeesSchema
5. Percentage validation enforces integer 0-100 range and sum-to-100% constraint
</verification>

<success_criteria>
- All financial TypeScript types compile without errors
- Zod schemas validate percentage rates as integers and enforce 100% sum
- Types follow existing project conventions (string literal unions, JSDoc, ListItem pattern)
- Financial types accessible via @/types import
</success_criteria>

<output>
After completion, create `.planning/phases/06-payee-and-contributor-management/06-01-SUMMARY.md`
</output>
