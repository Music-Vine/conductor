---
phase: 06-payee-and-contributor-management
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - src/lib/api/contributors.ts
  - src/lib/api/payees.ts
  - src/lib/api/index.ts
  - src/app/(platform)/contributors/page.tsx
  - src/app/(platform)/contributors/loading.tsx
  - src/app/(platform)/contributors/components/ContributorTable.tsx
  - src/app/(platform)/contributors/components/ContributorFilters.tsx
  - src/app/(platform)/contributors/components/index.ts
autonomous: true

must_haves:
  truths:
    - "Staff can view a paginated list of contributors with name, email, status, asset count, and payee count"
    - "Staff can search contributors by name or email via search button"
    - "Staff can filter contributors by status (all, active, inactive, pending)"
    - "Staff can navigate between pages of contributor results"
    - "Clicking a contributor row navigates to the contributor detail page"
  artifacts:
    - path: "src/lib/api/contributors.ts"
      provides: "fetchContributors, fetchContributor API functions"
      exports: ["fetchContributors", "fetchContributor"]
    - path: "src/app/(platform)/contributors/page.tsx"
      provides: "Server component for contributor list page"
      contains: "ContributorFilters"
    - path: "src/app/(platform)/contributors/components/ContributorTable.tsx"
      provides: "TanStack Table with virtualization for contributor data"
      contains: "useReactTable"
  key_links:
    - from: "src/app/(platform)/contributors/page.tsx"
      to: "src/lib/api/contributors.ts"
      via: "server-side fetch"
      pattern: "fetchContributors"
    - from: "src/app/(platform)/contributors/components/ContributorTable.tsx"
      to: "/contributors/[id]"
      via: "router.push on row click"
      pattern: "router.push.*contributors"
---

<objective>
Create API client functions and the contributor list page with table, search, filters, and pagination.

Purpose: Enable staff to browse and search all contributors (PAYE-04). Follows Phase 2 user management page patterns exactly: server component page with URL-based filters, TanStack Table with virtualization, and server-side pagination.
Output: Working contributor list page at /contributors with search, status filter, and paginated table.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/api/users.ts
@src/app/(platform)/users/page.tsx
@src/app/(platform)/users/components/UserFilters.tsx
@src/app/(platform)/users/components/UserTable.tsx
@src/app/(platform)/users/components/UserListClient.tsx
@src/types/financial.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create API client functions for contributors and payees</name>
  <files>src/lib/api/contributors.ts, src/lib/api/payees.ts, src/lib/api/index.ts</files>
  <action>
Create API client functions following the `src/lib/api/users.ts` pattern exactly.

**src/lib/api/contributors.ts:**
- `fetchContributors(params: ContributorSearchParams)`: Build URLSearchParams from query, status, page, limit. Call `apiClient.get<PaginatedResponse<ContributorListItem>>('/contributors?...')`.
- `fetchContributor(id: string)`: Call `apiClient.get<Contributor>('/contributors/${id}')`.
- `fetchContributorPayees(id: string)`: Call `apiClient.get('/contributors/${id}/payees')` returning array of ContributorPayee relationships.
- `fetchContributorAssets(id: string)`: Call `apiClient.get('/contributors/${id}/assets')`.
- `createContributor(data)`: Call `apiClient.post('/contributors', data)`.
- `updateContributor(id, data)`: Call `apiClient.put('/contributors/${id}', data)`.
- `saveContributorPayees(id, payees)`: Call `apiClient.post('/contributors/${id}/payees', { payees })`.

**src/lib/api/payees.ts:**
- `fetchPayees(params: PayeeSearchParams)`: Build URLSearchParams from query, status, paymentMethod, page, limit. Call `apiClient.get<PaginatedResponse<PayeeListItem>>('/payees?...')`.
- `fetchPayee(id: string)`: Call `apiClient.get<Payee>('/payees/${id}')`.
- `fetchPayeeContributors(id: string)`: Call `apiClient.get('/payees/${id}/contributors')`.
- `createPayee(data)`: Call `apiClient.post('/payees', data)`.
- `updatePayee(id, data)`: Call `apiClient.put('/payees/${id}', data)`.

**src/lib/api/index.ts:** Add re-exports for contributors and payees modules.

Import types from `@/types` (ContributorSearchParams, ContributorListItem, Contributor, PayeeSearchParams, PayeeListItem, Payee, etc.).
  </action>
  <verify>Run `npx tsc --noEmit` to confirm all API functions compile with correct types.</verify>
  <done>API client functions for contributors and payees follow the users.ts pattern, typed correctly, re-exported from index.</done>
</task>

<task type="auto">
  <name>Task 2: Create contributor list page with table and filters</name>
  <files>src/app/(platform)/contributors/page.tsx, src/app/(platform)/contributors/loading.tsx, src/app/(platform)/contributors/components/ContributorTable.tsx, src/app/(platform)/contributors/components/ContributorFilters.tsx, src/app/(platform)/contributors/components/index.ts</files>
  <action>
Create the contributor list page following the users page pattern exactly (see src/app/(platform)/users/).

**ContributorFilters.tsx:** Client component matching UserFilters.tsx pattern.
- Search input with Search button (button-triggered, not auto-search)
- Status dropdown: All Statuses, Active, Inactive, Pending
- URL-based state management with useRouter, useSearchParams
- Page resets to 1 on filter change
- Same styling as UserFilters (select dropdown styles, flex layout)

**ContributorTable.tsx:** Client component matching UserTable.tsx pattern.
- TanStack Table with columns: Name (with email subtitle), Status (badge), Assets (count), Payees (count), Created (date)
- Status badges: active=green, inactive=red, pending=yellow
- Row click navigates to /contributors/[id] using router.push
- Use virtualization from Phase 3 pattern (useVirtualizedTable hook if it exists, or same fixed-height row pattern)
- Pagination component at bottom (same as UserTablePagination pattern)

**page.tsx:** Server component matching users/page.tsx pattern.
- Accept searchParams promise (Next.js 15 async pattern)
- Parse query, status, page params
- Call fetchContributors server-side
- Render page header "Contributors" with subtitle "Manage contributor profiles and payee assignments"
- Render ContributorFilters, then results table
- Wrap in Suspense with TableRowSkeleton fallback

**loading.tsx:** Same pattern as users/loading.tsx - show skeleton.

**components/index.ts:** Barrel export for ContributorTable, ContributorFilters.

The "Add Contributor" button should be placed in the page header area. Link to /contributors/new (page will be created in a later plan).
  </action>
  <verify>Run `npx tsc --noEmit`. Start dev server and visit /contributors. Verify table shows 20 contributors, search filters work, pagination works, row click navigates to detail (404 is expected at this stage).</verify>
  <done>Contributor list page shows paginated table with search, status filter, and row navigation. Follows Phase 2 user management pattern exactly.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. /contributors page loads with 20 contributors in table
3. Search by name/email filters results correctly
4. Status dropdown filters by active/inactive/pending
5. Pagination navigates between pages
6. Row click navigates to /contributors/[id]
7. API client functions properly typed and re-exported
</verification>

<success_criteria>
- Contributor list page functional with search, filtering, and pagination
- API client follows established patterns from users.ts
- Table displays contributor name, email, status, asset count, payee count, created date
- URL-based filter state enables shareable links and browser navigation
</success_criteria>

<output>
After completion, create `.planning/phases/06-payee-and-contributor-management/06-03-SUMMARY.md`
</output>
