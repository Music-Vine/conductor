---
phase: 06-payee-and-contributor-management
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/api/contributors/route.ts
  - src/app/api/contributors/[id]/route.ts
  - src/app/api/contributors/[id]/payees/route.ts
  - src/app/api/contributors/[id]/assets/route.ts
  - src/app/api/payees/route.ts
  - src/app/api/payees/[id]/route.ts
  - src/app/api/payees/[id]/contributors/route.ts
  - src/app/api/financials/export/route.ts
  - src/middleware.ts
autonomous: true

must_haves:
  truths:
    - "GET /api/contributors returns paginated contributor list with search and status filtering"
    - "POST /api/contributors creates a new contributor and returns 201"
    - "GET /api/contributors/[id] returns full contributor detail"
    - "GET /api/contributors/[id]/payees returns assigned payees with percentage rates"
    - "POST /api/contributors/[id]/payees saves payee assignments with 100% sum validation"
    - "GET /api/payees returns paginated payee list with search and filtering"
    - "GET /api/payees/[id] returns full payee detail"
    - "GET /api/financials/export returns all relationship data for CSV export"
  artifacts:
    - path: "src/app/api/contributors/route.ts"
      provides: "List + create contributors"
      exports: ["GET", "POST"]
    - path: "src/app/api/contributors/[id]/route.ts"
      provides: "Get + update single contributor"
      exports: ["GET", "PUT"]
    - path: "src/app/api/contributors/[id]/payees/route.ts"
      provides: "Manage contributor-payee relationships"
      exports: ["GET", "POST"]
    - path: "src/app/api/payees/route.ts"
      provides: "List + create payees"
      exports: ["GET", "POST"]
    - path: "src/app/api/payees/[id]/route.ts"
      provides: "Get + update single payee"
      exports: ["GET", "PUT"]
  key_links:
    - from: "src/middleware.ts"
      to: "/api/contributors"
      via: "PUBLIC_PATHS array"
      pattern: "api/contributors"
    - from: "src/middleware.ts"
      to: "/api/payees"
      via: "PUBLIC_PATHS array"
      pattern: "api/payees"
    - from: "src/middleware.ts"
      to: "/api/financials"
      via: "PUBLIC_PATHS array"
      pattern: "api/financials"
---

<objective>
Create mock API routes for contributors, payees, and their relationships with realistic seeded data.

Purpose: Provide backend endpoints for all Phase 6 UI components to consume. Mock APIs simulate real behavior with pagination, filtering, search, CRUD operations, and percentage rate validation. Follows Phase 2/4 mock data patterns.
Output: Complete set of API routes for contributors, payees, relationships, and financial export. Middleware updated to allow access.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-payee-and-contributor-management/06-RESEARCH.md
@src/app/api/users/route.ts
@src/app/api/users/[id]/route.ts
@src/middleware.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create contributor and payee mock API routes</name>
  <files>src/app/api/contributors/route.ts, src/app/api/contributors/[id]/route.ts, src/app/api/payees/route.ts, src/app/api/payees/[id]/route.ts</files>
  <action>
Create mock API routes following Phase 2 user API patterns (see src/app/api/users/route.ts for reference).

**Contributors list route (src/app/api/contributors/route.ts):**
- GET: Generate 20 mock contributors using seeded data (names from research doc). Support query, status, page, limit params. Sort by name. Return { data: [], pagination: { page, limit, total, totalPages } }. Add 150ms latency.
- POST: Accept { name, email, phone?, taxId? }. Validate name+email required. Return 201 with created contributor (status: 'pending'). Add 200ms latency.
- Use consistent ID format: `contrib-001` through `contrib-020`
- Status distribution: 18 active, 1 pending, 1 inactive

**Contributor detail route (src/app/api/contributors/[id]/route.ts):**
- GET: Return full contributor detail with address, phone, taxId. Use Next.js 15 async params pattern: `{ params }: { params: Promise<{ id: string }> }`. Add 100ms latency.
- PUT: Accept partial update body, return updated contributor. Add 200ms latency.

**Payees list route (src/app/api/payees/route.ts):**
- GET: Generate 10 mock payees (publishing companies, personal accounts). Support query, status, paymentMethod, page, limit params. Return paginated response. Add 150ms latency.
- POST: Accept { name, email, paymentMethod, paymentDetails? }. Return 201. Add 200ms latency.
- Use ID format: `payee-001` through `payee-010`
- Payment methods distributed: 4 ACH, 3 PayPal, 2 wire, 1 check
- Names like: "Main Publishing LLC", "Alex Thompson Personal", "Studio Pro Inc", "Indie Music Group", etc.

**Payee detail route (src/app/api/payees/[id]/route.ts):**
- GET: Return full payee detail with payment details and address. Use Next.js 15 async params pattern.
- PUT: Accept partial update, return updated payee. Add 200ms latency.
  </action>
  <verify>Run `npx tsc --noEmit`. Then use curl to test: `curl http://localhost:3000/api/contributors | jq .pagination` and `curl http://localhost:3000/api/payees | jq .pagination`.</verify>
  <done>Contributor and payee CRUD endpoints return realistic mock data with pagination, search, and filtering.</done>
</task>

<task type="auto">
  <name>Task 2: Create relationship routes, financial export, and update middleware</name>
  <files>src/app/api/contributors/[id]/payees/route.ts, src/app/api/contributors/[id]/assets/route.ts, src/app/api/payees/[id]/contributors/route.ts, src/app/api/financials/export/route.ts, src/middleware.ts</files>
  <action>
**Contributor payees route (src/app/api/contributors/[id]/payees/route.ts):**
- GET: Return mock payee relationships for a contributor. Generate 1-3 payees per contributor using contributor ID seed. Each relationship includes payeeId, payeeName, payeeEmail, paymentMethod, percentageRate, effectiveDate, notes. Rates MUST sum to exactly 100%.
  - For contrib with 1 payee: 100%
  - For contrib with 2 payees: 70%/30% or 60%/40%
  - For contrib with 3 payees: 50%/30%/20% or 40%/35%/25%
- POST: Accept { payees: [{ payeeId, percentageRate, effectiveDate, notes? }] }. Validate: payees array required, sum must equal 100%. Return 400 with error if sum !== 100. Return 200 with success message. Add 200ms latency.

**Contributor assets route (src/app/api/contributors/[id]/assets/route.ts):**
- GET: Return 5-15 mock assets associated with a contributor. Use contributor ID for seeded generation. Include id, title, type, status, createdAt fields. Add 100ms latency.

**Payee contributors route (src/app/api/payees/[id]/contributors/route.ts):**
- GET: Return contributors associated with this payee (reverse lookup). Generate 1-4 contributors per payee. Include contributorId, contributorName, percentageRate, effectiveDate. Add 100ms latency.

**Financial export route (src/app/api/financials/export/route.ts):**
- GET: Return all contributor-payee relationships in flat format for CSV export. Each row: contributorId, contributorName, contributorEmail, contributorStatus, payeeId, payeeName, payeeEmail, payeePaymentMethod, payeeStatus, percentageRate (as decimal 0.00-1.00 for accounting), effectiveDate, createdAt, updatedAt. No pagination (returns all ~40 relationships). Add 200ms latency.

**Middleware update (src/middleware.ts):**
- Add `/api/contributors`, `/api/payees`, and `/api/financials` to the PUBLIC_PATHS array for mock development access.
  </action>
  <verify>Run `npx tsc --noEmit`. Test relationship endpoint: `curl http://localhost:3000/api/contributors/contrib-001/payees | jq '.data | map(.percentageRate) | add'` should return 100.</verify>
  <done>All relationship API routes return valid data with 100% rate sums. Financial export returns flat CSV-ready data. Middleware allows access to all new API paths.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. GET /api/contributors returns 20 contributors with pagination
3. GET /api/payees returns 10 payees with pagination
4. GET /api/contributors/contrib-001/payees returns relationships with rates summing to 100
5. POST /api/contributors/contrib-001/payees with rates not summing to 100 returns 400
6. GET /api/financials/export returns all relationships in flat format
7. Middleware PUBLIC_PATHS includes /api/contributors, /api/payees, /api/financials
</verification>

<success_criteria>
- All mock API routes return realistic data with proper pagination
- Contributor-payee relationships always have rates summing to exactly 100%
- Financial export returns decimal rates (0.00-1.00) for accounting compatibility
- Middleware updated for development access
</success_criteria>

<output>
After completion, create `.planning/phases/06-payee-and-contributor-management/06-02-SUMMARY.md`
</output>
