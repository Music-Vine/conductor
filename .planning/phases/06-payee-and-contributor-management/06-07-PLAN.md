---
phase: 06-payee-and-contributor-management
plan: 07
type: execute
wave: 4
depends_on: ["06-04", "06-05"]
files_modified:
  - src/lib/utils/export-csv.ts
  - src/app/(platform)/contributors/components/ExportContributorsButton.tsx
  - src/app/(platform)/contributors/page.tsx
  - src/app/(platform)/payees/components/ExportPayeesButton.tsx
  - src/app/(platform)/payees/page.tsx
  - src/components/layout/Sidebar.tsx
  - src/app/api/search/route.ts
  - src/hooks/useGlobalSearch.tsx
autonomous: true

must_haves:
  truths:
    - "Staff can export contributor list to CSV"
    - "Staff can export payee list to CSV"
    - "Staff can export all financial relationship data to CSV for accounting"
    - "Contributors and Payees appear in the sidebar navigation"
    - "Contributors and payees appear in global search results"
  artifacts:
    - path: "src/lib/utils/export-csv.ts"
      provides: "CSV export functions for contributors, payees, and financial data"
      contains: "exportContributorsToCSV"
    - path: "src/components/layout/Sidebar.tsx"
      provides: "Navigation with Contributors and Payees links"
      contains: "Contributors"
    - path: "src/app/api/search/route.ts"
      provides: "Global search including contributors"
      contains: "contributor"
  key_links:
    - from: "src/app/(platform)/contributors/page.tsx"
      to: "src/lib/utils/export-csv.ts"
      via: "ExportContributorsButton"
      pattern: "exportContributorsToCSV"
    - from: "src/components/layout/Sidebar.tsx"
      to: "/contributors"
      via: "NavItem href"
      pattern: "href.*contributors"
    - from: "src/app/api/search/route.ts"
      to: "mockContributors"
      via: "searchable data"
      pattern: "type.*contributor"
---

<objective>
Add CSV export for financial data, integrate contributors and payees into sidebar navigation, and update global search to include contributors.

Purpose: Complete the export requirement (PAYE-05) and navigation integration so staff can discover and access contributor/payee management from anywhere in the application.
Output: CSV export buttons on contributor and payee list pages, sidebar links for Contributors and Payees, global search includes contributors.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/utils/export-csv.ts
@src/app/(platform)/users/components/ExportUsersButton.tsx
@src/components/layout/Sidebar.tsx
@src/app/api/search/route.ts
@src/hooks/useGlobalSearch.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CSV export functions and buttons for contributors and payees</name>
  <files>src/lib/utils/export-csv.ts, src/app/(platform)/contributors/components/ExportContributorsButton.tsx, src/app/(platform)/contributors/page.tsx, src/app/(platform)/payees/components/ExportPayeesButton.tsx, src/app/(platform)/payees/page.tsx</files>
  <action>
**Update src/lib/utils/export-csv.ts:** Add three new export functions following the existing exportUsersToCSV pattern.

`exportContributorsToCSV(contributors: ContributorListItem[])`:
- Filename: `contributors-{timestamp}.csv`
- Columns: Contributor ID, Name, Email, Status, Total Assets, Total Payees, Created
- Import ContributorListItem from @/types

`exportPayeesToCSV(payees: PayeeListItem[])`:
- Filename: `payees-{timestamp}.csv`
- Columns: Payee ID, Name, Email, Payment Method, Status, Total Contributors, Created
- Import PayeeListItem from @/types

`exportFinancialDataToCSV(relationships: FinancialExportRow[])`:
- Filename: `financial-data-{timestamp}.csv`
- Columns: Contributor ID, Contributor Name, Contributor Email, Contributor Status, Payee ID, Payee Name, Payee Email, Payment Method, Payee Status, Percentage Rate (as decimal 0.00-1.00 for accounting), Effective Date, Created, Updated
- Import FinancialExportRow from @/types

**ExportContributorsButton.tsx:** Follow ExportUsersButton.tsx pattern exactly.
- Props: contributors: ContributorListItem[], disabled?: boolean
- onClick: call exportContributorsToCSV, show success toast with count
- Error handling with error toast
- Cadence Button variant="subtle" with download icon
- Also include an "Export Financial Data" button that fetches from /api/financials/export and exports all relationship data

**ExportPayeesButton.tsx:** Same pattern as contributors button.
- Props: payees: PayeeListItem[], disabled?: boolean

**Update contributors/page.tsx:**
- Add ExportContributorsButton in the header area (flex justify-end, above results table, same placement as users page)
- Pass data.data to ExportContributorsButton

**Update payees/page.tsx:**
- Add ExportPayeesButton in the same position
- Pass data.data to ExportPayeesButton
  </action>
  <verify>Run `npx tsc --noEmit`. Visit /contributors page, click Export CSV - verify CSV downloads with correct columns. Same for /payees page.</verify>
  <done>CSV export buttons on both list pages, financial data export for accounting. Files download with timestamped names and correct column headers.</done>
</task>

<task type="auto">
  <name>Task 2: Add sidebar navigation and global search integration</name>
  <files>src/components/layout/Sidebar.tsx, src/app/api/search/route.ts</files>
  <action>
**Update Sidebar.tsx:**
Add Contributors and Payees navigation items to the navItems array. Place them AFTER Collections and BEFORE the Settings link (if it exists, otherwise at the end). Follow the existing NavItem pattern.

Contributors nav item:
- label: 'Contributors'
- href: '/contributors'
- icon: SVG person with dollar sign or a simple user-check icon. Use a person/group icon similar to Users but distinct. Suggested: A person with a music note or a person with a star to distinguish from Users.
  Use this SVG (person with checkmark - representing verified contributors):
  ```
  <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
  </svg>
  ```

Payees nav item:
- label: 'Payees'
- href: '/payees'
- icon: SVG representing financial/payment. Use currency/bank icon:
  ```
  <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
  </svg>
  ```

**Update search/route.ts:**
Add contributors to the global search data. The route already has mockPayees. Add mockContributors:

```typescript
const mockContributors = [
  { id: 'contrib-001', type: 'contributor', name: 'Alex Thompson', email: 'alex.thompson@example.com' },
  { id: 'contrib-002', type: 'contributor', name: 'Sarah Johnson', email: 'sarah.johnson@example.com' },
  { id: 'contrib-003', type: 'contributor', name: 'Michael Chen', email: 'michael.chen@example.com' },
  { id: 'contrib-004', type: 'contributor', name: 'Emma Wilson', email: 'emma.wilson@example.com' },
  { id: 'contrib-005', type: 'contributor', name: 'David Martinez', email: 'david.martinez@example.com' },
]
```

Update the SearchResult type to include 'contributor' in the type union:
`type: 'user' | 'asset' | 'payee' | 'contributor'`

Add contributors to the searchableData response:
```typescript
contributors: mockContributors.map(c => ({
  id: c.id,
  type: 'contributor' as const,
  title: c.name,
  subtitle: c.email,
  searchFields: { name: c.name, email: c.email },
  url: `/contributors/${c.id}`,
})),
```

Update payees to use correct URL format `/payees/${p.id}` (verify current URLs point to /payees/ not just /payees).

Also check if src/hooks/useGlobalSearch.tsx or src/components/command-palette/SearchResults.tsx need updates to handle the new 'contributor' type. If SearchResults.tsx renders type labels, add 'contributor' with an appropriate icon/label.
  </action>
  <verify>Run `npx tsc --noEmit`. Check sidebar shows Contributors and Payees links. Test global search (Cmd+K) and type "Alex" - verify contributor results appear alongside other results.</verify>
  <done>Sidebar has Contributors and Payees navigation links with appropriate icons. Global search returns contributors and payees in results with correct URLs.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Sidebar shows Contributors and Payees navigation items in correct position
3. /contributors page has Export CSV button that downloads valid CSV
4. /payees page has Export CSV button that downloads valid CSV
5. Financial data export includes relationship data with decimal rates
6. Global search finds contributors by name/email
7. Search result URLs navigate to correct detail pages
</verification>

<success_criteria>
- CSV export works for contributors, payees, and combined financial data
- Sidebar navigation updated with Contributors and Payees links
- Global search includes contributors in results
- All export files have proper headers and timestamped filenames
</success_criteria>

<output>
After completion, create `.planning/phases/06-payee-and-contributor-management/06-07-SUMMARY.md`
</output>
