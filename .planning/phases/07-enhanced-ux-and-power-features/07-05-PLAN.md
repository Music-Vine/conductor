---
phase: 07-enhanced-ux-and-power-features
plan: 05
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/app/(platform)/page.tsx
  - src/app/(platform)/activity/page.tsx
  - src/app/(platform)/activity/components/ActivityFeedClient.tsx
  - src/app/(platform)/activity/components/ActivityTable.tsx
  - src/components/layout/Sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard home page shows a compact activity feed widget with last 10 entries"
    - "Each widget entry shows actor, action, entity name, and relative time"
    - "Widget has a 'View all activity' link to /activity"
    - "Clicking an entry navigates to the entity detail page"
    - "/activity page shows full paginated activity list"
    - "/activity page supports entity search via URL params (?entityId, ?entityType)"
    - "Dashboard widget links to /activity with pre-filtered params for entity click-through"
  artifacts:
    - path: "src/app/(platform)/page.tsx"
      provides: "Dashboard with ActivityFeedWidget"
      contains: "ActivityFeedWidget"
    - path: "src/app/(platform)/activity/page.tsx"
      provides: "Full Activity page (server component)"
      exports: ["default"]
    - path: "src/app/(platform)/activity/components/ActivityFeedClient.tsx"
      provides: "Client-side activity page with search and filters"
      exports: ["ActivityFeedClient"]
    - path: "src/app/(platform)/activity/components/ActivityTable.tsx"
      provides: "Activity entries table display"
      exports: ["ActivityTable"]
  key_links:
    - from: "src/app/(platform)/page.tsx"
      to: "src/lib/api/activity.ts"
      via: "getRecentActivity fetch"
      pattern: "getRecentActivity"
    - from: "src/app/(platform)/activity/components/ActivityFeedClient.tsx"
      to: "src/lib/api/activity.ts"
      via: "getActivity with filters"
      pattern: "getActivity"
    - from: "src/app/(platform)/activity/page.tsx"
      to: "/activity"
      via: "URL route"
      pattern: "activity"
---

<objective>
Build the Activity dashboard widget and the full Activity page with entity search and filtering.

Purpose: Staff need a system-wide view of recent changes across all entities. The dashboard widget provides at-a-glance awareness, while the full Activity page allows filtering to specific entities for investigation.

Output: Dashboard home page shows a compact activity feed widget. /activity page shows filterable, paginated activity with entity search via URL params.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-enhanced-ux-and-power-features/07-CONTEXT.md
@.planning/phases/07-enhanced-ux-and-power-features/07-RESEARCH.md

@.planning/phases/07-enhanced-ux-and-power-features/07-01-SUMMARY.md

@src/app/(platform)/page.tsx
@src/lib/api/activity.ts
@src/types/activity.ts
@src/app/(platform)/users/page.tsx
@src/app/(platform)/assets/page.tsx
@src/components/layout/Sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add activity feed widget to dashboard</name>
  <files>src/app/(platform)/page.tsx</files>
  <action>
  Rewrite the dashboard page to include an ActivityFeedWidget alongside the existing DashboardCards.

  Keep the existing DashboardCard grid (Users, Assets, Contributors). Add a new section below the cards:

  **ActivityFeedWidget** (can be an async server component or a client component with useQuery — follow whichever pattern the dashboard page currently uses):
  - Fetch the last 10 activity entries using `getRecentActivity(10)` from `@/lib/api/activity`
  - Display in a card with heading "Recent Activity" and a "View all" link to `/activity`
  - Each entry renders as a row:
    - Left: icon based on entityType (use simple SVG or emoji: asset=music note, user=person, contributor=group, payee=dollar)
    - Middle: `{actorName} {action} {entityName}` as clickable text
    - Right: relative time (e.g., "2h ago", "3d ago")
  - Clicking an entry navigates to the entity detail page:
    - entityType 'asset' -> `/assets/{entityId}`
    - entityType 'user' -> `/users/{entityId}`
    - entityType 'contributor' -> `/contributors/{entityId}`
    - entityType 'payee' -> `/payees/{entityId}`
  - Clicking the "View all" link navigates to `/activity`
  - If dashboard is a server component, use a client sub-component for the interactive widget
  - Use a utility function for relative time formatting — check if `formatRelativeTime` exists in the codebase (it was noted in the ActivityTab component). If it exists, extract to a shared util and reuse. If not, create a simple one.

  Keep the existing "Phase 1 Complete" placeholder section or update it to something more useful (e.g., remove it since we're at Phase 7).

  Style the widget card to match existing dashboard card styling (rounded-lg border border-gray-200 bg-white p-6).
  </action>
  <verify>
  Dashboard page loads without errors.
  Activity widget shows 10 entries with actor, action, entity, and time.
  "View all" link navigates to /activity.
  Clicking an entry navigates to the correct entity detail page.
  </verify>
  <done>Dashboard shows activity feed widget with 10 recent entries, clickable entity links, and "View all activity" link.</done>
</task>

<task type="auto">
  <name>Task 2: Create full Activity page with entity search</name>
  <files>src/app/(platform)/activity/page.tsx, src/app/(platform)/activity/components/ActivityFeedClient.tsx, src/app/(platform)/activity/components/ActivityTable.tsx, src/components/layout/Sidebar.tsx</files>
  <action>
  Create the `/activity` route as a full page with filtering and pagination.

  **`src/app/(platform)/activity/page.tsx`** (server component):
  - Accept searchParams: `{ entityType?: string; entityId?: string; page?: string; query?: string }`
  - Fetch activity data using `getActivity()` with the filter params
  - Pass data to `ActivityFeedClient` client component
  - Page title: "Activity" with subtitle "System-wide activity feed"

  **`src/app/(platform)/activity/components/ActivityFeedClient.tsx`** (client component):
  - Entity search input at the top: text input where user can type entity ID or name
  - Entity type filter dropdown: All / Assets / Users / Contributors / Payees
  - Use URL-based state (searchParams pattern matching existing pages like payees/users)
  - Search requires button click (consistent with other pages)
  - Pagination at the bottom following existing TablePagination patterns
  - When dashboard widget links with `?entityId=asset-42&entityType=asset`, the filters should pre-populate

  **`src/app/(platform)/activity/components/ActivityTable.tsx`**:
  - Table displaying activity entries (NOT a TanStack Table — simpler list since there's no sorting/selection needed)
  - Columns: Time, Actor, Action, Entity (with link), Entity Type badge
  - Entity name is a link to the detail page
  - Entity type shown as a colored badge (like platform badges elsewhere)
  - Use same relative time formatting as the dashboard widget

  **Sidebar**: Add "Activity" link to the sidebar navigation, placed between Dashboard and Users (or after Settings, depending on sidebar structure). Use a clock or list icon.
  </action>
  <verify>
  Navigate to /activity — page loads with activity entries.
  Filter by entity type — only that type shown.
  Enter entity ID in search — results filter to that entity.
  Navigate from dashboard widget "View all" — arrives at /activity.
  Navigate from dashboard widget entry click-through with `?entityType=asset&entityId=asset-001` — page shows pre-filtered.
  Pagination works across pages.
  Sidebar shows Activity link.
  </verify>
  <done>Full Activity page at /activity with entity type filter, entity search, pagination, and sidebar navigation link. Dashboard widget click-through pre-filters the page.</done>
</task>

</tasks>

<verification>
1. Dashboard widget shows 10 recent activity entries
2. Each entry is clickable and navigates to correct entity page
3. "View all" navigates to /activity
4. /activity page loads with paginated activity
5. Entity type filter works (show only assets, users, etc.)
6. Entity search filters to specific entity
7. Dashboard -> "View all" -> /activity transition works
8. Dashboard entry click-through with pre-filtered params works
9. Activity link appears in sidebar
</verification>

<success_criteria>
- Dashboard has compact activity widget with 10 entries
- Full Activity page supports entity type filter and entity search
- URL-based state enables pre-filtered navigation from dashboard
- Sidebar has Activity navigation link
- All activity entries link to their entity detail pages
</success_criteria>

<output>
After completion, create `.planning/phases/07-enhanced-ux-and-power-features/07-05-SUMMARY.md`
</output>
