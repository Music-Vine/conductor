---
phase: 07-enhanced-ux-and-power-features
plan: 07
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/app/(platform)/collections/page.tsx
  - src/app/(platform)/collections/components/CollectionTable.tsx
  - src/app/(platform)/collections/components/ExportCollectionsButton.tsx
  - src/app/(platform)/activity/components/ExportActivityButton.tsx
  - src/lib/utils/export-csv.ts
autonomous: true

must_haves:
  truths:
    - "Collections page renders a TanStack Table (not just card grid)"
    - "Collections table has an 'Export filtered' and 'Export all' button"
    - "Activity page has an 'Export filtered' and 'Export all' button"
    - "Exported collections CSV contains id, title, platform, assetCount, createdAt"
    - "Exported activity CSV contains timestamp, actor, action, entityType, entityName, details"
  artifacts:
    - path: "src/app/(platform)/collections/components/CollectionTable.tsx"
      provides: "TanStack Table for collections list"
      exports: ["CollectionTable"]
    - path: "src/app/(platform)/collections/components/ExportCollectionsButton.tsx"
      provides: "Export button for collections with filtered + all options"
      exports: ["ExportCollectionsButton"]
    - path: "src/app/(platform)/activity/components/ExportActivityButton.tsx"
      provides: "Export button for activity with filtered + all options"
      exports: ["ExportActivityButton"]
    - path: "src/lib/utils/export-csv.ts"
      provides: "CSV export functions for collections and activity"
      exports: ["exportCollectionsToCSV", "exportActivityToCSV"]
  key_links:
    - from: "ExportCollectionsButton.tsx"
      to: "src/lib/utils/export-csv.ts"
      via: "exportCollectionsToCSV"
      pattern: "exportCollectionsToCSV"
    - from: "ExportActivityButton.tsx"
      to: "src/lib/utils/export-csv.ts"
      via: "exportActivityToCSV"
      pattern: "exportActivityToCSV"
---

<objective>
Add a TanStack Table to the Collections page (replacing the card-only grid), create CSV export functions for collections and activity, and add export buttons to both pages.

Purpose: Per CONTEXT, every data table needs CSV export. Collections currently has only a card grid (no table = no export). Activity is a new page that needs export. This plan fills those gaps.

Output: Collections page has a table view with export buttons. Activity page has export buttons. CSV functions for both entity types exist in export-csv.ts.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-enhanced-ux-and-power-features/07-CONTEXT.md
@.planning/phases/07-enhanced-ux-and-power-features/07-RESEARCH.md

@.planning/phases/07-enhanced-ux-and-power-features/07-01-SUMMARY.md

@src/app/(platform)/collections/page.tsx
@src/types/collection.ts
@src/types/activity.ts
@src/lib/utils/export-csv.ts
@src/app/(platform)/payees/components/PayeeTable.tsx
@src/app/(platform)/payees/components/ExportPayeesButton.tsx
@src/lib/api/collections.ts
@src/lib/api/activity.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CSV export functions and create CollectionTable</name>
  <files>src/lib/utils/export-csv.ts, src/app/(platform)/collections/components/CollectionTable.tsx</files>
  <action>
  **Add to `src/lib/utils/export-csv.ts`:**

  1. `exportCollectionsToCSV(collections: CollectionListItem[])`:
     - Import `CollectionListItem` from `@/types`
     - Columns: id -> "Collection ID", title -> "Title", platform -> "Platform", assetCount -> "Asset Count", createdAt -> "Created"
     - Filename: `collections-{timestamp}.csv`
     - Follow exact same pattern as `exportPayeesToCSV`

  2. `exportActivityToCSV(activity: SystemActivityEntry[])`:
     - Import `SystemActivityEntry` from `@/types/activity`
     - Columns: createdAt -> "Timestamp", actorName -> "Actor", action -> "Action", entityType -> "Entity Type", entityName -> "Entity", entityId -> "Entity ID", details -> "Details"
     - Filename: `activity-{timestamp}.csv`
     - Follow exact same pattern as other export functions

  **Create `src/app/(platform)/collections/components/CollectionTable.tsx`:**

  Build a TanStack Table for collections following the PayeeTable pattern:
  - 'use client' component
  - Props: `collections: CollectionListItem[]`
  - Columns: Title (link to detail page), Platform (badge), Asset Count, Created (formatted date)
  - Use `useReactTable` with `getCoreRowModel`
  - Simple table layout (no virtualization needed for collections — typically small datasets)
  - Row click navigates to `/collections/{id}`
  - Standard Tailwind table styling matching other tables in the app

  Create a `src/app/(platform)/collections/components/index.ts` barrel export if it doesn't exist.
  </action>
  <verify>
  TypeScript compiles without errors.
  `exportCollectionsToCSV` and `exportActivityToCSV` are importable from `@/lib/utils/export-csv`.
  CollectionTable component renders without errors.
  </verify>
  <done>CSV export functions for collections and activity added. CollectionTable component created following PayeeTable pattern with TanStack Table.</done>
</task>

<task type="auto">
  <name>Task 2: Update Collections page and add export buttons</name>
  <files>src/app/(platform)/collections/page.tsx, src/app/(platform)/collections/components/ExportCollectionsButton.tsx, src/app/(platform)/activity/components/ExportActivityButton.tsx</files>
  <action>
  **Update `src/app/(platform)/collections/page.tsx`:**
  - Keep the existing card grid BUT add the CollectionTable as the primary data view
  - Option A (preferred): Replace the card grid with CollectionTable. Add the ExportCollectionsButton above the table, right-aligned (matching other list pages).
  - Option B: Add a view toggle (table/grid). This is more complex — prefer Option A for simplicity.
  - Keep the existing "Create Collection" button in the page header.
  - Add ExportCollectionsButton in the header area, next to Create Collection.

  **Create `src/app/(platform)/collections/components/ExportCollectionsButton.tsx`:**
  - Follow the same dual-export pattern used in Plan 07-04:
  - "Export filtered" — exports current page data
  - "Export all" — fetches from `/api/collections?limit=10000` and exports
  - `isExportingAll` loading state
  - Two Cadence Button variant="subtle" buttons
  - Use `exportCollectionsToCSV` from `@/lib/utils/export-csv`

  **Create `src/app/(platform)/activity/components/ExportActivityButton.tsx`:**
  - Same dual-export pattern:
  - "Export filtered" — exports currently displayed activity (passed as prop)
  - "Export all" — fetches from `/api/activity?limit=10000` and exports
  - `isExportingAll` loading state
  - Use `exportActivityToCSV` from `@/lib/utils/export-csv`

  **Integrate ExportActivityButton into the Activity page:**
  - Add it to the Activity page header or above the activity list, right-aligned
  - The ActivityFeedClient component (from Plan 07-05) should include this button

  Note: The Activity page components are created in Plan 07-05. This plan adds the export button to the Activity page. If the Activity page components don't exist yet when this plan runs, create a minimal placeholder and add the export button — Plan 07-05 will build the full page. However, since Plan 07-05 and this plan are both Wave 2, they may run in parallel. Coordinate by: this plan creates the ExportActivityButton as a standalone component, and Plan 07-05 imports it into the ActivityFeedClient. If running after Plan 07-05, integrate directly.
  </action>
  <verify>
  Collections page shows a table (not just card grid).
  Collections page has "Export filtered" and "Export all" buttons.
  Export filtered downloads CSV with collection data.
  Export all fetches all collections and downloads CSV.
  ExportActivityButton component exists and is ready for integration.
  </verify>
  <done>Collections page uses CollectionTable with export buttons. Activity export button created. Both support "Export filtered" and "Export all" with loading states. Every data table in the app now has CSV export capability.</done>
</task>

</tasks>

<verification>
1. Collections page renders a TanStack Table (not just cards)
2. Collections page has "Export filtered" and "Export all" buttons
3. Collections CSV export includes id, title, platform, assetCount, createdAt
4. Activity export button exists with both options
5. Activity CSV export includes timestamp, actor, action, entity type, entity name, details
6. TypeScript compiles without new errors
7. All entity list pages now have export: Users, Assets, Contributors, Payees, Collections, Activity
</verification>

<success_criteria>
- Collections page has TanStack Table replacing card grid
- CSV export available on Collections and Activity pages
- Both "Export filtered" and "Export all" options on each
- exportCollectionsToCSV and exportActivityToCSV functions work correctly
- This completes the CSV export gap-fill for all tables
</success_criteria>

<output>
After completion, create `.planning/phases/07-enhanced-ux-and-power-features/07-07-SUMMARY.md`
</output>
