---
phase: 07-enhanced-ux-and-power-features
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/inline-editing/InlineEditField.tsx
  - src/app/api/contributors/[id]/route.ts
  - src/app/api/payees/[id]/route.ts
  - src/app/api/users/[id]/route.ts
autonomous: true

must_haves:
  truths:
    - "InlineEditField renders value as text in idle state"
    - "Clicking the text enters edit mode with an input"
    - "Enter key saves the value via mutation"
    - "Escape key cancels and restores original value"
    - "Blur does NOT save (per CONTEXT decision — no accidental saves)"
    - "PATCH /api/contributors/[id] accepts partial updates"
    - "PATCH /api/payees/[id] accepts partial updates"
    - "PATCH /api/users/[id] accepts partial updates"
  artifacts:
    - path: "src/components/inline-editing/InlineEditField.tsx"
      provides: "Reusable click-to-edit field component"
      exports: ["InlineEditField"]
    - path: "src/app/api/contributors/[id]/route.ts"
      provides: "PATCH handler for contributor updates"
      exports: ["PATCH"]
    - path: "src/app/api/payees/[id]/route.ts"
      provides: "PATCH handler for payee updates"
      exports: ["PATCH"]
    - path: "src/app/api/users/[id]/route.ts"
      provides: "PATCH handler for user updates"
      exports: ["PATCH"]
  key_links:
    - from: "src/components/inline-editing/InlineEditField.tsx"
      to: "@tanstack/react-query"
      via: "useMutation for save"
      pattern: "useMutation"
    - from: "src/components/inline-editing/InlineEditField.tsx"
      to: "sonner"
      via: "toast feedback"
      pattern: "toast\\.(success|error)"
---

<objective>
Create the InlineEditField component and add missing PATCH API routes for contributors, payees, and users.

Purpose: The InlineEditField is the shared UI building block for all inline editing across detail pages and table rows. The PATCH routes are required for saving inline edits. Both must exist before integration plans can execute.

Output: A working InlineEditField component with click-to-edit, Enter-to-save, Escape-to-cancel behavior, plus PATCH endpoints for all entities that currently lack them.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-enhanced-ux-and-power-features/07-CONTEXT.md
@.planning/phases/07-enhanced-ux-and-power-features/07-RESEARCH.md

@src/app/api/assets/[id]/route.ts
@src/app/api/contributors/[id]/route.ts
@src/app/api/payees/[id]/route.ts
@src/app/api/users/[id]/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create InlineEditField component</name>
  <files>src/components/inline-editing/InlineEditField.tsx</files>
  <action>
  Create `src/components/inline-editing/InlineEditField.tsx` as a 'use client' component:

  Props:
  - `value: string` — current display value
  - `onSave: (newValue: string) => Promise<void>` — async save handler (called on Enter)
  - `queryKey: unknown[]` — React Query key for cache invalidation after save
  - `type?: 'text' | 'number'` — input type (default 'text')
  - `className?: string` — additional classes for the container
  - `placeholder?: string` — shown when value is empty

  Internal state machine (use useState, NOT useReducer):
  - `isEditing` (boolean): idle vs edit mode
  - `localValue` (string): tracks input value separately from prop
  - `inputRef` (useRef): for auto-focus on edit start

  Behaviors:
  - **Idle state:** Render value as a `<span>` with `cursor-text` and `hover:bg-gray-100` to hint editability. Subtle dashed underline on hover.
  - **Click:** Set isEditing=true, set localValue=value. useEffect auto-focuses and selects all text.
  - **Enter:** Call `mutation.mutate()` which invokes `onSave(localValue)`. On success: set isEditing=false, invalidate queryKey, `toast.success('Saved')`. On error: `toast.error('Failed to save')`, reset localValue to original value, set isEditing=false.
  - **Escape:** Set localValue back to value (discard), set isEditing=false. Do NOT trigger save.
  - **Blur:** Do NOTHING. Per CONTEXT: "Enter to confirm, Escape to cancel — no accidental saves on blur."
  - **During save (isPending):** Show the input as disabled with reduced opacity. Do not allow Escape during pending save.

  Use `useMutation` from `@tanstack/react-query` and `useQueryClient` for invalidation.
  Use `toast` from `sonner` for feedback.
  Use Cadence `Input` component for the edit input if it accepts ref forwarding; otherwise use a plain `<input>` styled to match Cadence inputs (border, rounded, text-sm, focus ring with ring-platform-primary).

  Edge case: if value prop changes externally while NOT editing, the display should update. If editing, keep localValue unchanged (don't disrupt active edit).
  </action>
  <verify>
  Component renders without errors.
  TypeScript compiles: `npx tsc --noEmit` passes (or no new errors).
  Visually: idle shows text with hover hint, click opens input, Enter triggers onSave, Escape reverts.
  </verify>
  <done>InlineEditField component exists with full state machine: idle (click to edit), editing (Enter saves, Escape cancels), saving (disabled input, toast feedback). No save on blur.</done>
</task>

<task type="auto">
  <name>Task 2: Add PATCH routes for contributors, payees, and users</name>
  <files>src/app/api/contributors/[id]/route.ts, src/app/api/payees/[id]/route.ts, src/app/api/users/[id]/route.ts</files>
  <action>
  Add PATCH handlers to the three existing route files that currently only have GET.

  Follow the pattern from `/api/assets/[id]/route.ts` PATCH handler:
  1. Add artificial latency (100-200ms)
  2. Extract `id` from params (await params pattern for Next.js 15)
  3. Parse request body as JSON
  4. Generate the existing mock entity using the existing generation function
  5. Merge updates into the entity (spread, preserving id and adding `updatedAt: new Date().toISOString()`)
  6. Return `{ data: updatedEntity }`
  7. Return 400 for invalid request body

  For `/api/contributors/[id]/route.ts`:
  - PATCH handler accepts partial updates to contributor fields (name, email, phone, etc.)
  - Preserve existing GET handler unchanged

  For `/api/payees/[id]/route.ts`:
  - PATCH handler accepts partial updates to payee fields (name, email, paymentMethod, etc.)
  - Preserve existing GET handler unchanged

  For `/api/users/[id]/route.ts`:
  - PATCH handler accepts partial updates to user fields (name, username, etc.)
  - Preserve existing GET handler unchanged
  - Do NOT allow email or status updates via PATCH (security-sensitive per RESEARCH recommendations)
  </action>
  <verify>
  Run `curl -X PATCH http://localhost:3000/api/contributors/contributor-001 -H "Content-Type: application/json" -d '{"name":"Updated Name"}'` and verify 200 response with updated data.
  Run `curl -X PATCH http://localhost:3000/api/payees/payee-001 -H "Content-Type: application/json" -d '{"name":"Updated Payee"}'` and verify 200.
  Run `curl -X PATCH http://localhost:3000/api/users/user-001 -H "Content-Type: application/json" -d '{"name":"Updated User"}'` and verify 200.
  </verify>
  <done>All three entity types have working PATCH endpoints that accept partial updates and return the updated entity. Existing GET handlers are preserved unchanged.</done>
</task>

</tasks>

<verification>
1. InlineEditField component renders in isolation without errors
2. PATCH /api/contributors/[id] returns updated contributor
3. PATCH /api/payees/[id] returns updated payee
4. PATCH /api/users/[id] returns updated user
5. TypeScript compiles without new errors
</verification>

<success_criteria>
- InlineEditField has click-to-edit, Enter-to-save, Escape-to-cancel behavior
- No save on blur
- Three PATCH routes exist and accept partial updates
- All existing GET handlers are unmodified
</success_criteria>

<output>
After completion, create `.planning/phases/07-enhanced-ux-and-power-features/07-02-SUMMARY.md`
</output>
