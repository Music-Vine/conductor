---
phase: 07-enhanced-ux-and-power-features
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(platform)/users/components/ExportUsersButton.tsx
  - src/app/(platform)/assets/components/ExportAssetsButton.tsx
  - src/app/(platform)/contributors/components/ExportContributorsButton.tsx
  - src/app/(platform)/payees/components/ExportPayeesButton.tsx
autonomous: true

must_haves:
  truths:
    - "Each existing export button offers both 'Export filtered' and 'Export all' options"
    - "'Export filtered' exports the currently displayed/filtered data"
    - "'Export all' fetches all records from the API (no filters) and exports them"
    - "'Export all' shows loading state while fetching"
    - "'Export all' shows toast feedback on success/failure"
  artifacts:
    - path: "src/app/(platform)/users/components/ExportUsersButton.tsx"
      provides: "Users export with filtered + all options"
      exports: ["ExportUsersButton"]
    - path: "src/app/(platform)/assets/components/ExportAssetsButton.tsx"
      provides: "Assets export with filtered + all options"
      exports: ["ExportAssetsButton"]
    - path: "src/app/(platform)/contributors/components/ExportContributorsButton.tsx"
      provides: "Contributors export with filtered + all options"
      exports: ["ExportContributorsButton"]
    - path: "src/app/(platform)/payees/components/ExportPayeesButton.tsx"
      provides: "Payees export with filtered + all options"
      exports: ["ExportPayeesButton"]
  key_links:
    - from: "ExportUsersButton.tsx"
      to: "/api/users"
      via: "fetch all users for Export All"
      pattern: "api.*users.*limit"
    - from: "ExportAssetsButton.tsx"
      to: "/api/assets"
      via: "fetch all assets for Export All"
      pattern: "api.*assets.*limit"
---

<objective>
Upgrade all four existing CSV export buttons to offer both "Export filtered" and "Export all" options.

Purpose: Staff need the ability to export either the current filtered view OR the complete unfiltered dataset. Currently all export buttons only export the filtered data.

Output: Each export button renders two options: "Export filtered" (current data) and "Export all" (fetches all from API). Loading state on "Export all" while fetching.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-enhanced-ux-and-power-features/07-CONTEXT.md
@.planning/phases/07-enhanced-ux-and-power-features/07-RESEARCH.md

@src/app/(platform)/payees/components/ExportPayeesButton.tsx
@src/app/(platform)/users/components/ExportUsersButton.tsx
@src/app/(platform)/assets/components/ExportAssetsButton.tsx
@src/app/(platform)/contributors/components/ExportContributorsButton.tsx
@src/lib/utils/export-csv.ts
@src/lib/api/client.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Upgrade Users and Assets export buttons</name>
  <files>src/app/(platform)/users/components/ExportUsersButton.tsx, src/app/(platform)/assets/components/ExportAssetsButton.tsx</files>
  <action>
  Update both export buttons to offer dual export options.

  For each button, change the UI from a single "Export CSV" button to two buttons side by side:
  - "Export filtered" — uses the existing `data` prop (already fetched for display). Same behavior as current button.
  - "Export all" — fetches ALL records from the API without filters using a high limit (e.g., `?limit=10000`), then calls the export function.

  Implementation pattern (apply to both):
  1. Add `useState` for `isExportingAll` loading state
  2. Keep existing `handleExport` as `handleExportFiltered`
  3. Add `handleExportAll` that:
     - Sets isExportingAll=true
     - Fetches from the API using `apiClient.get` (import from `@/lib/api/client`):
       - Users: `GET /api/users?limit=10000`
       - Assets: `GET /api/assets?limit=10000`
     - Calls the appropriate export function (exportUsersToCSV / exportAssetsToCSV)
     - Shows toast.success with count on success
     - Shows toast.error on failure
     - Sets isExportingAll=false in finally block
  4. Render two Cadence Button components (variant="subtle"):
     - "Export filtered" — disabled when data is empty
     - "Export all" — disabled when isExportingAll, shows "Exporting..." text during fetch
  5. Wrap both buttons in a `flex gap-2` container

  Keep the existing download icon on the "Export filtered" button. Add a similar or same icon on "Export all".
  </action>
  <verify>
  TypeScript compiles without errors.
  Both buttons render in the Users and Assets list pages.
  "Export filtered" still works as before.
  "Export all" shows loading state and triggers download.
  </verify>
  <done>ExportUsersButton and ExportAssetsButton each render "Export filtered" and "Export all" options with loading state on the all-data fetch.</done>
</task>

<task type="auto">
  <name>Task 2: Upgrade Contributors and Payees export buttons</name>
  <files>src/app/(platform)/contributors/components/ExportContributorsButton.tsx, src/app/(platform)/payees/components/ExportPayeesButton.tsx</files>
  <action>
  Apply the same dual-export pattern to Contributors and Payees buttons.

  Same pattern as Task 1:
  1. Add `isExportingAll` state
  2. `handleExportFiltered` uses existing data prop
  3. `handleExportAll` fetches from API:
     - Contributors: `GET /api/contributors?limit=10000`
     - Payees: `GET /api/payees?limit=10000`
  4. Two buttons: "Export filtered" + "Export all" with loading state
  5. Use Cadence Button variant="subtle"

  For the Contributors button specifically: it currently exports both contributor CSV and financial data. Keep the existing financial export behavior for the filtered variant. For "Export all" just export contributors (not financial data — financial data has a separate dedicated export already).

  For the Payees button: follow the same pattern. The existing ExportPayeesButton already has the download icon and toast pattern — extend it with the second button.
  </action>
  <verify>
  TypeScript compiles without errors.
  Contributors page shows both export options.
  Payees page shows both export options.
  "Export all" fetches and downloads successfully.
  </verify>
  <done>ExportContributorsButton and ExportPayeesButton each render "Export filtered" and "Export all" options. All four entity exports now have dual-export capability.</done>
</task>

</tasks>

<verification>
1. All four export buttons render two options: "Export filtered" and "Export all"
2. "Export filtered" works identically to the previous single-button behavior
3. "Export all" fetches all data from API and triggers CSV download
4. "Export all" shows "Exporting..." loading state during fetch
5. Toast feedback appears on success and failure for both options
6. TypeScript compiles without new errors
</verification>

<success_criteria>
- Every existing export button now offers both "Export filtered" and "Export all"
- Loading state prevents double-clicks on "Export all"
- CSV files download correctly for both options
- Existing export behavior is not broken
</success_criteria>

<output>
After completion, create `.planning/phases/07-enhanced-ux-and-power-features/07-04-SUMMARY.md`
</output>
