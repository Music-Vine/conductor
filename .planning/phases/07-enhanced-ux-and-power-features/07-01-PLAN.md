---
phase: 07-enhanced-ux-and-power-features
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/activity.ts
  - src/app/api/activity/route.ts
  - src/lib/api/activity.ts
autonomous: true

must_haves:
  truths:
    - "GET /api/activity returns paginated system-wide activity entries"
    - "Activity entries span all entity types: assets, users, contributors, payees"
    - "Activity can be filtered by entityType, entityId, and page"
    - "Dashboard widget can fetch last 10 entries via ?limit=10"
    - "Activity data is seeded deterministically (not empty on cold start)"
  artifacts:
    - path: "src/types/activity.ts"
      provides: "SystemActivityEntry type definition"
      exports: ["SystemActivityEntry"]
    - path: "src/app/api/activity/route.ts"
      provides: "GET handler for system-wide activity feed"
      exports: ["GET"]
    - path: "src/lib/api/activity.ts"
      provides: "Client-side API functions for fetching activity"
      exports: ["getActivity", "getRecentActivity"]
  key_links:
    - from: "src/lib/api/activity.ts"
      to: "/api/activity"
      via: "apiClient.get"
      pattern: "apiClient\\.get.*activity"
    - from: "src/app/api/activity/route.ts"
      to: "src/types/activity.ts"
      via: "import SystemActivityEntry"
      pattern: "SystemActivityEntry"
---

<objective>
Create the system-wide activity feed API foundation: type definitions, mock API route with seeded data, and client-side API functions.

Purpose: The activity API is the foundation for the dashboard widget, full Activity page, and activity CSV export. All downstream activity features depend on this route existing and returning realistic data.

Output: A working `/api/activity` endpoint that returns paginated, filterable mock activity entries spanning all entity types.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-enhanced-ux-and-power-features/07-CONTEXT.md
@.planning/phases/07-enhanced-ux-and-power-features/07-RESEARCH.md

@src/types/audit.ts
@src/app/api/assets/[id]/activity/route.ts
@src/lib/api/client.ts
@src/lib/api/users.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create activity types and mock API route</name>
  <files>src/types/activity.ts, src/app/api/activity/route.ts</files>
  <action>
  Create `src/types/activity.ts` with:
  - `SystemActivityEntry` interface: id, entityType ('asset' | 'user' | 'contributor' | 'payee'), entityId, entityName (human-readable), action (string like "Approved", "Rejected", "Suspended", "Rate changed"), actorId, actorName, details (string), createdAt (ISO string)
  - Export the type

  Create `src/app/api/activity/route.ts` with a GET handler:
  - Supports query params: `limit` (default 50), `entityType` (filter), `entityId` (filter), `page` (default 1)
  - Generates ~200 seeded mock activity entries using deterministic generation (index-based, NOT Math.random)
  - Entries should span all entity types: asset approvals/rejections/uploads/workflow transitions, user suspensions/refunds/OAuth disconnects, contributor/payee assignments and rate changes
  - Per CONTEXT: exclude staff logins and bulk operation events
  - Actor names from a small pool of mock staff names (e.g., "Sarah Johnson", "Alex Thompson", "Maria Garcia")
  - Entity names: "Music Track 42", "james@example.com", "Contributor: John Doe", "Payee: Acme Records" format
  - Sort newest first (descending by createdAt)
  - createdAt spread over the last 30 days
  - Return PaginatedResponse format matching existing API patterns: `{ data: [...], pagination: { page, limit, total, totalPages } }`
  - Add 50-100ms artificial latency (consistent with other mock routes)

  Follow the existing pattern from `/api/assets/[id]/activity/route.ts` for seeded generation style.
  Add `/api/activity` to middleware public paths.
  </action>
  <verify>
  Run `curl http://localhost:3000/api/activity?limit=5` and verify it returns 5 activity entries with correct structure.
  Run `curl http://localhost:3000/api/activity?entityType=asset` and verify only asset entries returned.
  Run `curl http://localhost:3000/api/activity?entityId=asset-001` and verify filtered to single entity.
  </verify>
  <done>API returns paginated, filterable activity entries spanning all 4 entity types with deterministic seeded data. Cold start returns data (not empty).</done>
</task>

<task type="auto">
  <name>Task 2: Create client-side activity API functions</name>
  <files>src/lib/api/activity.ts</files>
  <action>
  Create `src/lib/api/activity.ts` following the pattern from `src/lib/api/users.ts`:
  - `getActivity(params: { page?: number; limit?: number; entityType?: string; entityId?: string })` — fetches from `/api/activity` with query params, returns paginated response
  - `getRecentActivity(limit?: number)` — convenience wrapper for dashboard widget, defaults to limit=10
  - Use `apiClient.get` from `@/lib/api/client`
  - Properly type the return as `PaginatedResponse<SystemActivityEntry>`

  Export both functions from `src/lib/api/index.ts` if there's a barrel file, otherwise just export from the activity.ts file.
  </action>
  <verify>TypeScript compiles without errors. The functions are importable from `@/lib/api/activity`.</verify>
  <done>Client-side activity API functions exist and are typed correctly. `getActivity` supports all filter params. `getRecentActivity` is a convenience wrapper for widget use.</done>
</task>

</tasks>

<verification>
1. `curl http://localhost:3000/api/activity` returns 200 with paginated activity entries
2. `curl http://localhost:3000/api/activity?limit=10` returns exactly 10 entries
3. `curl http://localhost:3000/api/activity?entityType=user` returns only user-related entries
4. `curl http://localhost:3000/api/activity?entityId=asset-001` returns only entries for that entity
5. TypeScript compiles: `npx tsc --noEmit` passes (or no new errors)
</verification>

<success_criteria>
- /api/activity returns seeded mock data (never empty on cold start)
- Entries cover asset, user, contributor, and payee entity types
- Filtering by entityType and entityId works correctly
- Pagination returns correct page/total/totalPages
- Client-side API functions are typed and importable
</success_criteria>

<output>
After completion, create `.planning/phases/07-enhanced-ux-and-power-features/07-01-SUMMARY.md`
</output>
