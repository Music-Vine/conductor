---
phase: 08-legacy-system-migration
plan: 08
type: execute
wave: 3
depends_on: ["08-02", "08-03", "08-04", "08-05", "08-06"]
files_modified:
  - playwright.config.ts
  - e2e/smoke/auth.setup.ts
  - e2e/smoke/users.spec.ts
  - e2e/smoke/assets.spec.ts
  - e2e/smoke/contributors.spec.ts
  - e2e/smoke/payees.spec.ts
  - e2e/smoke/collections.spec.ts
  - e2e/smoke/activity.spec.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "Playwright is installed and configured for the project"
    - "Smoke tests exist for every major Conductor screen"
    - "Auth setup test saves storage state for reuse across all smoke tests"
    - "Smoke tests verify real data loads without errors (not mock data validation)"
  artifacts:
    - path: "playwright.config.ts"
      provides: "Playwright configuration with web server and auth setup"
      contains: "defineConfig"
    - path: "e2e/smoke/auth.setup.ts"
      provides: "Authentication setup that saves storage state"
      contains: "storageState"
    - path: "e2e/smoke/users.spec.ts"
      provides: "Smoke test for users screen"
      contains: "test.*Users"
    - path: "e2e/smoke/assets.spec.ts"
      provides: "Smoke test for assets screen"
      contains: "test.*Assets"
  key_links:
    - from: "playwright.config.ts"
      to: "e2e/smoke/auth.setup.ts"
      via: "setup project dependency"
      pattern: "testMatch.*setup"
    - from: "e2e/smoke/users.spec.ts"
      to: "e2e/.auth/staff-user.json"
      via: "storageState"
      pattern: "storageState"
---

<objective>
Install Playwright, configure it for the project, and write smoke tests for every major Conductor screen to validate that pages load and display data correctly.

Purpose: Provide automated validation that Conductor works correctly with real backend data before cutover. These tests serve as the "smoke test" gate in the cutover checklist.
Output: Playwright config, auth setup, and 6 smoke test files.
</objective>

<execution_context>
@/Users/sambeevors/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sambeevors/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-legacy-system-migration/08-RESEARCH.md
@.planning/phases/08-legacy-system-migration/08-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Playwright and create configuration</name>
  <files>
    playwright.config.ts
    e2e/smoke/auth.setup.ts
    package.json
  </files>
  <action>
1. **Install Playwright:**
```bash
npm install --save-dev @playwright/test
npx playwright install chromium
```

2. **Create `playwright.config.ts`** at project root:
```typescript
import { defineConfig, devices } from '@playwright/test'

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: process.env.PLAYWRIGHT_BASE_URL ?? 'http://localhost:3000',
    trace: 'on-first-retry',
  },
  projects: [
    {
      name: 'setup',
      testMatch: /.*\.setup\.ts/,
    },
    {
      name: 'smoke',
      use: {
        ...devices['Desktop Chrome'],
        storageState: 'e2e/.auth/staff-user.json',
      },
      dependencies: ['setup'],
      testMatch: /smoke\/.*\.spec\.ts/,
    },
  ],
  // Locally, start the dev server; in CI, connect to deployed app
  ...(process.env.CI
    ? {}
    : {
        webServer: {
          command: 'npm run dev',
          url: 'http://localhost:3000',
          reuseExistingServer: true,
        },
      }),
})
```

3. **Create `e2e/smoke/auth.setup.ts`** for authentication:
```typescript
import { test as setup, expect } from '@playwright/test'

const authFile = 'e2e/.auth/staff-user.json'

setup('authenticate', async ({ page }) => {
  // Navigate to login page
  await page.goto('/login')

  // Fill in email for magic link
  // In dev mode, the magic link URL is logged to the console
  // For smoke tests, we use a test account with known credentials
  await page.getByLabel('Email').fill('admin@example.com')
  await page.getByRole('button', { name: /send/i }).click()

  // In dev mode, the app auto-redirects after magic link
  // Wait for dashboard to confirm auth succeeded
  await page.waitForURL('**/dashboard', { timeout: 10_000 })
  await expect(page.getByRole('heading', { level: 1 })).toBeVisible()

  // Save authentication state
  await page.context().storageState({ path: authFile })
})
```

4. **Add `.gitignore` entries** (add to existing .gitignore):
```
# Playwright
/test-results/
/playwright-report/
/blob-report/
/e2e/.auth/
```

5. **Add npm scripts** to package.json:
```json
{
  "scripts": {
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui"
  }
}
```

6. **Create `e2e/.auth/` directory** with a `.gitkeep` file (the actual auth state is gitignored).
  </action>
  <verify>`npx playwright test --list` shows the setup project and lists test files, `ls e2e/smoke/auth.setup.ts` exists</verify>
  <done>Playwright installed, configured with auth setup, web server config, and npm scripts</done>
</task>

<task type="auto">
  <name>Task 2: Write smoke tests for all major screens</name>
  <files>
    e2e/smoke/users.spec.ts
    e2e/smoke/assets.spec.ts
    e2e/smoke/contributors.spec.ts
    e2e/smoke/payees.spec.ts
    e2e/smoke/collections.spec.ts
    e2e/smoke/activity.spec.ts
  </files>
  <action>
Create 6 smoke test files. Each test verifies that a screen loads, displays data (at least one row in tables), and basic interactions work. These are NOT comprehensive E2E tests -- they're smoke tests to confirm the proxy integration works.

**Common pattern for each test:**
```typescript
import { test, expect } from '@playwright/test'

test.describe('[Screen Name]', () => {
  test('page loads without errors', async ({ page }) => {
    await page.goto('/[path]')
    // No error boundary visible
    await expect(page.getByRole('alert')).not.toBeVisible()
    // Page heading visible
    await expect(page.getByRole('heading', { level: 1 })).toBeVisible()
  })

  test('table displays data', async ({ page }) => {
    await page.goto('/[path]')
    // Wait for data to load (table rows appear)
    await expect(page.getByRole('row')).toHaveCount({ min: 2 }) // header + at least 1 data row
  })

  test('search/filter works', async ({ page }) => {
    await page.goto('/[path]')
    // Interact with search or filter
    // Verify results change
  })
})
```

**users.spec.ts:**
- Test: Users page loads, table shows data rows
- Test: Search by email returns results
- Test: Status filter (active) shows results
- Test: Click user row navigates to detail page
- Test: User detail page shows tabs (Profile, Subscription, Downloads)

**assets.spec.ts:**
- Test: Assets page loads, table shows data rows
- Test: Type filter (music) shows results
- Test: Status filter (published) shows results
- Test: Click asset row navigates to detail page
- Test: Asset detail page shows workflow panel

**contributors.spec.ts:**
- Test: Contributors page loads, table shows data rows
- Test: Search by name returns results
- Test: Click contributor row navigates to detail page
- Test: Contributor detail shows Payees tab

**payees.spec.ts:**
- Test: Payees page loads, table shows data rows
- Test: Click payee row navigates to detail page

**collections.spec.ts:**
- Test: Collections page loads, shows collections
- Test: Click collection navigates to detail page

**activity.spec.ts:**
- Test: Activity page loads, shows activity entries
- Test: Entity type filter shows filtered results

**Important:** Use generous timeouts (10-15 seconds) for page loads and data fetching since these tests may run against a real backend with real network latency. Use `await page.waitForLoadState('networkidle')` where appropriate.

**Do NOT test:** Upload flows, bulk operations with SSE, or destructive actions (suspend, delete). Smoke tests verify read paths only.
  </action>
  <verify>`npx playwright test --list` shows all test files with their test cases listed</verify>
  <done>Smoke tests created for all 6 major screen areas (users, assets, contributors, payees, collections, activity)</done>
</task>

</tasks>

<verification>
1. `npx playwright test --list` shows setup + all smoke test files
2. All smoke tests follow consistent patterns
3. Tests cover: page load, data display, basic filter/search, navigation to detail pages
4. No destructive actions in smoke tests (read-only verification)
5. Auth setup saves storage state for reuse
</verification>

<success_criteria>
- Playwright configured and installed
- Auth setup test authenticates and saves state
- 6 smoke test files cover all major Conductor screens
- Tests can run locally against dev server (`npm run test:e2e`)
- Smoke tests serve as the automated validation gate for cutover
</success_criteria>

<output>
After completion, create `.planning/phases/08-legacy-system-migration/08-08-SUMMARY.md`
</output>
